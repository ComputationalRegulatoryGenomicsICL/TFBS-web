<head>
<!-- Generated by perlmod2www.pl -->
<title>
PFM documentation.
</title>
<link rel="stylesheet" type="text/css" href="../perl.css">
</head>
<body bgcolor="white">
<span id="modRootPath">TFBS::Matrix</span>
<span id="modName">PFM</span>
<div id="sep"></div>
<a name="TOP" id="TOP"></a>
<table id="daArea" width="100%"><tr><td id="daEntry" ><a href="#SUMMARY">Summary</a></td><td id="daEntry" ><a href="#libs">Included libraries</a></td><td id="daEntry" ><a href="#vardefs">Package variables</a></td><td id="daEntry" ><a href="#SYNOPSIS">Synopsis</a></td><td id="daEntry" ><a href="#DESCRIPTION">Description</a></td><td id="daEntry" ><a href="#General">General documentation</a></td><td id="daEntry" ><a href="#Methods">Methods</a></td></tr></table>
<div id="sep"></div>
<div id="descTitle">Summary</div>
<div id="descArea"><B>TFBS::Matrix::PFM</B> - class for raw position frequency matrix patterns</div>
<div id="sep"></div>
<a name="vardefs" id="vardefs"></a><div id="descTitle">Package variables</div>
<div id="descArea"><div id="libEntry">No package variables defined.</div>
</div>
<div id="sep"></div>
<div id="descTitle">Included modules</div>
<div id="descArea"><div id="libEntry"><span id="use">Bio::Root::Root</span> </div>
<div id="libEntry"><span id="use">Bio::SeqIO</span> </div>
<div id="libEntry"><span id="use">File::Temp</span> qw /:POSIX/ </div>
<div id="libEntry"><span id="use">PDL</span></div>
<div id="libEntry"><span id="use"><a href="../Matrix.html">TFBS::Matrix</a></span> </div>
<div id="libEntry"><span id="use"><a href="ICM.html">TFBS::Matrix::ICM</a></span> </div>
<div id="libEntry"><span id="use"><a href="PWM.html">TFBS::Matrix::PWM</a></span> </div>
<div id="libEntry"><span id="use">strict</span></div>
</div>
<div id="sep"></div>
<a name="libs" id="libs"></a>
<div id="descTitle">Inherit</div>
<div id="descArea"><span id="isa">Bio::Root::Root</span> <span id="isa"><a href="../Matrix.html">TFBS::Matrix</a></span> </div>
<div id="sep"></div>
<a name="SYNOPSIS" id="SYNOPSIS"></a>
<div id="descTitle">Synopsis</div>
<div id="descArea"><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* creating a <B>TFBS::Matrix::PFM</B> object manually:</div>&nbsp;&nbsp;&nbsp;&nbsp;<div id="podItemEntry">    my $matrixref = [ [ 12,  3,  0,  0,  4,  0 ],<br />		      [  0,  0,  0, 11,  7,  0 ],<br />		      [  0,  9, 12,  0,  0,  0 ],<br />		      [  0,  0,  0,  1,  1, 12 ]<br />		    ];	<br />    my $pfm = <B>TFBS::Matrix::PFM</B>-&gt;new(-matrix =&gt; $matrixref,<br />				     -name   =&gt; &quot;MyProfile&quot;,<br />				     -ID     =&gt; &quot;M0001&quot;<br />				    );<br />    # or<br /> <br />    my $matrixstring =<br />        &quot;12 3 0 0 4 0\n0 0 0 11 7 0\n0 9 12 0 0 0\n0 0 0 1 1 12&quot;;<br /> <br />    my $pfm = <B>TFBS::Matrix::PFM</B>-&gt;new(-matrixstring =&gt; $matrixstring,<br />				     -name   	   =&gt; &quot;MyProfile&quot;,<br />				     -ID           =&gt; &quot;M0001&quot;<br />				    );<br /> <br /> <br />=item * retrieving a TFBS::Matix::PFM object from a database:<br /></div><br />&nbsp;&nbsp;&nbsp;&nbsp;(See documentation of individual TFBS::DB::* modules to learn<br />how to connect to different types of pattern databases and <br />retrieve TFBS::Matrix::* objects from them.)<br />    <br />    my $db_obj = TFBS::DB::JASPAR2-&gt;new<br />		    (-connect =&gt; [&quot;dbi:mysql:JASPAR2:myhost&quot;,<br />				  &quot;myusername&quot;, &quot;mypassword&quot;]);<br />    my $pfm = $db_obj-&gt;get_Matrix_by_ID(&quot;M0001&quot;, &quot;PFM&quot;);<br />    # or<br />    my $pfm = $db_obj-&gt;get_Matrix_by_name(&quot;MyProfile&quot;, &quot;PFM&quot;);<br /><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* retrieving list of individual <B>TFBS::Matrix::PFM</B> objects</div>&nbsp;&nbsp;&nbsp;&nbsp;(See the <a href="../MatrixSet.html" target="urlWin" id="podUrl"><b>TFBS::MatrixSet</b></a> to learn how to create <br />objects for storage and manipulation of multiple matrices.)<br /><pre id="podParagraph">    my @pfm_list = $matrixset-&gt;all_patterns(-sort_by=&gt;&quot;name&quot;);<br /></pre><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* convert a raw frequency matrix to other matrix types:</div>&nbsp;&nbsp;&nbsp;&nbsp;<div id="podItemEntry">    my $pwm = $pfm-&gt;to_PWM(); # convert to position weight matrix<br />    my $icm = $icm-&gt;to_ICM(); # convert to information con<br /></div><br />
</div>
<div id="sep"></div>
<a name="DESCRIPTION" id="DESCRIPTION"></a>
<div id="descTitle">Description</div>
<div id="descArea"><B>TFBS::Matrix::PFM</B> is a class whose instances are objects representing<br />raw position frequency matrices (PFMs). A PFM is derived from N<br />nucleotide patterns of fixed size, e.g. the set of sequences<br /><pre id="podParagraph">    AGGCCT<br />    AAGCCT<br />    AGGCAT<br />    AAGCCT<br />    AAGCCT<br />    AGGCAT<br />    AGGCCT<br />    AGGCAT<br />    AGGTTT<br />    AGGCAT<br />    AGGCCT<br />    AGGCCT<br /></pre>will give the matrix:<br /><pre id="podParagraph">    A:[ 12  3  0  0  4  0 ]<br />    C:[  0  0  0 11  7  0 ]<br />    G:[  0  9 12  0  0  0 ]<br />    T:[  0  0  0  1  1 12 ]<br /></pre>which contains the count of each nucleotide at each position in the<br />sequence. (If you have a set of sequences as above and want to<br />create a <B>TFBS::Matrix::PFM</B> object out of them, have a look at<br />TFBS::PatternGen::SimplePFM module.)<br />PFMs are easily converted to other types of matrices, namely<br />information content matrices and position weight matrices. A<br /><B>TFBS::Matrix::PFM</B> object has the methods to_ICM and to_PWM which<br />do just that, returning a TFBS::Matrix::ICM and TFBS::Matrix::PWM<br />objects, respectively.
</div>
<div id="sep"></div>
<a name="Methods" id="Methods"></a>
<div id="descTitle">Methods</div>
<table id="methIndArea" width="100%" cellspacing="0"><tr><td id="methIndEntry">DESTROY</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE1">Code</a></td></tr>
<tr><td id="methIndEntry">_check_column_sums</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE2">Code</a></td></tr>
<tr><td id="methIndEntry">_is_bg_flat</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE3">Code</a></td></tr>
<tr><td id="methIndEntry">_schneider_Hnb_approx</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE4">Code</a></td></tr>
<tr><td id="methIndEntry">_schneider_Hnb_exact</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE5">Code</a></td></tr>
<tr><td id="methIndEntry">_schneider_Hnb_precomputed</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE6">Code</a></td></tr>
<tr><td id="methIndEntry">_schneider_correction</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE7">Code</a></td></tr>
<tr><td id="methIndEntry">add_PFM</td><td id="methIndEntry"><a href="#POD1">Description</a></td><td id="methIndEntry"><a href="#CODE8">Code</a></td></tr>
<tr><td id="methIndEntry">column_sum</td><td id="methIndEntry"><a href="#POD2">Description</a></td><td id="methIndEntry"><a href="#CODE9">Code</a></td></tr>
<tr><td id="methIndEntry">draw_logo</td><td id="methIndEntry"><a href="#POD3">Description</a></td><td id="methIndEntry"><a href="#CODE10">Code</a></td></tr>
<tr><td id="methIndEntry">new</td><td id="methIndEntry"><a href="#POD4">Description</a></td><td id="methIndEntry"><a href="#CODE11">Code</a></td></tr>
<tr><td id="methIndEntry">to_ICM</td><td id="methIndEntry"><a href="#POD5">Description</a></td><td id="methIndEntry"><a href="#CODE12">Code</a></td></tr>
<tr><td id="methIndEntry">to_PWM</td><td id="methIndEntry"><a href="#POD6">Description</a></td><td id="methIndEntry"><a href="#CODE13">Code</a></td></tr>
</table>
<div id="sep"></div>
<a name="MethDesc" id="MethDesc"></a>
<div id="mainTitle">Methods description</div>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_add_PFM" id="_pod_add_PFM"></a><a name="POD1" id="POD1"></a>add_PFM</td><td ><a href="#CODE8">code</a></td><td >&nbsp;&nbsp;&nbsp;&nbsp;</td><td ><a href="#POD2">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : add_PFM<br /> Usage   : $pfm-&gt;add_PFM($another_pfm)<br /> Function: adds the values of $pnother_pfm matrix to $pfm<br /> Returns : reference to the updated $pfm object<br /> Args    : a <B>TFBS::Matrix::PFM</B> object</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_column_sum" id="_pod_column_sum"></a><a name="POD2" id="POD2"></a>column_sum</td><td ><a href="#CODE9">code</a></td><td ><a href="#POD1">prev</a></td><td ><a href="#POD3">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : column_sum<br /> Usage   : my $nr_sequences = $pfm-&gt;column_sum()<br /> Function: calculates the sum of elements of one column<br />	   (the first one by default) which normally equals the<br />           number of sequences used to derive the PFM. <br /> Returns : the sum of elements of one column (an integer)<br /> Args    : columnn number (starting from 1), OPTIONAL - you DO NOT<br />           need to specify it unless you are dealing with a matrix</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_draw_logo" id="_pod_draw_logo"></a><a name="POD3" id="POD3"></a>draw_logo</td><td ><a href="#CODE10">code</a></td><td ><a href="#POD2">prev</a></td><td ><a href="#POD4">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : draw_logo<br /> Usage   : my $gd_image = $pfm-&gt;draw_logo()<br /> Function: draws a sequence logo; similar to the <br />           method in TFBS::Matrix::ICM, but can automatically calculate<br />           error bars for drawing<br /> Returns : a GD image object (see documentation of GD module)<br /> Args    : many; PFM-specific options are:<br />           -small_sample_correction # One of <br />                                    # &quot;Schneider&quot; (uses correction <br />                                    #   described by Schneider et al.<br />                                    #   (Schneider t et al. (1986) J.Biol.Chem.<br />                                    # &quot;pseudocounts&quot; - standard pseudocount <br />                                    #   correction,  more suitable for <br />                                    #   PFMs with large r column sums<br />                                    # If the parameter is ommited, small<br />                                    # sample correction is not applied<br />
           -draw_error_bars         # if true, adds error bars to each position
                                    # in the logo. To calculate the error bars,
                                    # it uses the -small_sample_connection
                                    # argument if explicitly set,  
                                    # or "Schneider" by default
For other args, see draw_logo entry in TFBS::Matrix::ICM documentation</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_new" id="_pod_new"></a><a name="POD4" id="POD4"></a>new</td><td ><a href="#CODE11">code</a></td><td ><a href="#POD3">prev</a></td><td ><a href="#POD5">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : new<br /> Usage   : my $pfm = <B>TFBS::Matrix::PFM</B>-&gt;new(%args)<br /> Function: constructor for the <B>TFBS::Matrix::PFM</B> object<br /> Returns : a new <B>TFBS::Matrix::PFM</B> object<br /> Args    : # you must specify either one of the following three:<br /> <br />	   -matrix,      # reference to an array of arrays of integers<br />	      #or<br />	   -matrixstring,# a string containing four lines<br />	                 # of tab- or space-delimited integers<br />	      #or<br />	   -matrixfile,  # the name of a file containing four lines<br />	                 # of tab- or space-delimited integers<br />	   #######<br /> <br />           -name,        # string, OPTIONAL<br />           -ID,          # string, OPTIONAL<br />           -class,       # string, OPTIONAL<br />           -tags         # an array reference, OPTIONAL<br />Warnings  : Warns if the matrix provided has columns with different<br />            sums. Columns with different sums contradict the usual<br />	    origin of matrix data and, unless you are absolutely sure<br />	    that column sums _should_ be different, it would be wise to<br />	    check your matrices.</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_to_ICM" id="_pod_to_ICM"></a><a name="POD5" id="POD5"></a>to_ICM</td><td ><a href="#CODE12">code</a></td><td ><a href="#POD4">prev</a></td><td ><a href="#POD6">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : to_ICM<br /> Usage   : my $icm = $pfm-&gt;to_ICM()<br /> Function: converts a raw frequency matrix (a <B>TFBS::Matrix::PFM</B> object)<br />	   to information content matrix. At present it assumes uniform<br />	   background distribution of nucleotide frequencies.<br /> Returns : a new TFBS::Matrix::ICM object<br /> Args    : -small_sample_correction # undef (default), 'schneider' or 'pseudocounts'<br /></pre>How a PFM is converted to ICM:<br /> <br />For a PFM element PFM[i,k], the probability without<br />pseudocounts is estimated to be simply<br /><pre id="podParagraph">  p[i,k] = PFM[i,k] / Z<br /></pre>where <br />- Z equals the column sum of the matrix i.e. the number of motifs used<br />to construct the PFM. <br />- i is the column index (position in the motif)<br />- k is the row index (a letter in the alphacer, here k is one of<br />(A,C,G,T)<br />Here is how one normally calculates the pseudocount-corrected positional<br />probability p'[i,j]:<br /><pre id="podParagraph">  p'[i,k] = (PFM[i,k] + 0.25*sqrt(Z)) / (Z + sqrt(Z))<br /></pre>0.25 is for the flat distribution of nucleotides, and sqrt(Z) is the<br />recommended pseudocount weight. In the general case,<br /><pre id="podParagraph">  p'[i,k] = (PFM[i,k] + q[k]*B) / (Z + B)<br /></pre>where q[k] is the background distribution of the letter (nucleotide) k,<br />and B an arbitrary pseudocount value or expression (for no pseudocounts<br />B=0).<br />For a given position i, the deviation from random distribution in bits<br />is calculated as (Baldi and Brunak eq. 1.9 (2ed) or 1.8 (1ed)):<br />- for an arbitrary alphabet of A letters:<br /><pre id="podParagraph">  D[i] = log2(A) + sum_for_all_k(p[i,k]*log2(p[i,k])) <br /></pre>- special case for nucleotides (A=4)<br /><pre id="podParagraph">  D[i] = 2 + sum_for_all_k(p[i,k]*log2(p[i,k]))  <br /></pre>D[i] equals the information content of the position i in the motif. To<br />calculate the entire ICM, you have to calculate the contrubution of each<br />nucleotide at a position i to D[i], i.e.<br />ICM[i,k] = p'[i,k] * D[i]</td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_to_PWM" id="_pod_to_PWM"></a><a name="POD6" id="POD6"></a>to_PWM</td><td ><a href="#CODE13">code</a></td><td ><a href="#POD5">prev</a></td><td ><a href="#POD7">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : to_PWM<br /> Usage   : my $pwm = $pfm-&gt;to_PWM()<br /> Function: converts a raw frequency matrix (a <B>TFBS::Matrix::PFM</B> object)<br />	   to position weight matrix. At present it assumes uniform<br />	   background distribution of nucleotide frequencies.<br /> Returns : a new TFBS::Matrix::PWM object<br /> Args    : none; in the future releases, it should be able to accept<br />	   a user defined background probability of the four<br />	   nucleotides</pre></td></tr></table>
<div id="sep"></div>
<a name="MethCode" id="MethCode"></a>
<div id="mainTitle">Methods code</div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE1" id="CODE1"></a>DESTROY</td><td >description</td><td >prev</td><td ><a href="#CODE2">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">DESTROY</span>
{<pre>    <span id="comment"># does nothing</span><br /><span id="braces">}</span>

<span id="comment">###############################################</span><br /><span id="comment"># UTILITY FUNCTIONS</span><br /><span id="comment">###############################################</span><br /></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE2" id="CODE2"></a>_check_column_sums</td><td >description</td><td ><a href="#CODE1">prev</a></td><td ><a href="#CODE3">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_check_column_sums</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$pdl</span> = <span id="var">$self</span>-&gt;<span id="method">pdl_matrix</span>-&gt;<span id="method">sever</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$rowsums</span> = <span id="var">$pdl</span>-&gt;<span id="method">xchg</span><span id="braces">(</span>0,1<span id="braces">)</span>-&gt;<span id="method">sumover</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$rowsums</span>-&gt;<span id="method">where</span><span id="braces">(</span><span id="var">$rowsums</span> != <span id="var">$rowsums</span>-&gt;<span id="method">slice</span><span id="braces">(</span>0<span id="braces">)</span><span id="braces">)</span>-&gt;<span id="method">getdim</span><span id="braces">(</span>0<span id="braces">)</span> &gt; 0<span id="braces">)</span>  <span id="braces">{</span>
	<span id="var">$self</span>-&gt;<span id="perlFunc">warn</span><span id="braces">(</span><span id="dqStr">"PFM for "</span>.<span id="var">$self</span>-&gt;<span id="braces">{</span>ID<span id="braces">}</span>.<span id="dqStr">" has unequal column sums"</span><span id="braces">)</span>;
    <span id="braces">}</span></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE3" id="CODE3"></a>_is_bg_flat</td><td >description</td><td ><a href="#CODE2">prev</a></td><td ><a href="#CODE4">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_is_bg_flat</span>
{<pre>    <span id="perlKey">my</span> <span id="var">@bg</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$ref</span> = <span id="perlFunc">shift</span>;
    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$other</span> <span id="braces">(</span><span id="var">@bg</span><span id="braces">)</span> <span id="braces">{</span>
	<span id="perlKey">return</span> 0 <span id="perlKey">unless</span> <span id="var">$ref</span>==<span id="var">$other</span>;
    <span id="braces">}</span>
    <span id="perlKey">return</span> 1;
<span id="braces">}</span>


1;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE4" id="CODE4"></a>_schneider_Hnb_approx</td><td >description</td><td ><a href="#CODE3">prev</a></td><td ><a href="#CODE5">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_schneider_Hnb_approx</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$colsum</span>,  <span id="var">$Hg</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">return</span> <span id="var">$Hg</span> -3<span id="regExp">/(2*log(2)*</span><span id="var">$colsum</span>);<br /></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE5" id="CODE5"></a>_schneider_Hnb_exact</td><td >description</td><td ><a href="#CODE4">prev</a></td><td ><a href="#CODE6">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_schneider_Hnb_exact</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$n</span>, <span id="var">$bg_pdl</span>, <span id="var">$rFactorial</span><span id="braces">)</span> = <span id="var">@_</span>;
    
    <span id="perlKey">my</span> <span id="var">$is_flat</span> = <span id="method">_is_bg_flat</span><span id="braces">(</span>list <span id="var">$bg_pdl</span><span id="braces">)</span>;
    <span id="perlKey">return</span> 0 <span id="perlKey">if</span> <span id="var">$n</span>==1;
<span id="comment">#    my @fctrl = (1);</span><br /><span id="comment">#    foreach my $i (1..max($pdl-&gt;transpose-&gt;sumover)) {</span><br /><span id="comment">#	$rFactorial-&gt;[$i] =$rFactorial-&gt;[$i-1] * $i;</span><br /><span id="comment">#    }</span><br /><span id="comment">#    my @colsum = list $pdl-&gt;transpose-&gt;sumover;</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$na</span>, <span id="var">$nc</span>, <span id="var">$ng</span>, <span id="var">$nt</span><span id="braces">)</span> = <span id="braces">(</span><span id="var">$n</span>, 0,0,0<span id="braces">)</span>;
<span id="comment">#    my $n = $colsum[0];</span><br />    <span id="perlKey">my</span> <span id="var">$E_Hnb</span>=0;
    <span id="perlKey">while</span> <span id="braces">(</span>1<span id="braces">)</span> <span id="braces">{</span>
	<span id="perlKey">my</span> <span id="var">$ns_pdl</span> = pdl <span id="braces">[</span><span id="var">$na</span>, <span id="var">$nc</span>, <span id="var">$ng</span>, <span id="var">$nt</span><span id="braces">]</span>;
	<span id="perlKey">my</span> <span id="var">$Pnb</span> = <span id="braces">(</span><span id="var">$rFactorial</span>-&gt;<span id="braces">[</span><span id="var">$n</span><span id="braces">]</span>
		   <span id="regExp">/<br />		   (</span><span id="var">$rFactorial</span><span id="regExp">-&gt;[</span><span id="var">$na</span><span id="regExp">]<br />		    *</span><span id="var">$rFactorial</span><span id="regExp">-&gt;[</span><span id="var">$nc</span><span id="regExp">]<br />		    *</span><span id="var">$rFactorial</span><span id="regExp">-&gt;[</span><span id="var">$ng</span><span id="regExp">]<br />		    *</span><span id="var">$rFactorial</span><span id="regExp">-&gt;[</span><span id="var">$nt</span><span id="regExp">])<br />		   )*prod(</span><span id="var">$bg_pdl</span><span id="regExp">-&gt;transpose**pdl(</span><span id="var">$na</span><span id="regExp">, </span><span id="var">$nc</span><span id="regExp">, </span><span id="var">$ng</span><span id="regExp">, </span><span id="var">$nt</span>));<br />	<span id="perlKey">my</span> <span id="var">$Hnb</span> = -1 * <span id="method">sum</span><span id="braces">(</span><span id="braces">(</span><span id="var">$ns_pdl</span><span id="regExp">/</span><span id="var">$n</span><span id="regExp">)*log2(</span><span id="var">$ns_pdl</span><span id="regExp">/</span><span id="var">$n</span><span id="braces">)</span>-&gt;<span id="method">badmask</span><span id="braces">(</span>0<span id="braces">)</span><span id="braces">)</span>;
	<span id="var">$E_Hnb</span> += <span id="var">$Pnb</span>*<span id="var">$Hnb</span>;
	

	<span id="perlKey">if</span> <span id="braces">(</span><span id="var">$nt</span><span id="braces">)</span> <span id="braces">{</span>
	    <span id="perlKey">if</span>    <span id="braces">(</span><span id="var">$ng</span><span id="braces">)</span> <span id="braces">{</span> <span id="var">$ng</span>--; <span id="var">$nt</span>++, <span id="braces">}</span>
	    <span id="perlKey">elsif</span> <span id="braces">(</span><span id="var">$nc</span><span id="braces">)</span> <span id="braces">{</span> <span id="var">$nc</span>--; <span id="var">$ng</span> = <span id="var">$nt</span>+1; <span id="var">$nt</span> = 0; <span id="braces">}</span>
	    <span id="perlKey">elsif</span> <span id="braces">(</span><span id="var">$na</span><span id="braces">)</span> <span id="braces">{</span> <span id="var">$na</span>--; <span id="var">$nc</span> = <span id="var">$nt</span>+1; <span id="var">$nt</span> = 0; <span id="braces">}</span>
	    <span id="perlKey">else</span>        <span id="braces">{</span> <span id="perlKey">last</span>; <span id="braces">}</span>
	<span id="braces">}</span>
	<span id="perlKey">else</span> <span id="braces">{</span>
	    <span id="perlKey">if</span>    <span id="braces">(</span><span id="var">$ng</span><span id="braces">)</span> <span id="braces">{</span> <span id="var">$ng</span>--; <span id="var">$nt</span>++, <span id="braces">}</span>
	    <span id="perlKey">elsif</span> <span id="braces">(</span><span id="var">$nc</span><span id="braces">)</span> <span id="braces">{</span> <span id="var">$nc</span>--; <span id="var">$ng</span>++; <span id="braces">}</span>
	    <span id="perlKey">else</span>        <span id="braces">{</span> <span id="var">$na</span>--; <span id="var">$nc</span>++; <span id="var">$nt</span> = 0; <span id="braces">}</span>
	<span id="braces">}</span>
    <span id="braces">}</span>
    <span id="perlKey">return</span> <span id="var">$E_Hnb</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE6" id="CODE6"></a>_schneider_Hnb_precomputed</td><td >description</td><td ><a href="#CODE5">prev</a></td><td ><a href="#CODE7">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_schneider_Hnb_precomputed</span>
{<pre>    <span id="perlKey">my</span> <span id="var">$i</span> = <span id="perlFunc">shift</span>;
    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$i</span>&lt;1 or <span id="var">$i</span>&gt;30<span id="braces">)</span>  <span id="braces">{</span> 
	<span id="perlFunc">die</span> <span id="dqStr">"Precomputed params only available for colsums 1 to 30)"</span>;
    <span id="braces">}</span>
    <span id="perlKey">my</span> <span id="var">@precomputed</span> = 
	<span id="braces">(</span>
	 0, <span id="comment"># 1</span><br />	 0.75, <span id="comment"># 2</span><br />	 1.11090234442608, <span id="comment"># 3</span><br />	 1.32398964833609, <span id="comment"># 4</span><br />	 1.46290503577084, <span id="comment"># 5</span><br />	 1.55922640783176, <span id="comment"># 6</span><br />	 1.62900374746751, <span id="comment"># 7</span><br />	 1.68128673969433, <span id="comment"># 8</span><br />	 1.7215504663901, <span id="comment"># 9</span><br />	 1.75328193031842, <span id="comment"># 10</span><br />	 1.77879136615189, <span id="comment"># 11</span><br />	 1.79965855531179, <span id="comment"># 12</span><br />	 1.81699248819687, <span id="comment"># 13</span><br />	 1.8315892710679, <span id="comment"># 14</span><br />	 1.84403166371213, <span id="comment"># 15</span><br />	 1.85475371994775, <span id="comment"># 16</span><br />	 1.86408383599326, <span id="comment"># 17</span><br />	 1.87227404728809, <span id="comment"># 18</span><br />	 1.87952034817826, <span id="comment"># 19</span><br />	 1.88597702438913, <span id="comment"># 20</span><br />	 1.89176691659196, <span id="comment"># 21</span><br />	 1.89698887214968, <span id="comment"># 22</span><br />	 1.90172322434865, <span id="comment"># 23</span><br />	 1.90603586889234, <span id="comment"># 24</span><br />	 1.90998133028897, <span id="comment"># 25</span><br />	 1.91360509239859, <span id="comment"># 26</span><br />	 1.91694538711761, <span id="comment"># 27</span><br />	 1.92003457997914, <span id="comment"># 28</span><br />	 1.92290025302018, <span id="comment"># 29</span><br />	 1.92556605820924, <span id="comment"># 30</span><br />	 <span id="braces">)</span>;
    <span id="perlKey">return</span> <span id="var">$precomputed</span><span id="braces">[</span><span id="var">$i</span>-1<span id="braces">]</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE7" id="CODE7"></a>_schneider_correction</td><td >description</td><td ><a href="#CODE6">prev</a></td><td ><a href="#CODE8">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_schneider_correction</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$pdl</span>, <span id="var">$bg_pdl</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$Hg</span> = -sum <span id="braces">(</span><span id="var">$bg_pdl</span>*<span id="method">log2</span><span id="braces">(</span><span id="var">$bg_pdl</span><span id="braces">)</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">@Hnbs</span>, <span id="var">%saved_Hnb</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$is_flat</span> = <span id="method">_is_bg_flat</span><span id="braces">(</span>list <span id="var">$bg_pdl</span><span id="braces">)</span>;
    
    <span id="perlKey">my</span> <span id="var">@factorials</span> = <span id="braces">(</span>1<span id="braces">)</span>;
    <span id="perlKey">if</span> <span id="braces">(</span><span id="method">min</span><span id="braces">(</span><span id="var">$pdl</span>-&gt;<span id="method">transpose</span>-&gt;<span id="method">sumover</span><span id="braces">)</span> &lt;= EXACT_SCHNEIDER_MAX<span id="braces">)</span> <span id="braces">{</span>
	<span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$i</span> <span id="braces">(</span>1..<span id="method">max</span><span id="braces">(</span><span id="var">$pdl</span>-&gt;<span id="method">transpose</span>-&gt;<span id="method">sumover</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
	    <span id="var">$factorials</span><span id="braces">[</span><span id="var">$i</span><span id="braces">]</span> =<span id="var">$factorials</span><span id="braces">[</span><span id="var">$i</span>-1<span id="braces">]</span> * <span id="var">$i</span>;
	<span id="braces">}</span>
    <span id="braces">}</span>
    <span id="perlKey">my</span> <span id="var">@column_sums</span> = list <span id="var">$pdl</span>-&gt;<span id="method">transpose</span>-&gt;<span id="method">sumover</span>;
    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$colsum</span> <span id="braces">(</span><span id="var">@column_sums</span><span id="braces">)</span>  <span id="braces">{</span>
	<span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">defined</span><span id="braces">(</span><span id="var">$saved_Hnb</span><span id="braces">{</span><span id="var">$colsum</span><span id="braces">}</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
	    <span id="perlFunc">push</span> <span id="var">@Hnbs</span>, <span id="var">$saved_Hnb</span><span id="braces">{</span><span id="var">$colsum</span><span id="braces">}</span>;
	<span id="braces">}</span>
	<span id="perlKey">else</span>  <span id="braces">{</span>
	    <span id="perlKey">my</span> <span id="var">$Hnb</span>;
	    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$colsum</span> &lt;= EXACT_SCHNEIDER_MAX<span id="braces">)</span>  <span id="braces">{</span>
		<span id="perlKey">if</span> <span id="braces">(</span><span id="var">$is_flat</span><span id="braces">)</span>  <span id="braces">{</span>
		    <span id="var">$Hnb</span> = <span id="method">_schneider_Hnb_precomputed</span><span id="braces">(</span><span id="var">$colsum</span><span id="braces">)</span>;
		<span id="braces">}</span>
		<span id="perlKey">else</span> <span id="braces">{</span>
		    <span id="var">$Hnb</span> = <span id="method">_schneider_Hnb_exact</span><span id="braces">(</span><span id="var">$colsum</span>, <span id="var">$bg_pdl</span>,\@ 
						factorials<span id="braces">)</span>;
		<span id="braces">}</span>
	    <span id="braces">}</span>
	    <span id="perlKey">else</span> <span id="braces">{</span>
		<span id="var">$Hnb</span> = <span id="method">_schneider_Hnb_approx</span><span id="braces">(</span><span id="var">$colsum</span>, <span id="var">$Hg</span><span id="braces">)</span>;

	    <span id="braces">}</span>
	    <span id="var">$saved_Hnb</span><span id="braces">{</span><span id="var">$colsum</span><span id="braces">}</span> = <span id="var">$Hnb</span>;
	    <span id="perlFunc">push</span> <span id="var">@Hnbs</span>, <span id="var">$Hnb</span>;
	<span id="braces">}</span>
    <span id="braces">}</span>
    <span id="perlKey">return</span> -<span id="var">$Hg</span> + <span id="method">pdl</span><span id="braces">(</span><span id="var">@Hnbs</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE8" id="CODE8"></a>add_PFM</td><td ><a href="#POD1">description</a></td><td ><a href="#CODE7">prev</a></td><td ><a href="#CODE9">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">add_PFM</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$pfm</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="var">$pfm</span>-&gt;<span id="method">isa</span><span id="braces">(</span><span id="dqStr">"TFBS::Matrix::PFM"</span><span id="braces">)</span> 
	or <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span><span id="dqStr">"Wrong or no argument passed to add_PFM"</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$sum</span> = <span id="var">$self</span>-&gt;<span id="method">pdl_matrix</span> + <span id="var">$pfm</span>-&gt;<span id="method">pdl_matrix</span>;
    <span id="var">$self</span>-&gt;<span id="method">set_matrix</span><span id="braces">(</span><span id="var">$sum</span><span id="braces">)</span>;
    <span id="perlKey">return</span> <span id="var">$self</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE9" id="CODE9"></a>column_sum</td><td ><a href="#POD2">description</a></td><td ><a href="#CODE8">prev</a></td><td ><a href="#CODE10">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">column_sum</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$column</span><span id="braces">)</span> = <span id="braces">(</span><span id="var">@_</span>,1<span id="braces">)</span>;
    <span id="perlKey">return</span> <span id="var">$self</span>-&gt;<span id="method">pdl_matrix</span>-&gt;<span id="method">slice</span><span id="braces">(</span><span id="var">$column</span>-1<span id="braces">)</span>-&gt;<span id="method">sum</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE10" id="CODE10"></a>draw_logo</td><td ><a href="#POD3">description</a></td><td ><a href="#CODE9">prev</a></td><td ><a href="#CODE11">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">draw_logo</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">%args</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-draw_error_bars'</span><span id="braces">}</span><span id="braces">)</span>  <span id="braces">{</span>
	<span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-small_sample_correction'</span><span id="braces">}</span> ||= <span id="dqStr">"Schneider"</span>; <span id="comment"># default Schneider</span><br />
	<span id="perlKey">my</span> <span id="var">$pdl_no_correction</span> = 
	    <span id="var">$self</span>-&gt;<span id="method">to_ICM</span><span id="braces">(</span><span id="braces">)</span>
	    -&gt;<span id="method">pdl_matrix</span>-&gt;<span id="method">transpose</span>-&gt;<span id="method">sumover</span>;
	<span id="perlKey">my</span> <span id="var">$pdl_with_correction</span> = 
	    <span id="var">$self</span>-&gt;<span id="method">to_ICM</span><span id="braces">(</span>-small_sample_correction 
			  =&gt; <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-small_sample_correction'</span><span id="braces">}</span><span id="braces">)</span>
	    -&gt;<span id="method">pdl_matrix</span>-&gt;<span id="method">transpose</span>-&gt;<span id="method">sumover</span>;

	<span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-error_bars'</span><span id="braces">}</span> = 
	    <span id="braces">[</span>list <span id="braces">(</span><span id="var">$pdl_no_correction</span> - <span id="var">$pdl_with_correction</span><span id="braces">)</span><span id="braces">]</span>;
	    
    <span id="braces">}</span>
    <span id="var">$self</span>-&gt;<span id="method">to_ICM</span><span id="braces">(</span><span id="var">%args</span><span id="braces">)</span>-&gt;<span id="method">draw_logo</span><span id="braces">(</span><span id="var">%args</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE11" id="CODE11"></a>new</td><td ><a href="#POD4">description</a></td><td ><a href="#CODE10">prev</a></td><td ><a href="#CODE12">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">new</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$class</span>, <span id="var">%args</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$matrix</span> = <span id="module"><a href="../Matrix.html">TFBS::Matrix</a></span>-&gt;<span id="perlKey">new</span><span id="braces">(</span><span id="var">%args</span>, -matrixtype=&gt;<span id="dqStr">"PFM"</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$self</span> = <span id="perlFunc">bless</span> <span id="var">$matrix</span>, <span id="perlFunc">ref</span><span id="braces">(</span><span id="var">$class</span><span id="braces">)</span> || <span id="var">$class</span>;
    <span id="var">$self</span>-&gt;<span id="method">_check_column_sums</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">return</span> <span id="var">$self</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE12" id="CODE12"></a>to_ICM</td><td ><a href="#POD5">description</a></td><td ><a href="#CODE11">prev</a></td><td ><a href="#CODE13">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">to_ICM</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">%args</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$bg</span> = <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-bg_probabilities'</span> <span id="braces">}</span> || <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'bg_probabilities'</span><span id="braces">}</span><span id="braces">)</span>;



    <span id="comment"># compute ICM</span><br />    
    <span id="perlKey">my</span> <span id="var">$bg_pdl</span> = 
	transpose pdl <span id="braces">(</span><span id="var">$bg</span>-&gt;<span id="braces">{</span><span id="sqStr">'A'</span><span id="braces">}</span>, <span id="var">$bg</span>-&gt;<span id="braces">{</span><span id="sqStr">'C'</span><span id="braces">}</span>, <span id="var">$bg</span>-&gt;<span id="braces">{</span><span id="sqStr">'G'</span><span id="braces">}</span>, <span id="var">$bg</span>-&gt;<span id="braces">{</span><span id="sqStr">'T'</span><span id="braces">}</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$Z_pdl</span> = <span id="var">$self</span>-&gt;<span id="method">pdl_matrix</span>-&gt;<span id="method">xchg</span><span id="braces">(</span>0,1<span id="braces">)</span>-&gt;<span id="method">sumover</span>;

    <span id="comment"># pseudocount calculation </span><br />
    <span id="perlKey">my</span> <span id="var">$B</span> = 0; 
    <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">lc</span><span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-small_sample_correction'</span><span id="braces">}</span> or <span id="dqStr">""</span><span id="braces">)</span> <span id="perlKey">eq</span> <span id="dqStr">"pseudocounts"</span><span id="braces">)</span> <span id="braces">{</span>

	<span id="var">$B</span> = <span id="perlFunc">sqrt</span><span id="braces">(</span><span id="var">$Z_pdl</span><span id="braces">)</span>;
    <span id="braces">}</span>
    <span id="perlKey">else</span> <span id="braces">{</span>
	<span id="var">$B</span> = 0;   	<span id="comment"># do not add pseudocounts</span><br />    <span id="braces">}</span>

    
    <span id="perlKey">my</span> <span id="var">$p_pdl</span> = <span id="braces">(</span><span id="var">$self</span>-&gt;<span id="method">pdl_matrix</span> +<span id="var">$bg_pdl</span>*<span id="var">$B</span><span id="braces">)</span><span id="regExp">/ (</span><span id="var">$Z_pdl</span><span id="regExp"> + </span><span id="var">$B</span>);<br />    <span id="perlKey">my</span> <span id="var">$plog_pdl</span> = <span id="var">$p_pdl</span>*<span id="method">log2</span><span id="braces">(</span><span id="var">$p_pdl</span><span id="braces">)</span>;
    <span id="var">$plog_pdl</span> = <span id="var">$plog_pdl</span>-&gt;<span id="method">badmask</span><span id="braces">(</span>0<span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$D_pdl</span> = 2 + <span id="var">$plog_pdl</span>-&gt;<span id="method">xchg</span><span id="braces">(</span>0,1<span id="braces">)</span>-&gt;<span id="method">sumover</span>;
    <span id="perlKey">my</span> <span id="var">$ic_pdl</span> = <span id="var">$p_pdl</span> * <span id="var">$D_pdl</span>;


    <span id="comment"># apply Schneider correction if requested</span><br />
    <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">lc</span><span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-small_sample_correction'</span><span id="braces">}</span> or <span id="dqStr">""</span><span id="braces">)</span> <span id="perlKey">eq</span> <span id="dqStr">"schneider"</span><span id="braces">)</span>  <span id="braces">{</span>
	<span id="perlKey">my</span> <span id="var">$columnsum_pdl</span> = <span id="var">$ic_pdl</span>-&gt;<span id="method">transpose</span>-&gt;<span id="method">sumover</span>;
	<span id="perlKey">my</span> <span id="var">$corrected_columnsum_pdl</span> = 
	    <span id="var">$columnsum_pdl</span> 
	    + _schneider_correction <span id="braces">(</span><span id="var">$self</span>-&gt;<span id="method">pdl_matrix</span>, <span id="var">$bg_pdl</span><span id="braces">)</span>;
	<span id="var">$ic_pdl</span> *= <span id="var">$corrected_columnsum_pdl</span><span id="regExp">/</span><span id="var">$columnsum_pdl</span>;<br />    <span id="braces">}</span>
 
    <span id="comment"># construct and return an ICM object</span><br />
    <span id="perlKey">my</span> <span id="var">$ICM</span> = <span id="module"><a href="ICM.html">TFBS::Matrix::ICM</a></span>-&gt;<span id="perlKey">new</span>
	<span id="braces">(</span> <span id="braces">(</span><span id="perlFunc">map</span> <span id="braces">{</span><span id="braces">(</span><span id="dqStr">"-<span id="var">$_</span>"</span> =&gt; <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="var">$_</span><span id="braces">}</span><span id="braces">)</span><span id="braces">}</span> <span id="perlFunc">keys</span> %$self<span id="braces">)</span>,
	  -tags =&gt;\% <span id="braces">{</span> <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">}</span>, 
	  -bg_probabilities =&gt;\% <span id="braces">{</span> <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'bg_probabilities'</span><span id="braces">}</span><span id="braces">}</span>, 
	  -matrix    =&gt; <span id="var">$ic_pdl</span>
	<span id="braces">)</span>;
    <span id="perlKey">return</span> <span id="var">$ICM</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE13" id="CODE13"></a>to_PWM</td><td ><a href="#POD6">description</a></td><td ><a href="#CODE12">prev</a></td><td >next</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">to_PWM</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">%args</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$bg</span> = <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-bg_probabilities'</span> <span id="braces">}</span> || <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'bg_probabilities'</span><span id="braces">}</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$bg_pdl</span> = 
	transpose pdl <span id="braces">(</span><span id="var">$bg</span>-&gt;<span id="braces">{</span><span id="sqStr">'A'</span><span id="braces">}</span>, <span id="var">$bg</span>-&gt;<span id="braces">{</span><span id="sqStr">'C'</span><span id="braces">}</span>, <span id="var">$bg</span>-&gt;<span id="braces">{</span><span id="sqStr">'G'</span><span id="braces">}</span>, <span id="var">$bg</span>-&gt;<span id="braces">{</span><span id="sqStr">'T'</span><span id="braces">}</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$nseqs</span> = <span id="var">$self</span>-&gt;<span id="method">pdl_matrix</span>-&gt;<span id="method">sum</span> <span id="regExp">/ </span><span id="var">$self</span>-&gt;length;<br />    <span id="perlKey">my</span> <span id="var">$q_pdl</span> = <span id="braces">(</span><span id="var">$self</span>-&gt;<span id="method">pdl_matrix</span> +<span id="var">$bg_pdl</span>*<span id="perlFunc">sqrt</span><span id="braces">(</span><span id="var">$nseqs</span><span id="braces">)</span><span id="braces">)</span>
		 <span id="regExp">/ <br />		(</span><span id="var">$nseqs</span><span id="regExp"> + sqrt(</span><span id="var">$nseqs</span>));<br />    <span id="perlKey">my</span> <span id="var">$pwm_pdl</span> = <span id="method">log2</span><span id="braces">(</span>4*<span id="var">$q_pdl</span><span id="braces">)</span>;

    <span id="perlKey">my</span> <span id="var">$PWM</span> = <span id="module"><a href="PWM.html">TFBS::Matrix::PWM</a></span>-&gt;<span id="perlKey">new</span>
	<span id="braces">(</span> <span id="braces">(</span><span id="perlFunc">map</span> <span id="braces">{</span><span id="braces">(</span><span id="dqStr">"-<span id="var">$_</span>"</span>, <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="var">$_</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">}</span> <span id="perlFunc">keys</span> %$self<span id="braces">)</span>,
          <span id="comment"># do not want tags to point to the same arrayref as in $self:</span><br />	  -tags =&gt;\% <span id="braces">{</span> <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">}</span>, 
	  -bg_probabilities =&gt;\% <span id="braces">{</span> <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'bg_probabilities'</span><span id="braces">}</span><span id="braces">}</span>, 
	  -matrix    =&gt; <span id="var">$pwm_pdl</span>
	<span id="braces">)</span>;
    <span id="perlKey">return</span> <span id="var">$PWM</span>;</pre>}</td></div>
<div id="sep"></div>
<a name="General" id="General"></a>
<div id="mainTitle">General documentation</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_FEEDBACK" id="_pod_FEEDBACK"></a>FEEDBACK</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">Please send bug reports and other comments to the author.</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_AUTHOR - Boris Lenhard" id="_pod_AUTHOR - Boris Lenhard"></a>AUTHOR - Boris Lenhard</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">Boris Lenhard &lt;Boris.Lenhard@cgb.ki.se&gt;</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_APPENDIX" id="_pod_APPENDIX"></a>APPENDIX</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">The rest of the documentation details each of the object<br />methods. Internal methods are preceded with an underscore.</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_name" id="_pod_name"></a>name</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea"></div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_ID" id="_pod_ID"></a>ID</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea"></div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_class" id="_pod_class"></a>class</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea"></div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_matrix" id="_pod_matrix"></a>matrix</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea"></div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_length" id="_pod_length"></a>length</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea"></div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_revcom" id="_pod_revcom"></a>revcom</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea"></div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_rawprint" id="_pod_rawprint"></a>rawprint</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea"></div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_prettyprint" id="_pod_prettyprint"></a>prettyprint</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">The above methods are common to all matrix objects. Please consult<br /><a href="../Matrix.html" target="urlWin" id="podUrl"><b>TFBS::Matrix</b></a> to find out how to use them.</div>
<div id="sep"></div>
</body>
</html>
