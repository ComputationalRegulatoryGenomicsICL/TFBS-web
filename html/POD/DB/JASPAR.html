<head>
<!-- Generated by perlmod2www.pl -->
<title>
JASPAR7 documentation.
</title>
<link rel="stylesheet" type="text/css" href="../perl.css">
</head>
<body bgcolor="white">
<span id="modRootPath">TFBS::DB</span>
<span id="modName">JASPAR7</span>
<div id="sep"></div>
<a name="TOP" id="TOP"></a>
<table id="daArea" width="100%"><tr><td id="daEntry" ><a href="#SUMMARY">Summary</a></td><td id="daEntry" ><a href="#libs">Included libraries</a></td><td id="daEntry" ><a href="#vardefs">Package variables</a></td><td id="daEntry" ><a href="#SYNOPSIS">Synopsis</a></td><td id="daEntry" ><a href="#DESCRIPTION">Description</a></td><td id="daEntry" ><a href="#General">General documentation</a></td><td id="daEntry" ><a href="#Methods">Methods</a></td></tr></table>
<div id="sep"></div>
<div id="descTitle">Summary</div>
<div id="descArea">TFBS::DB::JASPAR - interface to MySQL relational database of pattern matrices. Currently status: experimental.</div>
<div id="sep"></div>
<a name="vardefs" id="vardefs"></a><div id="descTitle">Package variables</div>
<div id="descArea"><div id="libEntry">No package variables defined.</div>
</div>
<div id="sep"></div>
<div id="descTitle">Included modules</div>
<div id="descArea"><div id="libEntry"><span id="use">Bio::Root::Root</span> </div>
<div id="libEntry"><span id="use">DBI</span></div>
<div id="libEntry"><span id="use"><a href="../Matrix/ICM.html">TFBS::Matrix::ICM</a></span> </div>
<div id="libEntry"><span id="use"><a href="../Matrix/PFM.html">TFBS::Matrix::PFM</a></span> </div>
<div id="libEntry"><span id="use"><a href="../Matrix/PWM.html">TFBS::Matrix::PWM</a></span> </div>
<div id="libEntry"><span id="use"><a href="../MatrixSet.html">TFBS::MatrixSet</a></span> </div>
<div id="libEntry"><span id="use"><a href="../TFFM.html">TFBS::TFFM</a></span> </div>
</div>
<div id="sep"></div>
<a name="libs" id="libs"></a>
<div id="descTitle">Inherit</div>
<div id="descArea"><span id="isa">Bio::Root::Root</span> <span id="isa"><a href="../DB.html">TFBS::DB</a></span> </div>
<div id="sep"></div>
<a name="SYNOPSIS" id="SYNOPSIS"></a>
<div id="descTitle">Synopsis</div>
<div id="descArea"><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* creating a database object by connecting to the existing JASPAR6-type database</div>&nbsp;&nbsp;&nbsp;&nbsp;<div id="podItemEntry">    my $db = TFBS::DB::JASPAR6-&gt;connect(&quot;dbi:mysql:JASPAR6:myhost&quot;,<br />                    &quot;myusername&quot;,<br />                    &quot;mypassword&quot;);<br /></div><br /><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* retrieving a TFBS::Matrix::* object from the database</div>&nbsp;&nbsp;&nbsp;&nbsp;<div id="podItemEntry">    # retrieving a PFM by ID<br />    my $pfm = $db-&gt;get_Matrix_by_ID('M0079','PFM');<br /> <br />    #retrieving a PWM by name<br />    my $pwm = $db-&gt;get_Matrix_by_name('NF-kappaB', 'PWM');<br /></div><br /><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* retrieving a set of matrices as a TFBS::MatrixSet object according to various criteria</div><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* creating a new JASPAR6-type database named MYJASPAR6:</div><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* storing a matrix in the database (currently only PFMs):</div>&nbsp;&nbsp;&nbsp;&nbsp;<div id="podItemEntry">    #let $pfm is a TFBS::Matrix::PFM object<br />    $db-&gt;store_Matrix($pfm);<br /></div><br />
</div>
<div id="sep"></div>
<a name="DESCRIPTION" id="DESCRIPTION"></a>
<div id="descTitle">Description</div>
<div id="descArea">TFBS::DB::JASPAR is a read/write database interface module that<br />retrieves and stores TFBS::Matrix::* and TFBS::MatrixSet<br />objects in a relational database. The interface is nearly identical<br />to the JASPAR2 and JASPAR4 interface, while the underlying data model is different
</div>
<div id="sep"></div>
<a name="Methods" id="Methods"></a>
<div id="descTitle">Methods</div>
<table id="methIndArea" width="100%" cellspacing="0"><tr><td id="methIndEntry">DESTROY</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE1">Code</a></td></tr>
<tr><td id="methIndEntry">_create_tables</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE2">Code</a></td></tr>
<tr><td id="methIndEntry">_get_IDlist_by_query</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE3">Code</a></td></tr>
<tr><td id="methIndEntry">_get_Matrix_by_int_id</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE4">Code</a></td></tr>
<tr><td id="methIndEntry">_get_TFFM_by_int_id</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE5">Code</a></td></tr>
<tr><td id="methIndEntry">_get_TFFM_internal_id</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE6">Code</a></td></tr>
<tr><td id="methIndEntry">_get_TFFM_latest_version</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE7">Code</a></td></tr>
<tr><td id="methIndEntry">_get_internal_id</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE8">Code</a></td></tr>
<tr><td id="methIndEntry">_get_latest_version</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE9">Code</a></td></tr>
<tr><td id="methIndEntry">_get_matrixstring</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE10">Code</a></td></tr>
<tr><td id="methIndEntry">_is_TFFM_latest_version</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE11">Code</a></td></tr>
<tr><td id="methIndEntry">_is_latest_version</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE12">Code</a></td></tr>
<tr><td id="methIndEntry">_new</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE13">Code</a></td></tr>
<tr><td id="methIndEntry">_store_matrix</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE14">Code</a></td></tr>
<tr><td id="methIndEntry">_store_matrix_acc</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE15">Code</a></td></tr>
<tr><td id="methIndEntry">_store_matrix_annotation</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE16">Code</a></td></tr>
<tr><td id="methIndEntry">_store_matrix_data</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE17">Code</a></td></tr>
<tr><td id="methIndEntry">_store_matrix_species</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE18">Code</a></td></tr>
<tr><td id="methIndEntry">connect</td><td id="methIndEntry"><a href="#POD1">Description</a></td><td id="methIndEntry"><a href="#CODE19">Code</a></td></tr>
<tr><td id="methIndEntry">create</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE20">Code</a></td></tr>
<tr><td id="methIndEntry">dbh</td><td id="methIndEntry"><a href="#POD2">Description</a></td><td id="methIndEntry"><a href="#CODE21">Code</a></td></tr>
<tr><td id="methIndEntry">delete_Matrix_having_ID</td><td id="methIndEntry"><a href="#POD3">Description</a></td><td id="methIndEntry"><a href="#CODE22">Code</a></td></tr>
<tr><td id="methIndEntry">get_MatrixSet</td><td id="methIndEntry"><a href="#POD4">Description</a></td><td id="methIndEntry"><a href="#CODE23">Code</a></td></tr>
<tr><td id="methIndEntry">get_Matrix_by_ID</td><td id="methIndEntry"><a href="#POD5">Description</a></td><td id="methIndEntry"><a href="#CODE24">Code</a></td></tr>
<tr><td id="methIndEntry">get_Matrix_by_name</td><td id="methIndEntry"><a href="#POD6">Description</a></td><td id="methIndEntry"><a href="#CODE25">Code</a></td></tr>
<tr><td id="methIndEntry">get_TFFM_by_ID</td><td id="methIndEntry"><a href="#POD7">Description</a></td><td id="methIndEntry"><a href="#CODE26">Code</a></td></tr>
<tr><td id="methIndEntry">get_TFFM_by_matrix_ID</td><td id="methIndEntry"><a href="#POD8">Description</a></td><td id="methIndEntry"><a href="#CODE27">Code</a></td></tr>
<tr><td id="methIndEntry">get_TFFM_by_name</td><td id="methIndEntry"><a href="#POD9">Description</a></td><td id="methIndEntry"><a href="#CODE28">Code</a></td></tr>
<tr><td id="methIndEntry">new</td><td id="methIndEntry"><a href="#POD10">Description</a></td><td id="methIndEntry"><a href="#CODE29">Code</a></td></tr>
<tr><td id="methIndEntry">store_Matrix</td><td id="methIndEntry"><a href="#POD11">Description</a></td><td id="methIndEntry"><a href="#CODE30">Code</a></td></tr>
<tr><td id="methIndEntry">store_MatrixSet</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE31">Code</a></td></tr>
</table>
<div id="sep"></div>
<a name="MethDesc" id="MethDesc"></a>
<div id="mainTitle">Methods description</div>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_connect" id="_pod_connect"></a><a name="POD1" id="POD1"></a>connect</td><td ><a href="#CODE19">code</a></td><td >&nbsp;&nbsp;&nbsp;&nbsp;</td><td ><a href="#POD2">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : connect<br /> Usage   : my $db =<br />        TFBS::DB::JASPAR6-&gt;connect(&quot;dbi:mysql:DATABASENAME:HOSTNAME&quot;,<br />                    &quot;USERNAME&quot;,<br />                    &quot;PASSWORD&quot;);<br /> Function: connects to the existing JASPAR6-type database and<br />       returns a database object that interfaces the database<br /> Returns : a TFBS::DB::JASPAR6 object<br /> Args    : a standard database connection triplet<br />       (&quot;dbi:mysql:DATABASENAME:HOSTNAME&quot;,  &quot;USERNAME&quot;, &quot;PASSWORD&quot;)<br />       In place of DATABASENAME, HOSTNAME, USERNAME and PASSWORD,<br />       use the actual values. PASSWORD and USERNAME might be<br />       optional, depending on the user's acces permissions for<br />       the database server.</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_dbh" id="_pod_dbh"></a><a name="POD2" id="POD2"></a>dbh</td><td ><a href="#CODE21">code</a></td><td ><a href="#POD1">prev</a></td><td ><a href="#POD3">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : dbh<br /> Usage   : my $dbh = $db-&gt;dbh();<br />       $dbh-&gt;do(&quot;UPDATE matrix_data SET name='ADD1' WHERE NAME='SREBP2'&quot;);<br /> Function: returns the DBI database handle of the MySQL database<br />       interfaced by $db; THIS IS USED FOR WRITING NEW METHODS<br />       FOR DIRECT RELATIONAL DATABASE MANIPULATION - if you<br />       have write access AND do not know what you are doing,<br />       you can severely  corrupt the data<br />       For documentation about database handle methods, see <a href="#_pod_DBI">DBI</a><br /> Returns : the database (DBI) handle of the MySQL JASPAR2-type<br />       relational database associated with the TFBS::DB::JASPAR2<br />       object<br /> Args    : none</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_delete_Matrix_having_ID" id="_pod_delete_Matrix_having_ID"></a><a name="POD3" id="POD3"></a>delete_Matrix_having_ID</td><td ><a href="#CODE22">code</a></td><td ><a href="#POD2">prev</a></td><td ><a href="#POD4">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : delete_Matrix_having_ID<br /> Usage   : $db-&gt;delete_Matrix_with_ID('M00045.1');<br /> Function: Deletes the matrix having the given ID from the database<br /> Returns : 0 on success; $@ contents on failure<br />       (this is too C-ike and may change in future versions)<br /> Args    : (ID)<br />       A string. Has to be a matrix ID with version suffix in JASPAR6.<br /> Comment : Yeah, yeah, 'delete_Matrix_having_ID' is a stupid name<br />       for a method, but at least it should be obviuos what it does.</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_get_MatrixSet" id="_pod_get_MatrixSet"></a><a name="POD4" id="POD4"></a>get_MatrixSet</td><td ><a href="#CODE23">code</a></td><td ><a href="#POD3">prev</a></td><td ><a href="#POD5">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : get_MatrixSet<br /> Usage   : my $matrixset = $db-&gt;get_MatrixSet(%args);<br /> Function: fetches matrix data under for all matrices in the database<br />       matching criteria defined by the named arguments<br />       and returns a TFBS::MatrixSet object<br /> Returns : a TFBS::MatrixSet object<br /> Args    : This method accepts named arguments, corresponding to arbitrary tags, and also some utility functions<br />           Note that this is different from JASPAR2 and to some extent JASPAR4. As any tag is supported for<br />           database storage, any tag can be used for information retrieval.<br />           Additionally, arguments as 'name','class','collection' can be used (even though<br />           they are not tags.<br />           Per default, only the last version of the matrix is given. The only way to get older matrices out of this <br />           to use an array of IDs with actual versions like MA0001.1, or set the argyment -all_versions=&gt;1, in which  case you get all versions for each stable ID<br />                                           <br />
                                           
           
      Examples include:
 Fundamental matrix features
    -all # gives absolutely all matrix entry, regardless of versin and collection. Only useful for backup situations and sanity checks. Takes precedence over everything else
        
        -ID        # a reference to an array of stable IDs (strings), with or without version, as above. tyically something like "MA0001.2" . Takes precedence over everything salve -all       
 -name      # a reference to an array of
               #  transcription factor names (string). Will only take latest version. NOT a preferred way to access since names change over time
       -collection # a string corresponding to a JASPAR collection. Per default CORE      
       -all_versions # gives all matrix versions that fit with rest of criteria, including obsolete ones.Is off per default. 
             # Typical usage is in combiation with a stable IDs withou versions to get all versinos of a particular matrix      
          Typical tag queries:
    These can be either a string or a reference to an array of strings. If it is an arrau it will be interpreted as as an "or"s statement                                      
       -class    # a reference to an array of
               #  structural class names (strings)
       -species    # a reference to an array of
               #   NCBI Taxonomy IDs (integers)
       -taxgroup  # a reference to an array of
               #  higher taxonomic categories (string)
                                           
Computed features of the matrices     
       -min_ic     # float, minimum total information content
               #   of the matrix. 
    -matrixtype    #string describing type of matrix to retrieve. If left out, the format
                        will revert to the database format, which is PFM.
</pre>The arguments that expect list references are used in database<br />query formulation: elements within lists are combined with 'OR'<br />operators, and the lists of different types with 'AND'. For example,<br /><pre id="podParagraph">    my $matrixset = $db-&gt;(-class =&gt; ['TRP_CLUSTER', 'FORKHEAD'],<br />              -species =&gt; ['Homo sapiens', 'Mus musculus'],<br />              );<br /></pre>gives a set of TFBS::Matrix::PFM objects (given that the matrix models are stored as such)<br /> whose (structural clas is 'TRP_CLUSTER' OR'FORKHEAD') AND (the species they are derived<br /> from is 'Homo sapiens'OR 'Mus musculus').<br />As above, unless IDs with version numbers are used, only one matrix per stable ID wil be returned: the matrix with the highest version number <br />The -min_ic filter is applied after the query in the sense that the<br />matrices profiles with total information content less than specified<br />are not included in the set.</td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_get_Matrix_by_ID" id="_pod_get_Matrix_by_ID"></a><a name="POD5" id="POD5"></a>get_Matrix_by_ID</td><td ><a href="#CODE24">code</a></td><td ><a href="#POD4">prev</a></td><td ><a href="#POD6">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : get_Matrix_by_ID<br /> Usage   : my $pfm = $db-&gt;get_Matrix_by_ID('M00034', 'PFM');<br /> Function: fetches matrix data under the given ID from the<br />           database and returns a TFBS::Matrix::* object<br /> Returns : a TFBS::Matrix::* object; the exact type of the<br />       object depending on what form the matrix is stored<br />       in the database (PFM is default)<br /> Args    : (Matrix_ID)<br />       Matrix_ID id is a string which refers to the stable <br />           JASPAR ID (usually something like &quot;MA0001&quot;) with <br />           or without version numbers. &quot;MA0001&quot; will give the <br />           latest version on MA0001, while &quot;MA0001.2&quot; will give<br />           the second version, if existing. Warnings will be <br />           given for non-existing matrices.</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_get_Matrix_by_name" id="_pod_get_Matrix_by_name"></a><a name="POD6" id="POD6"></a>get_Matrix_by_name</td><td ><a href="#CODE25">code</a></td><td ><a href="#POD5">prev</a></td><td ><a href="#POD7">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : get_Matrix_by_name<br /> Usage   : my $pfm = $db-&gt;get_Matrix_by_name('HNF-1');<br /> Function: fetches matrix data under the given name from the<br />       database and returns a TFBS::Matrix::* object<br /> Returns : a TFBS::Matrix::* object; the exact type of the object<br />       depending on what form the matrix object was stored in<br />       the database (default PFM))<br /> Args    : (Matrix_name)<br />       <br /> Warning : According to the current JASPAR6 data model, name is<br />       not necessarily a unique identifier. Also, names change <br />           over time. <br />           In the case where<br />       there are several matrices with the same name in the<br />       database, the function fetches the first one and prints<br />       a warning on STDERR. You've been warned.<br />           Some matrices have multiple versions. The function will <br />           return the latest version. For specific versions, use <br />           get_Matrix_by_ID($ID.$version)</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_get_TFFM_by_ID" id="_pod_get_TFFM_by_ID"></a><a name="POD7" id="POD7"></a>get_TFFM_by_ID</td><td ><a href="#CODE26">code</a></td><td ><a href="#POD6">prev</a></td><td ><a href="#POD8">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : get_TFFM_by_ID<br /> Usage   : my $tffm = $db-&gt;get_TFFM_by_ID('TFFM0001');<br /> Function: fetches TFFM data under the given ID from the<br />           database and returns a TFBS::TFFM object.<br /> Returns : a TFBS::TFFM object<br /> Args    : TFFM ID<br />           TFFM_ID id is a string which refers to the stable <br />           JASPAR TFFM ID (usually something like &quot;TFFM0001&quot;) with <br />           or without version numbers. &quot;TFFM0001&quot; will give the <br />           latest version on TFFM0001, while &quot;TFFM0001.2&quot; will give<br />           the second version, if existing. Warnings will be <br />           given for non-existing TFFMs.</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_get_TFFM_by_matrix_ID" id="_pod_get_TFFM_by_matrix_ID"></a><a name="POD8" id="POD8"></a>get_TFFM_by_matrix_ID</td><td ><a href="#CODE27">code</a></td><td ><a href="#POD7">prev</a></td><td ><a href="#POD9">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : get_TFFM_by_matrix_ID<br /> Usage   : my $tffm = $db-&gt;get_TFFM_by_matrix_ID('MA0001.1');<br /> Function: fetches TFFM data under related to the given matrix ID from the<br />           database and returns a TFBS::TFFM object.<br /> Returns : a TFBS::TFFM object<br /> Args    : Matrix ID<br />           Matrix ID id is a string which refers to the stable <br />           JASPAR matrix ID (usually something like &quot;MA0148.3&quot;).<br />           Note that this *should* be a fully qualified matrix ID (with<br />           version) as the TFFM is related to a specific version of a<br />           matrix. If no matrix version is given, the latest version of<br />           the matrix is retrieved and the corresponding TFFM for that<br />           matrix version is retrieved (could be no TFFM).<br />           In general only a few matrices have associated TFFMs so in many<br />           cases no TFFM will be retrieved. In these cases we return undef.</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_get_TFFM_by_name" id="_pod_get_TFFM_by_name"></a><a name="POD9" id="POD9"></a>get_TFFM_by_name</td><td ><a href="#CODE28">code</a></td><td ><a href="#POD8">prev</a></td><td ><a href="#POD10">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : get_TFFM_by_name<br /> Usage   : my $tffm = $db-&gt;get_TFFM_by_name('HNF-1');<br /> Function: fetches TFFM data under the given name from the<br />           database and returns a TFBS::TFFM object<br /> Returns : a TFBS::TFFM object<br /> Args    : A TFFM name - the name of the transcription factor for which<br />           this TFFM was modelled. This is the same as the name of the<br />           matrix used to train the TFFM.<br />       <br /> Warning : According to the current JASPAR data model, name is<br />           not necessarily a unique identifier. Also, names change <br />           over time. <br />           In the case where there are several TFFMs with the same name in<br />           the database, the function fetches the first one and prints<br />           a warning on STDERR. You've been warned.<br />           Some matrices have multiple versions. The function will <br />           return the latest version. For specific versions, use <br />           get_TFFM_by_ID($ID.$version)</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_new" id="_pod_new"></a><a name="POD10" id="POD10"></a>new</td><td ><a href="#CODE29">code</a></td><td ><a href="#POD9">prev</a></td><td ><a href="#POD11">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : new<br /> Usage   : DEPRECATED - for backward compatibility only<br />           Use connect() or create() instead</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_store_Matrix" id="_pod_store_Matrix"></a><a name="POD11" id="POD11"></a>store_Matrix</td><td ><a href="#CODE30">code</a></td><td ><a href="#POD10">prev</a></td><td ><a href="#POD12">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : store_Matrix<br /> Usage   : $db-&gt;store_Matrix($matrixobject);<br /> Function: Stores the contents of a TFBS::Matrix::DB object in the database<br /> Returns : 0 on success; $@ contents on failure<br />       (this is too C-like and may change in future versions)<br /> Args    : (PFM_object)<br />       A TFBS::Matrix::PFM, FBS::Matrix::PWM or FBS::Matrix::ICM object.<br />       PFM object are recommended to use, as they are eaily converted to<br />       other formats<br />    # might have to give version and collection here<br /> Comment : this is an experimental method that is not 100% bulletproof;<br />       use at your own risk</pre></td></tr></table>
<div id="sep"></div>
<a name="MethCode" id="MethCode"></a>
<div id="mainTitle">Methods code</div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE1" id="CODE1"></a>DESTROY</td><td >description</td><td >prev</td><td ><a href="#CODE2">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">DESTROY</span>
{<pre>    <span id="comment">#OK</span><br />    <span id="var">$_</span><span id="braces">[</span>0<span id="braces">]</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">disconnect</span><span id="braces">(</span><span id="braces">)</span> <span id="perlKey">if</span> <span id="var">$_</span><span id="braces">[</span>0<span id="braces">]</span>-&gt;<span id="method">dbh</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE2" id="CODE2"></a>_create_tables</td><td >description</td><td ><a href="#CODE1">prev</a></td><td ><a href="#CODE3">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_create_tables</span>
{<pre>    <span id="comment"># DONE                        # utility function</span><br />
    <span id="comment"># If you want to change the databse schema,</span><br />    <span id="comment"># this is the right place to do it</span><br />
    <span id="comment">#</span><br />    <span id="comment"># Changed the primary key constraint on MATRIX_ANNOTATION to a simple</span><br />    <span id="comment"># key. There are tags for which we do want to have multiple entries, e.g.</span><br />    <span id="comment"># in the case of a dimer profiles the two TFs making up the dimer may</span><br />    <span id="comment"># have a different TF class and/or family therefore we need to store more</span><br />    <span id="comment"># than one record with tag 'class' or tag 'family' for the same matrix</span><br />    <span id="comment"># ID.</span><br />    <span id="comment">#</span><br />    <span id="comment"># Also added key on ID to MATRIX_PROTEIN and MATRIX_SPECIES which seemed</span><br />    <span id="comment"># to be missing.</span><br />    <span id="comment">#</span><br />    <span id="comment"># We may also want to set the charset/collation to utf8/utf8_unicode_ci</span><br />    <span id="comment"># either at the DB level or to the individual table definitions</span><br />    <span id="comment"># (particularly for the MATRIX_ANNOTATION table) to handle non-Latin</span><br />    <span id="comment"># characters correctly.</span><br />    <span id="comment">#</span><br />    <span id="comment"># DJA 2015/08/26</span><br />    <span id="comment">#</span><br />
    <span id="perlKey">my</span> <span id="var">$dbh</span> = <span id="perlFunc">shift</span>;
    <span id="perlKey">my</span> <span id="var">@queries</span> = <span id="braces">(</span>
        <span id="perlFunc">q</span><span id="sqStr">!!<br />            CREATE TABLE MATRIX (<br />            ID INT(11) NOT NULL AUTO_INCREMENT,<br />            COLLECTION VARCHAR (16) DEFAULT '',<br />            BASE_ID VARCHAR (16) DEFAULT '' NOT NULL ,<br />            VERSION TINYINT(4) DEFAULT 1  NOT NULL ,<br />            NAME VARCHAR (255) DEFAULT '' NOT NULL, <br />            PRIMARY KEY (ID))<br />        !</span>,

        <span id="perlFunc">q</span><span id="sqStr">!!<br />            CREATE TABLE MATRIX_DATA (<br />            ID INT(11) NOT NULL,<br />            row VARCHAR(1) NOT NULL, <br />            col TINYINT(3) UNSIGNED NOT NULL, <br />            val float(10,3), <br />            PRIMARY KEY (ID, row, col))<br />        !</span>,

        <span id="perlFunc">q</span><span id="sqStr">!!<br />            CREATE TABLE MATRIX_ANNOTATION (<br />            ID INT(11) NOT NULL,<br />            TAG VARCHAR(255) DEFAULT '' NOT NULL,<br />            VAL varchar(255) DEFAULT '',<br />            KEY (ID, TAG))<br />        !</span>,

        <span id="perlFunc">q</span><span id="sqStr">!!<br />            CREATE TABLE MATRIX_SPECIES (<br />            ID INT(11) NOT NULL,<br />            TAX_ID VARCHAR(255) DEFAULT '' NOT NULL<br />            KEY (ID))<br />        !</span>,

        <span id="perlFunc">q</span><span id="sqStr">!!<br />            CREATE TABLE MATRIX_PROTEIN (<br />            ID INT(11) NOT NULL,<br />            ACC VARCHAR(255) DEFAULT '' NOT NULL<br />            KEY (ID))<br />        !</span>,

        <span id="perlFunc">q</span><span id="sqStr">!!<br />            CREATE TABLE TFFM (<br />            ID int(11) NOT NULL auto_increment,<br />            BASE_ID varchar(16) NOT NULL,<br />            VERSION tinyint(4) NOT NULL,<br />            MATRIX_BASE_ID varchar(16) NOT NULL,<br />            MATRIX_VERSION tinyint(4) NOT NULL,<br />            NAME varchar(255) NOT NULL,<br />            LOG_P_1ST_ORDER float default NULL,<br />            LOG_P_DETAILED float default NULL,<br />            EXPERIMENT_NAME varchar(255) default NULL,<br />            PRIMARY KEY  (ID),<br />            KEY BASE_ID (BASE_ID, VERSION),<br />            KEY MATRIX_BASE_ID (MATRIX_BASE_ID, MATRIX_VERSION)<br />        !</span>
    <span id="braces">)</span>;

    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$query</span> <span id="braces">(</span><span id="var">@queries</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$dbh</span>-&gt;<span id="perlKey">do</span><span id="braces">(</span><span id="var">$query</span><span id="braces">)</span>
            or <span id="perlFunc">die</span><span id="braces">(</span><span id="dqStr">"Error executing the query: $query\n"</span><span id="braces">)</span>;
    <span id="braces">}</span></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE3" id="CODE3"></a>_get_IDlist_by_query</td><td >description</td><td ><a href="#CODE2">prev</a></td><td ><a href="#CODE4">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_get_IDlist_by_query</span>
{<pre>    <span id="comment">#needs  cleanup. NOT for the faint-hearted.    my ($self, %args) = @_;</span><br />
    <span id="perlFunc">warn</span> <span id="sqStr">'_get_IDlist_by_query | $self || '</span>, <span id="var">$self</span>;
    <span id="perlFunc">warn</span> <span id="sqStr">'_get_IDlist_by_query | %args || '</span>, <span id="var">%args</span>;

    <span id="comment"># called by get_MatrixSet</span><br />    <span id="comment">#  warn $args{&quot;-collection&quot;};</span><br />
    <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-collection'</span><span id="braces">}</span> = <span id="sqStr">'CORE'</span> <span id="perlKey">unless</span> <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-collection'</span><span id="braces">}</span>;

<span id="comment"># returns a set of internal IDs with whicj to get the actual matrices</span><br /><span id="comment"># current idea:</span><br /><span id="comment"># 1: first catch non-tag things like collection, name and version, species</span><br /><span id="comment"># makw one query for these if they are named and check the IDs for &quot;latest&quot; unless requested not to.</span><br /><span id="comment"># these are AND statements</span><br /><span id="comment"># 2:then do the rest on tag level:</span><br /><span id="comment"># to be able to do this  with actual and tattemnet innthe tag table, we do an inner join query, which is kept separate just for convenice</span><br /><span id="comment"># we then intersect 1 and 2</span><br /><span id="comment"># 3: then do matrix-based features such as ic, with, number of sites etc, for the surviving matrices. This shold happen in the get_matrixset part</span><br />
    <span id="perlKey">my</span> <span id="var">@int_ids_to_return</span>;

    <span id="comment">## jsp6 - autosearch</span><br />    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-auto'</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="comment">##my $sth=$self-&gt;dbh-&gt;prepare (qq!SELECT ID FROM MATRIX WHERE BASE_ID=?!);</span><br />        <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
            <span id="perlFunc">qq</span><span id="dqStr">!!SELECT U.ID FROM (SELECT ID, BASE_ID as VAL FROM MATRIX UNION ALL SELECT ID, NAME as VAL FROM MATRIX UNION ALL SELECT ID, ACC as VAL FROM MATRIX_PROTEIN UNION ALL SELECT ID, TAX_ID as VAL FROM MATRIX_SPECIES UNION ALL SELECT ID, SPECIES as VAL FROM MATRIX_SPECIES,TAX WHERE MATRIX_SPECIES.TAX_ID=TAX.TAX_ID UNION ALL SELECT ID, NAME as VAL FROM MATRIX_SPECIES,TAX_EXT WHERE MATRIX_SPECIES.TAX_ID=TAX_EXT.TAX_ID AND MATRIX_SPECIES.TAX_ID=9606 UNION ALL SELECT ID, VAL as VAL FROM MATRIX_ANNOTATION) AS U WHERE LOWER(`VAL`) LIKE LOWER(?)!</span>
        <span id="braces">)</span>;

        <span id="perlFunc">warn</span> <span id="sqStr">'_get_IDlist_by_query | $sth || '</span>, <span id="var">$sth</span>;

        <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$stID</span> <span id="braces">(</span>@<span id="braces">{</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-auto'</span><span id="braces">}</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlFunc">warn</span> <span id="sqStr">'_get_IDlist_by_query | $stID || '</span>, <span id="var">$stID</span>;
            <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$stable_ID</span>, <span id="var">$version</span><span id="braces">)</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\./</span>, <span id="var">$stID</span><span id="braces">)</span>
                ;    <span id="comment"># ignore vesion here, this is a stupidity filter</span><br />                     <span id="comment">#$sth-&gt;execute($stable_ID);</span><br />            <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="dqStr">"%"</span> . <span id="var">$stable_ID</span> . <span id="dqStr">"%"</span><span id="braces">)</span>;
            <span id="perlKey">while</span> <span id="braces">(</span><span id="perlKey">my</span> <span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="perlFunc">warn</span> <span id="sqStr">'_get_IDlist_by_query | $int_id || '</span>, <span id="var">$int_id</span>;
                <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@int_ids_to_return</span>, <span id="var">$int_id</span><span id="braces">)</span>;
            <span id="braces">}</span>
        <span id="braces">}</span>
        <span id="perlKey">return</span>\@ int_ids_to_return;
    <span id="braces">}</span>

<span id="comment"># should redo so that matrix_annotation queries are separate, with an intersect in the end</span><br /><span id="comment">#special case 1: get ALL matrices. Higher priority than all</span><br />
    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-all'</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span><span id="perlFunc">qq</span><span id="dqStr">!!SELECT ID FROM MATRIX!</span><span id="braces">)</span>;
        <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;
        <span id="perlKey">my</span> <span id="var">@a</span>;
        <span id="perlKey">while</span> <span id="braces">(</span><span id="perlKey">my</span> <span id="braces">(</span><span id="var">$i</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@a</span>, <span id="var">$i</span><span id="braces">)</span>;
        <span id="braces">}</span>
        <span id="perlKey">return</span>\@ a;
    <span id="braces">}</span>

<span id="comment"># ids: special case2 which is has higher priority than any other except the above (ignore all others</span><br />    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-ID'</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
<span id="comment"># these might be either stable IDs or stableid.version.</span><br /><span id="comment"># if just stable ID and if all_versions==1, take all versions, otherwise the latest</span><br />        <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span>-all_versions<span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
                <span id="perlFunc">qq</span><span id="dqStr">!!SELECT ID FROM MATRIX WHERE BASE_ID=?!</span><span id="braces">)</span>;
            <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$stID</span> <span id="braces">(</span>@<span id="braces">{</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-ID'</span><span id="braces">}</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$stable_ID</span>, <span id="var">$version</span><span id="braces">)</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\./</span>, <span id="var">$stID</span><span id="braces">)</span>
                    ;    <span id="comment"># ignore vesion here, this is a stupidity filter</span><br />                <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="var">$stable_ID</span><span id="braces">)</span>;
                <span id="perlKey">while</span> <span id="braces">(</span><span id="perlKey">my</span> <span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
                    <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@int_ids_to_return</span>, <span id="var">$int_id</span><span id="braces">)</span>;
                <span id="braces">}</span>
            <span id="braces">}</span>
        <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>    <span id="comment"># only the lastest version, or the requested version</span><br />            <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$stID</span> <span id="braces">(</span>@<span id="braces">{</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-ID'</span><span id="braces">}</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="comment">#warn $stID;</span><br />                <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$stable_ID</span>, <span id="var">$version</span><span id="braces">)</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\./</span>, <span id="var">$stID</span><span id="braces">)</span>;
                <span id="var">$version</span> = <span id="var">$self</span>-&gt;<span id="method">_get_latest_version</span><span id="braces">(</span><span id="var">$stable_ID</span><span id="braces">)</span>
                    <span id="perlKey">unless</span> <span id="var">$version</span>;
                <span id="perlKey">my</span> <span id="var">$int_id</span> = <span id="var">$self</span>-&gt;<span id="method">_get_internal_id</span><span id="braces">(</span><span id="var">$stable_ID</span>, <span id="var">$version</span><span id="braces">)</span>;
                <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@int_ids_to_return</span>, <span id="var">$int_id</span><span id="braces">)</span> <span id="perlKey">if</span> <span id="var">$int_id</span>;
            <span id="braces">}</span>
        <span id="braces">}</span>
        <span id="perlKey">return</span>\@ int_ids_to_return;
    <span id="braces">}</span>

    <span id="perlKey">my</span> <span id="var">@tables</span> = <span id="braces">(</span><span id="dqStr">"MATRIX M"</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">@and</span>;

    <span id="comment"># in matrix table: collection,</span><br />    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span>-collection<span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">my</span> <span id="var">$q</span> = <span id="sqStr">' (COLLECTION='</span>;
        <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">ref</span> <span id="var">$args</span><span id="braces">{</span>-collection<span id="braces">}</span> <span id="perlKey">eq</span> <span id="dqStr">"ARRAY"</span><span id="braces">)</span> <span id="braces">{</span>    <span id="comment"># so, possibly several</span><br />            <span id="perlKey">my</span> <span id="var">@a</span>;
            <span id="perlKey">foreach</span> <span id="braces">(</span>@<span id="braces">{</span><span id="var">$args</span><span id="braces">{</span>-collection<span id="braces">}</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@a</span>, <span id="dqStr">"\&quot;$_\&quot;"</span><span id="braces">)</span>;
            <span id="braces">}</span>
            <span id="var">$q</span> .= <span id="perlFunc">join</span><span id="braces">(</span><span id="dqStr">" or COLLECTION="</span>, <span id="var">@a</span><span id="braces">)</span>;
        <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>                                    <span id="comment"># just one - typical usage</span><br />            <span id="var">$q</span> .= <span id="dqStr">"\&quot;<span id="var">$args</span>{-collection}\&quot;"</span>;
        <span id="braces">}</span>
        <span id="var">$q</span> .= <span id="dqStr">" )  "</span>;
        <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@and</span>, <span id="var">$q</span><span id="braces">)</span>;
    <span id="braces">}</span>

<span id="comment"># in matrix table: names. Is something that is basically only used from the web interface</span><br /><span id="comment"># typically used by the get_matrix_by_name function instead</span><br />
    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span>-name<span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">my</span> <span id="var">$q</span> = <span id="sqStr">' (NAME='</span>;
        <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">ref</span> <span id="var">$args</span><span id="braces">{</span>-name<span id="braces">}</span> <span id="perlKey">eq</span> <span id="dqStr">"ARRAY"</span><span id="braces">)</span> <span id="braces">{</span>    <span id="comment"># so, possibly several</span><br />            <span id="perlKey">my</span> <span id="var">@a</span>;
            <span id="perlKey">foreach</span> <span id="braces">(</span>@<span id="braces">{</span><span id="var">$args</span><span id="braces">{</span>-name<span id="braces">}</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@a</span>, <span id="dqStr">"\&quot;$_\&quot;"</span><span id="braces">)</span>;
            <span id="braces">}</span>
            <span id="var">$q</span> .= <span id="perlFunc">join</span><span id="braces">(</span><span id="dqStr">" or NAME="</span>, <span id="var">@a</span><span id="braces">)</span>;
        <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>                              <span id="comment"># just one - typical usage</span><br />            <span id="var">$q</span> .= <span id="dqStr">"\&quot;<span id="var">$args</span>{-name}\&quot;"</span>;
        <span id="braces">}</span>
        <span id="var">$q</span> .= <span id="dqStr">" )  "</span>;
        <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@and</span>, <span id="var">$q</span><span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="comment"># in species table: tax.id: possibly many species with OR in between</span><br />    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span>-species<span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@tables</span>, <span id="dqStr">"MATRIX_SPECIES S"</span><span id="braces">)</span>;
        <span id="perlKey">my</span> <span id="var">$q</span> = <span id="dqStr">" M.ID=S.ID and (TAX_ID= "</span>;
        <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">ref</span> <span id="var">$args</span><span id="braces">{</span>-species<span id="braces">}</span> <span id="perlKey">eq</span> <span id="dqStr">"ARRAY"</span><span id="braces">)</span> <span id="braces">{</span>    <span id="comment"># so, possibly several</span><br />            <span id="perlKey">my</span> <span id="var">@a</span>;
            <span id="perlKey">foreach</span> <span id="braces">(</span>@<span id="braces">{</span><span id="var">$args</span><span id="braces">{</span>-species<span id="braces">}</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@a</span>, <span id="dqStr">"\&quot;$_\&quot;"</span><span id="braces">)</span>;
            <span id="braces">}</span>
            <span id="var">$q</span> .= <span id="perlFunc">join</span><span id="braces">(</span><span id="dqStr">" or TAX_ID="</span>, <span id="var">@a</span><span id="braces">)</span>;
        <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>                                 <span id="comment"># just one - typical usage</span><br />            <span id="var">$q</span> .= <span id="dqStr">"=\&quot;<span id="var">$args</span>{-species}\&quot;"</span>;
        <span id="braces">}</span>
        <span id="var">$q</span> .= <span id="dqStr">") "</span>;
        <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@and</span>, <span id="var">$q</span><span id="braces">)</span>;
    <span id="braces">}</span>

<span id="comment"># TAG_BASED</span><br /><span id="comment"># an internal join query:should be able to handle up to 26 tags-value combos with ANDS in between</span><br /><span id="comment"># Very ugly code ahead:</span><br />
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">@inner_tables</span>, <span id="var">@internal_ands1</span>, <span id="var">@internal_ands2</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$int_counter</span> = 0;              <span id="comment"># for keeping track of  names;</span><br />    <span id="perlKey">my</span> <span id="var">@alpha</span>       = <span id="braces">(</span><span id="dqStr">"a"</span> .. <span id="dqStr">"z"</span><span id="braces">)</span>;

    <span id="perlKey">my</span> <span id="var">%arrayref</span>;
    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$key</span> <span id="braces">(</span><span id="perlFunc">keys</span> <span id="var">%args</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$key</span> <span id="perlKey">eq</span> <span id="dqStr">"-min_ic"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$key</span> <span id="perlKey">eq</span> <span id="dqStr">"-matrixtype"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$key</span> <span id="perlKey">eq</span> <span id="dqStr">"-species"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$key</span> <span id="perlKey">eq</span> <span id="dqStr">"-collection"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$key</span> <span id="perlKey">eq</span> <span id="dqStr">"-all_versions"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$key</span> <span id="perlKey">eq</span> <span id="dqStr">"-all"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$key</span> <span id="perlKey">eq</span> <span id="dqStr">"-ID"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$key</span> <span id="perlKey">eq</span> <span id="dqStr">"-length"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$key</span> <span id="perlKey">eq</span> <span id="dqStr">"-name"</span>;
        <span id="perlKey">my</span> <span id="var">$oldkey</span> = <span id="var">$key</span>;
        <span id="var">$key</span> =~ <span id="regExp">s/-//</span>;
        <span id="var">$arrayref</span><span id="braces">{</span><span id="var">$key</span><span id="braces">}</span> = <span id="var">$args</span><span id="braces">{</span><span id="var">$oldkey</span><span id="braces">}</span>;
    <span id="braces">}</span>
    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">%arrayref</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="comment"># get an internal name for the table</span><br />        <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@internal_ands2</span>, <span id="dqStr">" M.ID=a.ID "</span><span id="braces">)</span>;
        <span id="perlKey">my</span> <span id="var">@a</span>;
        <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$key</span> <span id="braces">(</span><span id="perlFunc">keys</span> <span id="var">%arrayref</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlKey">my</span> <span id="var">$tname</span> = <span id="var">$alpha</span><span id="braces">[</span><span id="var">$int_counter</span><span id="braces">]</span>;
            <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@inner_tables</span>, <span id="dqStr">"MATRIX_ANNOTATION <span id="var">$tname</span>"</span><span id="braces">)</span>;
            <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@internal_ands1</span>,
                      <span id="var">$alpha</span><span id="braces">[</span><span id="var">$int_counter</span><span id="braces">]</span> . <span id="dqStr">".ID="</span>
                    . <span id="var">$alpha</span><span id="braces">[</span><span id="var">$int_counter</span> - 1<span id="braces">]</span> . <span id="dqStr">".ID"</span><span id="braces">)</span>
                <span id="perlKey">unless</span> <span id="var">$int_counter</span> == 0;
            <span id="var">$int_counter</span>++;
<span id="comment"># is the thing aupplied an array reference in inteslf: make an &quot;or&quot; query from that</span><br />            <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">ref</span> <span id="var">$arrayref</span><span id="braces">{</span><span id="var">$key</span><span id="braces">}</span> <span id="perlKey">eq</span> <span id="dqStr">"ARRAY"</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="perlKey">my</span> <span id="var">@b</span>;
                <span id="perlKey">foreach</span> <span id="braces">(</span>@<span id="braces">{</span><span id="var">$arrayref</span><span id="braces">{</span><span id="var">$key</span><span id="braces">}</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
                    <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@b</span>, <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">quote</span><span id="braces">(</span><span id="var">$_</span><span id="braces">)</span><span id="braces">)</span>;
                <span id="braces">}</span>
                <span id="perlKey">my</span> <span id="var">$orstring</span> = <span id="perlFunc">join</span><span id="braces">(</span><span id="dqStr">" or <span id="var">$tname</span>.VAL="</span>, <span id="var">@b</span><span id="braces">)</span>;
                <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@a</span>, <span id="dqStr">"(<span id="var">$tname</span>.TAG=\&quot;$key\&quot; AND (<span id="var">$tname</span>.VAL=<span id="var">$orstring</span>))"</span><span id="braces">)</span>;
            <span id="braces">}</span>
            <span id="comment">#or not</span><br />            <span id="perlKey">else</span> <span id="braces">{</span>
                <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@a</span>,
                    <span id="dqStr">"(<span id="var">$tname</span>.TAG=\&quot;$key\&quot; AND <span id="var">$tname</span>.VAL=\&quot;<span id="var">$arrayref</span>{<span id="var">$key</span>}\&quot;)"</span>
                <span id="braces">)</span>;
            <span id="braces">}</span>
        <span id="braces">}</span>
        <span id="perlKey">my</span> <span id="var">$s</span> = <span id="dqStr">" ( "</span> . <span id="perlFunc">join</span><span id="braces">(</span><span id="dqStr">" AND "</span>, <span id="var">@a</span><span id="braces">)</span> . <span id="dqStr">")"</span>;
        <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@internal_ands2</span>, <span id="var">$s</span><span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="perlKey">my</span> <span id="var">$qq</span> =
          <span id="dqStr">"SELECT distinct(M.ID) from "</span>
        . <span id="perlFunc">join</span><span id="braces">(</span><span id="dqStr">","</span>, <span id="braces">(</span><span id="var">@tables</span>, <span id="var">@inner_tables</span><span id="braces">)</span><span id="braces">)</span>
        . <span id="dqStr">" where"</span>
        . <span id="perlFunc">join</span><span id="braces">(</span><span id="dqStr">" AND "</span>, <span id="braces">(</span><span id="var">@and</span>, <span id="var">@internal_ands1</span>, <span id="var">@internal_ands2</span><span id="braces">)</span><span id="braces">)</span>;

    <span id="comment"># warn $qq;</span><br />
    <span id="comment">#do actual mammoth query,and check for latest matrix</span><br />    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span><span id="var">$qq</span><span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">@r</span>;

    <span id="perlKey">while</span> <span id="braces">(</span><span id="perlKey">my</span> <span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span>-all_versions<span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@r</span>, <span id="var">$int_id</span><span id="braces">)</span>;
        <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
            <span id="comment"># is latest?</span><br />            <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@r</span>, <span id="var">$int_id</span><span id="braces">)</span> <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$self</span>-&gt;<span id="method">_is_latest_version</span><span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span> == 1<span id="braces">)</span>;
        <span id="braces">}</span>
    <span id="braces">}</span>
    <span id="perlFunc">warn</span> <span id="dqStr">"Warning: Zero matrices returned with current critera"</span>
        <span id="perlKey">unless</span> <span id="perlFunc">scalar</span> <span id="var">@r</span>;
    <span id="perlKey">return</span>\@ r;

<span id="braces">}</span>
<span id="comment">## jsp6 - checkpoint</span><br /></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE4" id="CODE4"></a>_get_Matrix_by_int_id</td><td >description</td><td ><a href="#CODE3">prev</a></td><td ><a href="#CODE5">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_get_Matrix_by_int_id</span>
{<pre>    <span id="comment">#done    my ($self, $int_id, $mt) = @_;</span><br />
    <span id="perlKey">my</span> <span id="var">$matrixobj</span>;
    <span id="var">$mt</span> = <span id="sqStr">'PFM'</span> <span id="perlKey">unless</span> <span id="var">$mt</span>;
    <span id="comment"># get the matrix as a string</span><br />    <span id="perlKey">my</span> <span id="var">$matrixstring</span> = <span id="var">$self</span>-&gt;<span id="method">_get_matrixstring</span><span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span> || <span id="perlKey">return</span> <span id="perlFunc">undef</span>;

    <span id="comment">#get remaining data in the matrix table: name, collection</span><br />    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!!SELECT BASE_ID,VERSION, COLLECTION,NAME FROM MATRIX
           WHERE ID=&quot;$int_id&quot;!</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$base_ID</span>, <span id="var">$version</span>, <span id="var">$collection</span>, <span id="var">$name</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="comment"># jsp6</span><br />    <span id="comment"># get species</span><br />    <span id="comment">##$sth=$self-&gt;dbh-&gt;prepare(qq!SELECT TAX_ID FROM MATRIX_SPECIES WHERE ID=&quot;$int_id&quot;!);</span><br />    <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!!SELECT GROUP_CONCAT(TAX_ID SEPARATOR ', ') as TAX_ID FROM MATRIX_SPECIES WHERE ID=&quot;$int_id&quot;!</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">@tax_ids</span>;
    <span id="perlKey">while</span> <span id="braces">(</span><span id="perlKey">my</span> <span id="braces">(</span><span id="var">$res</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">my</span> <span id="var">@res_v</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/,/</span>, <span id="var">$res</span><span id="braces">)</span>;
        <span id="perlKey">my</span> <span id="var">@res_v2</span> = <span id="perlFunc">grep</span><span id="braces">(</span><span id="regExp">s/^\s*(.*)\s*$/\1/g</span>, <span id="var">@res_v</span><span id="braces">)</span>;
        <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@tax_ids</span>, <span id="var">@res_v2</span><span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="comment"># jsp6</span><br />    <span id="comment"># get acc</span><br />    <span id="comment">##$sth=$self-&gt;dbh-&gt;prepare(qq!SELECT ACC FROM MATRIX_PROTEIN WHERE ID=&quot;$int_id&quot;!);</span><br />    <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!!SELECT GROUP_CONCAT(ACC SEPARATOR ', ') as ACC FROM MATRIX_PROTEIN WHERE ID=&quot;$int_id&quot;!</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">@accs</span>;
    <span id="perlKey">while</span> <span id="braces">(</span><span id="perlKey">my</span> <span id="braces">(</span><span id="var">$res</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">my</span> <span id="var">@res_v</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/,/</span>, <span id="var">$res</span><span id="braces">)</span>;
        <span id="perlKey">my</span> <span id="var">@res_v2</span> = <span id="perlFunc">grep</span><span id="braces">(</span><span id="regExp">s/^\s*(.*)\s*$/\1/g</span>, <span id="var">@res_v</span><span id="braces">)</span>;
        <span id="perlFunc">push</span><span id="braces">(</span><span id="var">@accs</span>, <span id="var">@res_v2</span><span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="comment"># jsp6</span><br />    <span id="comment"># get remaining annotation as tags, form ANNOTATION table</span><br />    <span id="perlKey">my</span> <span id="var">%tags</span>;
    <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">{SELECT TAG, VAL FROM MATRIX_ANNOTATION WHERE ID = &quot;$int_id&quot; }</span><span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="comment">## my @key_to_split=(&quot;acc&quot;, &quot;medline&quot;, &quot;pazar_tf_id&quot;); #if acc in MATRIX_ANNOTATION</span><br />    <span id="comment">#my @key_to_split=(&quot;medline&quot;, &quot;pazar_tf_id&quot;);</span><br />    <span id="comment">#</span><br />    <span id="comment"># Added 'class' and 'family' to keys to split. Since we have dimers that</span><br />    <span id="comment"># may have different classes / families. Previously stored in DB as comma</span><br />    <span id="comment"># separated lists, now store as separate records.</span><br />    <span id="comment"># XXX But this breaks the interface code! FIXME XXX</span><br />    <span id="comment"># DJA 2015/09/10</span><br />    <span id="comment">#</span><br />    <span id="comment">#my @key_to_split = (&quot;medline&quot;, &quot;pazar_tf_id&quot;, &quot;tfbs_shape_id&quot;, &quot;tfe_id&quot;, &quot;class&quot;, &quot;family&quot;);</span><br />    <span id="perlKey">my</span> <span id="var">@key_to_split</span> = <span id="braces">(</span><span id="dqStr">"class"</span>, <span id="dqStr">"family"</span>, <span id="dqStr">"medline"</span>, <span id="dqStr">"pazar_tf_id"</span>, <span id="dqStr">"tfbs_shape_id"</span>, <span id="dqStr">"tfe_id"</span><span id="braces">)</span>;

    <span id="comment">#</span><br />    <span id="comment"># See FIXME comment below.</span><br />    <span id="comment"># DJA 2015/09/14</span><br />    <span id="comment">#</span><br />    <span id="comment">#foreach my $key (@key_to_split) {</span><br />    <span id="comment">#    $tags{$key} = ['-'];</span><br />    <span id="comment">#}</span><br />
    <span id="comment">#</span><br />    <span id="comment"># Fixed so that we can have multiple comma separated values, values in</span><br />    <span id="comment"># separate rows of the table or a combination thereof. We really should</span><br />    <span id="comment"># try to get away from having to specify which keys can be split (should</span><br />    <span id="comment"># be handled more gracefully).</span><br />    <span id="comment"># DJA 2015/09/14</span><br />    <span id="comment">#</span><br />    <span id="perlKey">my</span> <span id="var">$vals</span>;
    <span id="perlKey">while</span> <span id="braces">(</span><span id="perlKey">my</span> <span id="braces">(</span><span id="var">$tag</span>, <span id="var">$val</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$vals</span> = <span id="braces">[</span><span id="braces">]</span>;
        <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$tag</span> ~~ <span id="var">@key_to_split</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlKey">my</span> <span id="var">@val_v</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/,/</span>, <span id="var">$val</span><span id="braces">)</span>;
            <span id="perlKey">my</span> <span id="var">@val_v2</span> = <span id="perlFunc">grep</span><span id="braces">(</span><span id="regExp">s/^\s*(.*)\s*$/\1/g</span>, <span id="var">@val_v</span><span id="braces">)</span>;
            <span id="comment">#push(@$vals, @val_v2);</span><br />            <span id="comment">#$tags{$tag} = $vals;</span><br />            <span id="perlFunc">push</span> @<span id="braces">{</span><span id="var">$tags</span><span id="braces">{</span><span id="var">$tag</span><span id="braces">}</span><span id="braces">}</span>, <span id="var">@val_v2</span>;
        <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
            <span id="var">$tags</span><span id="braces">{</span><span id="var">$tag</span><span id="braces">}</span> = <span id="var">$val</span>;
        <span id="braces">}</span>
    <span id="braces">}</span>

    <span id="comment">#</span><br />    <span id="comment"># XXX FIXME</span><br />    <span id="comment"># This really doesn't belong here. It is done for the purposes of the web</span><br />    <span id="comment"># interface but this is DB code which should not presume how the returned</span><br />    <span id="comment"># data is going to be used. That should be handled in the JASPAR web code</span><br />    <span id="comment"># modules. JASPAR web code currently expects all keys to split to exist!</span><br />    <span id="comment"># DJA 2015/09/14</span><br />    <span id="comment"># XXX FIXME</span><br />    <span id="comment">#</span><br />    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$key</span> <span id="braces">(</span><span id="var">@key_to_split</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$tags</span><span id="braces">{</span><span id="var">$key</span><span id="braces">}</span> = <span id="braces">[</span><span id="sqStr">'-'</span><span id="braces">]</span> <span id="perlKey">unless</span> <span id="var">$tags</span><span id="braces">{</span><span id="var">$key</span><span id="braces">}</span>;
    <span id="braces">}</span>

    <span id="comment"># jsp6</span><br />    <span id="var">$tags</span><span id="braces">{</span><span id="sqStr">'collection'</span><span id="braces">}</span> = <span id="var">$collection</span>;
    <span id="var">$tags</span><span id="braces">{</span><span id="sqStr">'species'</span><span id="braces">}</span> =\@ tax_ids;  <span id="comment"># as array reference instead of strigifying</span><br />    <span id="var">$tags</span><span id="braces">{</span><span id="sqStr">'acc'</span><span id="braces">}</span>     =\@ accs;     <span id="comment"># same, if acc MATRIX_PROTEIN</span><br />
    <span id="comment">#</span><br />    <span id="perlKey">my</span> <span id="var">$class</span> = <span id="var">$tags</span><span id="braces">{</span><span id="sqStr">'class'</span><span id="braces">}</span>;
    <span id="perlFunc">delete</span><span id="braces">(</span><span id="var">$tags</span><span id="braces">{</span><span id="sqStr">'class'</span><span id="braces">}</span><span id="braces">)</span>;
    <span id="comment">#</span><br />    <span id="perlKey">eval</span><span id="braces">(</span>
        <span id="dqStr">"\<span id="var">$matrixobj</span> = TFBS::Matrix::PFM-&gt;new"</span> . <span id="sqStr">' <br />        (   -ID    =&gt; &quot;$base_ID.$version&quot;,<br />            -name  =&gt; $name, <br />            -class =&gt; $class,<br />            -tags  =&gt;\% tags,<br />            -matrixstring =&gt; $matrixstring   # FIXME - temporary<br />        );'</span>
    <span id="braces">)</span>;
    <span id="perlKey">if</span> <span id="braces">(</span>$@<span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>$@<span id="braces">)</span>;
    <span id="braces">}</span>
    <span id="comment"># warn $int_id, &quot;\t&quot;, ref($matrixobj);</span><br />    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$matrixobj</span>-&gt;<span id="method">to_PWM</span><span id="braces">)</span> <span id="perlKey">if</span> <span id="var">$mt</span> <span id="perlKey">eq</span> <span id="dqStr">"PWM"</span>;
    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$matrixobj</span>-&gt;<span id="method">to_ICM</span><span id="braces">)</span> <span id="perlKey">if</span> <span id="var">$mt</span> <span id="perlKey">eq</span> <span id="dqStr">"ICM"</span>;
    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$matrixobj</span><span id="braces">)</span>;    <span id="comment"># default PFM</span><br /><span id="braces">}</span>

<span id="comment">##jsp6</span><br /></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE5" id="CODE5"></a>_get_TFFM_by_int_id</td><td >description</td><td ><a href="#CODE4">prev</a></td><td ><a href="#CODE6">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_get_TFFM_by_int_id</span>
{<pre>    <span id="comment">#done    my ($self, $int_id) = @_;</span><br />
    <span id="perlKey">my</span> <span id="var">$tffm</span>;

    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!! SELECT BASE_ID, VERSION, MATRIX_BASE_ID, MATRIX_VERSION, NAME,
            LOG_P_1ST_ORDER, LOG_P_DETAILED, EXPERIMENT_NAME FROM TFFM
            WHERE ID = &quot;$int_id&quot; !</span>
    <span id="braces">)</span>;

    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$base_id</span>, <span id="var">$version</span>, <span id="var">$matrix_base_id</span>, <span id="var">$matrix_version</span>, <span id="var">$name</span>,
        <span id="var">$log_p_1st_order</span>, <span id="var">$log_p_detailed</span>, <span id="var">$exp_name</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">my</span> <span id="var">$tffm</span>;
    <span id="perlKey">eval</span> <span id="braces">{</span>
        <span id="var">$tffm</span> = <span id="module"><a href="../TFFM.html">TFBS::TFFM</a></span>-&gt;<span id="perlKey">new</span><span id="braces">(</span>
            -ID                 =&gt; <span id="dqStr">"<span id="var">$base_id</span>.<span id="var">$version</span>"</span>,
            -name               =&gt; <span id="var">$name</span>, 
            -log_p_1st_order    =&gt; <span id="var">$log_p_1st_order</span>,
            -log_p_detailed     =&gt; <span id="var">$log_p_detailed</span>,
            -experiment_name    =&gt; <span id="var">$exp_name</span>,

            <span id="comment">#</span><br />            <span id="comment"># OR we could retrieve the matrix and set the corresponding</span><br />            <span id="comment"># attribute</span><br />            <span id="comment">#</span><br />            -matrix_ID          =&gt; <span id="dqStr">"<span id="var">$matrix_base_id</span>.<span id="var">$matrix_version</span>"</span>
        <span id="braces">)</span>
    <span id="braces">}</span>;

    <span id="perlKey">if</span> <span id="braces">(</span>$@<span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>$@<span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="comment">#</span><br />    <span id="comment"># Instead of storing the matrix ID, get the related matrix and store in</span><br />    <span id="comment"># the matrix attribute.</span><br />    <span id="comment">#</span><br />    <span id="comment"># my $matrix = $self-&gt;get_Matrix_by_ID(</span><br />    <span id="comment">#     &quot;$matrix_base_id.$matrix_version&quot;, 'PFM'</span><br />    <span id="comment"># );</span><br />    <span id="comment">#</span><br />    <span id="comment"># $tffm-&gt;matrix($matrix);</span><br />    <span id="comment">#</span><br />
    <span id="perlKey">return</span> <span id="var">$tffm</span>;    <span id="comment"># default PFM</span><br /></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE6" id="CODE6"></a>_get_TFFM_internal_id</td><td >description</td><td ><a href="#CODE5">prev</a></td><td ><a href="#CODE7">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_get_TFFM_internal_id</span>
{<pre>    <span id="comment"># picks out the internal id for a stable id version. Also checks if this</span><br />    <span id="comment"># combo exists or not</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$base_ID</span>, <span id="var">$version</span><span id="braces">)</span> = <span id="var">@_</span>;

    <span id="comment"># SELECT ID FROM TFFM WHERE BASE_ID=? and VERSION=?</span><br />    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!!SELECT ID FROM TFFM 
           WHERE BASE_ID=&quot;$base_ID&quot; AND VERSION=&quot;$version&quot;!</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span>;

    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE7" id="CODE7"></a>_get_TFFM_latest_version</td><td >description</td><td ><a href="#CODE6">prev</a></td><td ><a href="#CODE8">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_get_TFFM_latest_version</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$base_ID</span><span id="braces">)</span> = <span id="var">@_</span>;

    <span id="comment"># SELECT VERSION FROM TFFM WHERE BASE_ID=? ORDER BY VERSION DESC LIMIT 1</span><br />    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
         <span id="perlFunc">qq</span><span id="dqStr">!!SELECT VERSION FROM TFFM 
            WHERE BASE_ID=&quot;$base_ID&quot; 
            ORDER BY VERSION DESC LIMIT 1!</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span>;

    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$latest</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$latest</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE8" id="CODE8"></a>_get_internal_id</td><td >description</td><td ><a href="#CODE7">prev</a></td><td ><a href="#CODE9">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_get_internal_id</span>
{<pre>    <span id="comment">#DONE     # picks out the internal id for a a stable id+ version. Also checks if this cobo exists or not</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$base_ID</span>, <span id="var">$version</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="comment"># SELECT ID FROM MATRIX WHERE BASE_ID=? and VERSION=?</span><br />    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!!SELECT ID FROM MATRIX 
         WHERE BASE_ID=&quot;$base_ID&quot; AND VERSION=&quot;$version&quot;!</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span>;
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE9" id="CODE9"></a>_get_latest_version</td><td >description</td><td ><a href="#CODE8">prev</a></td><td ><a href="#CODE10">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_get_latest_version</span>
{<pre>    <span id="comment">#DONE    my ($self, $base_ID) = @_;</span><br />    <span id="comment"># SELECT VERSION FROM MATRIX WHERE BASE_ID=? ORDER BY VERSION DESC LIMIT 1</span><br />    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!!SELECT VERSION FROM MATRIX 
         WHERE BASE_ID=&quot;$base_ID&quot; 
         ORDER BY VERSION DESC LIMIT 1!</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span>;
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$latest</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$latest</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE10" id="CODE10"></a>_get_matrixstring</td><td >description</td><td ><a href="#CODE9">prev</a></td><td ><a href="#CODE11">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_get_matrixstring</span>
{<pre>    <span id="comment">#DONE    my ($self, $ID) = @_;</span><br />    <span id="comment">#my %dbname = (PWM =&gt; 'pwm', PFM =&gt; 'raw', ICM =&gt; 'info');</span><br />    <span id="comment">#unless (defined $dbname{$mt})  {</span><br />    <span id="comment">#$self-&gt;throw(&quot;Unsupported matrix type: &quot;.$mt);</span><br />    <span id="comment">#}</span><br />    <span id="perlKey">my</span> <span id="var">$sth</span>;
    <span id="perlKey">my</span> <span id="var">$qID</span>          = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">quote</span><span id="braces">(</span><span id="var">$ID</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$matrixstring</span> = <span id="dqStr">""</span>;
    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$base</span> <span id="braces">(</span><span id="perlFunc">qw</span><span id="braces">(</span>A C G T<span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
            <span id="dqStr">"SELECT val FROM MATRIX_DATA 
              WHERE ID=<span id="var">$qID</span> AND row='$base' ORDER BY col"</span>
        <span id="braces">)</span>;
        <span id="var">$sth</span>-&gt;<span id="method">execute</span>;
        <span id="var">$matrixstring</span>
            .= <span id="perlFunc">join</span><span id="braces">(</span><span id="dqStr">" "</span>, <span id="braces">(</span><span id="perlFunc">map</span> <span id="braces">{</span><span id="var">$_</span>-&gt;<span id="braces">[</span>0<span id="braces">]</span><span id="braces">}</span> @<span id="braces">{</span><span id="var">$sth</span>-&gt;<span id="method">fetchall_arrayref</span><span id="braces">(</span><span id="braces">)</span><span id="braces">}</span><span id="braces">)</span><span id="braces">)</span> . <span id="dqStr">"\n"</span>;
    <span id="braces">}</span>
    <span id="var">$sth</span>-&gt;<span id="method">finish</span>;
    <span id="perlKey">return</span> <span id="perlFunc">undef</span> <span id="perlKey">if</span> <span id="var">$matrixstring</span> <span id="perlKey">eq</span> <span id="dqStr">"\n"</span> x 4;

    <span id="perlKey">return</span> <span id="var">$matrixstring</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE11" id="CODE11"></a>_is_TFFM_latest_version</td><td >description</td><td ><a href="#CODE10">prev</a></td><td ><a href="#CODE12">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_is_TFFM_latest_version</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$int_id</span><span id="braces">)</span> = <span id="var">@_</span>;

    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!! select count(*) from TFFM 
            where BASE_ID = (SELECT BASE_ID from TFFM where ID = <span id="var">$int_id</span>) 
            AND VERSION &gt; (SELECT VERSION from TFFM where ID = <span id="var">$int_id</span>) !</span>
    <span id="braces">)</span>;

    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$count</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="comment"># no TFFMs with higher version ID and same base id</span><br />    <span id="perlKey">return</span> <span id="braces">(</span>1<span id="braces">)</span> <span id="perlKey">if</span> <span id="var">$count</span> == 0;

    <span id="perlKey">return</span> <span id="braces">(</span>0<span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE12" id="CODE12"></a>_is_latest_version</td><td >description</td><td ><a href="#CODE11">prev</a></td><td ><a href="#CODE13">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_is_latest_version</span>
{<pre><span id="comment"># is a particular internal ID representingthe latest matrix (collapse on base ids)</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$int_id</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!! select count(*) from MATRIX 
                  where BASE_ID= (SELECT BASE_ID from MATRIX where ID=<span id="var">$int_id</span>) 
                  AND VERSION&gt;(SELECT VERSION from MATRIX where ID=<span id="var">$int_id</span>) !</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$count</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">return</span> <span id="braces">(</span>1<span id="braces">)</span>
        <span id="perlKey">if</span> <span id="var">$count</span> == 0;  <span id="comment"># no matrices with higher version ID and same base id</span><br />    <span id="perlKey">return</span> <span id="braces">(</span>0<span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE13" id="CODE13"></a>_new</td><td >description</td><td ><a href="#CODE12">prev</a></td><td ><a href="#CODE14">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_new</span>
{<pre>    <span id="comment">#PROBABLY OK    my ($caller, %args) = @_;</span><br />    <span id="perlKey">my</span> <span id="var">$class</span> = <span id="perlFunc">ref</span> <span id="var">$caller</span> || <span id="var">$caller</span>;
    <span id="perlKey">my</span> <span id="var">$self</span> = <span id="perlFunc">bless</span> <span id="braces">{</span><span id="braces">}</span>, <span id="var">$class</span>;

    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$connectstring</span>, <span id="var">$user</span>, <span id="var">$password</span><span id="braces">)</span>;

    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-connect'</span><span id="braces">}</span> and <span id="braces">(</span><span id="perlFunc">ref</span><span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-connect'</span><span id="braces">}</span><span id="braces">)</span> <span id="perlKey">eq</span> <span id="dqStr">"ARRAY"</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="braces">(</span><span id="var">$connectstring</span>, <span id="var">$user</span>, <span id="var">$password</span><span id="braces">)</span> = @<span id="braces">{</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-connect'</span><span id="braces">}</span><span id="braces">}</span>;
    <span id="braces">}</span> <span id="perlKey">elsif</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-create'</span><span id="braces">}</span> and <span id="braces">(</span><span id="perlFunc">ref</span><span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-create'</span><span id="braces">}</span><span id="braces">)</span> <span id="perlKey">eq</span> <span id="dqStr">"ARRAY"</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">return</span> <span id="var">$caller</span>-&gt;<span id="method">create</span><span id="braces">(</span>@<span id="braces">{</span>-args <span id="braces">{</span><span id="sqStr">'create'</span><span id="braces">}</span><span id="braces">}</span><span id="braces">)</span>;
    <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
        <span id="braces">(</span><span id="var">$connectstring</span>, <span id="var">$user</span>, <span id="var">$password</span><span id="braces">)</span> =
            <span id="braces">(</span>DEFAULT_CONNECTSTRING, DEFAULT_USER, DEFAULT_PASSWORD<span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="var">$self</span>-&gt;<span id="method">dbh</span><span id="braces">(</span><span id="method">DBI</span><span id="method">->connect</span><span id="braces">(</span><span id="var">$connectstring</span>, <span id="var">$user</span>, <span id="var">$password</span>, <span id="braces">{</span>mysql_enable_utf8 =&gt; 1<span id="braces">}</span><span id="braces">)</span><span id="braces">)</span>;

    <span id="perlKey">return</span> <span id="var">$self</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE14" id="CODE14"></a>_store_matrix</td><td >description</td><td ><a href="#CODE13">prev</a></td><td ><a href="#CODE15">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_store_matrix</span>
{<pre>    <span id="comment">#DONE    # creation of the matrix will also give an internal unique ID</span><br />    <span id="comment"># (incremental int) which will be returned to use for the other tables</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$pfm</span>, <span id="var">$ACTION</span><span id="braces">)</span> = <span id="var">@_</span>;
 
    <span id="comment">#</span><br />    <span id="comment"># Added check that the version is not already stored as part of the ID.</span><br />    <span id="comment"># Also added a more informative insertion exception message.</span><br />    <span id="comment"># DJA 2016/08/26</span><br />    <span id="comment">#</span><br />
    <span id="perlKey">my</span> <span id="var">$id</span> = <span id="var">$pfm</span>-&gt;<span id="method">ID</span>;

    <span id="perlKey">my</span> <span id="var">$base_id</span>;
    <span id="perlKey">my</span> <span id="var">$version</span>;
    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$id</span> =~ <span id="regExp">/^(\S+)\.(\d+)/</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$base_id</span> = <span id="var">$1</span>;
        <span id="var">$version</span> = <span id="var">$2</span>;
    <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
        <span id="var">$base_id</span> = <span id="var">$id</span>;
    <span id="braces">}</span>

    <span id="perlKey">unless</span> <span id="braces">(</span><span id="var">$version</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="comment"># Get collection and version from the matrix tags</span><br />        <span id="var">$version</span> = <span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'version'</span><span id="braces">}</span>;
    <span id="braces">}</span>

    <span id="comment"># will warn but not die if version is missing: will assume 1</span><br />    <span id="perlKey">unless</span> <span id="braces">(</span><span id="var">$version</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlFunc">warn</span> <span id="dqStr">"WARNING: Lacking  version number for "</span>
            . <span id="var">$pfm</span>-&gt;<span id="method">ID</span>
            . <span id="dqStr">". Setting version=1"</span>;
        <span id="var">$version</span> = 1;
    <span id="braces">}</span>

    <span id="perlKey">my</span> <span id="var">$collection</span> = <span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'collection'</span><span id="braces">}</span>;
    <span id="perlKey">unless</span> <span id="braces">(</span><span id="var">$collection</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlFunc">warn</span> <span id="dqStr">"WARNING: Lacking  collection name for "</span>
            . <span id="var">$pfm</span>-&gt;<span id="method">ID</span>
            . <span id="dqStr">". Setting collection to an empty string. You probably do not want this"</span>;
        <span id="var">$collection</span> = <span id="sqStr">''</span>;
    <span id="braces">}</span>

    <span id="comment"># sanity check: do we already have this cobination of base ID and version?</span><br />    <span id="comment"># If we do, die</span><br />    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!! select count(*) from MATRIX where VERSION=<span id="var">$version</span>
            and BASE_ID= &quot;$base_id&quot; and collection=&quot;$collection&quot; !</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span>;
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$sanity_count</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span>;

    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$sanity_count</span> &gt; 0<span id="braces">)</span> <span id="braces">{</span>
        <span id="perlFunc">warn</span>
            <span id="dqStr">"WARNING: Database input inconsistency: You have already have <span id="var">$sanity_count</span> <span id="var">$base_id</span> matrices of version <span id="var">$version</span> in collection <span id="var">$collection</span>. Terminating program"</span>;
        <span id="perlFunc">die</span>;
    <span id="braces">}</span>

    <span id="comment"># insert data</span><br />
    <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">q</span><span id="sqStr">!! INSERT INTO MATRIX<br />           VALUES(?,?,?,?,?) !</span>
    <span id="braces">)</span>;

    <span id="comment"># update next sth with actual version and collection: DO</span><br />    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span>0, <span id="var">$collection</span>, <span id="var">$pfm</span>-&gt;<span id="method">ID</span>, <span id="var">$version</span>, <span id="var">$pfm</span>-&gt;<span id="method">name</span><span id="braces">)</span>
        or <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>
            <span id="perlFunc">sprintf</span><span id="braces">(</span><span id="dqStr">"Error inserting matrix <span id="var">%s</span> as <span id="var">%s</span>.<span id="var">%d</span> to <span id="var">%s</span> collection"</span>,
                    <span id="var">$pfm</span>-&gt;<span id="method">name</span>, <span id="var">$pfm</span>-&gt;<span id="method">ID</span>, <span id="var">$version</span>, <span id="var">$collection</span><span id="braces">)</span>
        <span id="braces">)</span>;

    <span id="comment"># get the actual (new) iternal ID</span><br />
    <span id="perlKey">my</span> <span id="var">$int_id</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="braces">{</span><span id="perlFunc">q</span><span id="sqStr">{mysql_insertid}</span><span id="braces">}</span>;

    <span id="perlKey">return</span> <span id="var">$int_id</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE15" id="CODE15"></a>_store_matrix_acc</td><td >description</td><td ><a href="#CODE14">prev</a></td><td ><a href="#CODE16">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_store_matrix_acc</span>
{<pre>    <span id="comment"># DONE    #these are for protein accession numbers - can be several</span><br />    <span id="comment"># these are taken from the tag &quot;acc&quot;</span><br />    <span id="comment"># if that tag is a reference to an array we walk over the array</span><br />    <span id="comment"># if it is a comma-separated string we split the string</span><br />
    <span id="comment">#</span><br />    <span id="comment"># For some reason the MATRIX_PROTEIN table had a primary key constraint</span><br />    <span id="comment"># on the matrix ID field, preventing multiple proteins from being stored</span><br />    <span id="comment"># here. That was presumably an oversight or otherwise an out of date table</span><br />    <span id="comment"># definition.</span><br />    <span id="comment">#</span><br />    <span id="comment"># Also added more informative insertion exception messages.</span><br />    <span id="comment"># DJA 2016/08/26</span><br />    <span id="comment">#</span><br />
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$pfm</span>, <span id="var">$int_id</span>, <span id="var">$ACTION</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">q</span><span id="sqStr">!! INSERT INTO MATRIX_PROTEIN<br />           VALUES(?,?) !</span>
    <span id="braces">)</span>;

    <span id="comment">#sanity check: are there any accession numbers? Its ok not to have it.</span><br />    <span id="perlKey">return</span> <span id="braces">(</span><span id="braces">)</span> <span id="perlKey">unless</span> <span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'acc'</span><span id="braces">}</span>;

    <span id="comment">#is the protein ID a string or an arrayref?</span><br />    <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">ref</span><span id="braces">(</span><span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'acc'</span><span id="braces">}</span><span id="braces">)</span> <span id="perlKey">eq</span> <span id="sqStr">'ARRAY'</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="comment"># walkthru array</span><br />        <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$acc</span> <span id="braces">(</span>@<span id="braces">{</span><span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'acc'</span><span id="braces">}</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="var">$acc</span> =~ <span id="regExp">s/\s//g</span>;
            <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="var">$int_id</span>, <span id="var">$acc</span><span id="braces">)</span> or <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>
                <span id="dqStr">"Error inserting protein '$acc' for matrix <span id="var">$int_id</span>)"</span>
            <span id="braces">)</span>;
        <span id="braces">}</span>
    <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
        <span id="comment"># split and walk thru</span><br />        <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$acc</span> <span id="braces">(</span><span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\,/</span>, <span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'acc'</span><span id="braces">}</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="var">$acc</span> =~ <span id="regExp">s/\s//g</span>;
            <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="var">$int_id</span>, <span id="var">$acc</span><span id="braces">)</span> or <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>
                <span id="dqStr">"Error inserting protein '$acc' for matrix <span id="var">$int_id</span>)"</span>
            <span id="braces">)</span>;
        <span id="braces">}</span>

    <span id="braces">}</span>
<span id="braces">}</span>

<span id="comment">#when creating: try to support arbitrary tags</span><br /></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE16" id="CODE16"></a>_store_matrix_annotation</td><td >description</td><td ><a href="#CODE15">prev</a></td><td ><a href="#CODE17">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_store_matrix_annotation</span>
{<pre>    <span id="comment"># DONE    #</span><br />    <span id="comment"># this is for tag-value items that are not one-to-many (so, not species</span><br />    <span id="comment"># and not acc)</span><br /> 
    <span id="comment">#</span><br />    <span id="comment"># We do need to store multiple values of class and family. In the case</span><br />    <span id="comment"># of profiles representing dimers, the TFs making up the dimer may have</span><br />    <span id="comment"># different TF classes and families. It also seemed abitrary to have a</span><br />    <span id="comment"># primary key constraint on the ID + TAG. This has been removed.</span><br />    <span id="comment">#</span><br />    <span id="comment"># Added more informative messages to insertion failure exceptions.</span><br />    <span id="comment"># Modified split to also handle spaces around comma.</span><br />    <span id="comment"># DJA 2015/08/26</span><br />    <span id="comment"># </span><br />
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$pfm</span>, <span id="var">$int_id</span>, <span id="var">$ACTION</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">q</span><span id="sqStr">!! INSERT INTO MATRIX_ANNOTATION<br />        (ID, tag, val) <br />        VALUES(?,?,?) !</span>
    <span id="braces">)</span>;

    <span id="comment"># get all tags</span><br />    <span id="comment"># but skip out collection or version as we already have those in the</span><br />    <span id="comment"># MATRIX table</span><br />
    <span id="comment"># special handling for class which mighht have a true slot</span><br />
    <span id="perlKey">my</span> <span id="var">%tags</span> = <span id="var">$pfm</span>-&gt;<span id="method">all_tags</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">defined</span><span id="braces">(</span><span id="var">$pfm</span>-&gt;<span id="braces">{</span>class<span id="braces">}</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$tags</span><span id="braces">{</span>class<span id="braces">}</span> = <span id="var">$pfm</span>-&gt;<span id="braces">{</span>class<span id="braces">}</span>;
    <span id="braces">}</span>

    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$tag</span> <span id="braces">(</span><span id="perlFunc">keys</span> <span id="var">%tags</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$tag</span> <span id="perlKey">eq</span> <span id="dqStr">"collection"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$tag</span> <span id="perlKey">eq</span> <span id="dqStr">"version"</span>;
        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$tag</span> <span id="perlKey">eq</span> <span id="dqStr">"species"</span>;

        <span id="comment">#</span><br />        <span id="comment"># The 'acc' tag was commented out in JASPAR6. Not sure the reasoning</span><br />        <span id="comment"># as this stores the protein accession (UniProt IDs) which are</span><br />        <span id="comment"># stored in the MATRIX_PROTEIN table and therefore should NOT be</span><br />        <span id="comment"># stored in the MATRIX_ANNOTATION table and therefore *should* be</span><br />        <span id="comment"># skipped here.</span><br />        <span id="comment"># DJA 2015/08/26</span><br />        <span id="comment">#</span><br />        <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="var">$tag</span> <span id="perlKey">eq</span> <span id="dqStr">"acc"</span>;

        <span id="comment"># next if $tag eq &quot;class&quot;;</span><br />        <span id="comment">#$sth-&gt;execute($int_id, $tag, ($tags{$tag} or &quot;&quot;),) </span><br />        <span id="comment">#    or $self-&gt;throw(&quot;Error executing query&quot;);</span><br />        <span id="comment">#</span><br />        <span id="comment"># Since we may have multiple values stored in some tags we need to</span><br />        <span id="comment"># handle this. Assume that they may be stored either as array</span><br />        <span id="comment"># references or as strings with comma separators.</span><br />        <span id="comment"># DJA 2015/08/26</span><br />        <span id="comment">#</span><br />        <span id="perlKey">my</span> <span id="var">$vals</span> = <span id="var">$tags</span><span id="braces">{</span><span id="var">$tag</span><span id="braces">}</span>;
        <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">ref</span> <span id="var">$vals</span> <span id="perlKey">eq</span> <span id="sqStr">'ARRAY'</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$val</span> <span id="braces">(</span>@$vals<span id="braces">)</span> <span id="braces">{</span>
                <span id="var">$val</span> =~ <span id="regExp">s/^\s+//</span>;
                <span id="var">$val</span> =~ <span id="regExp">s/\s+$//</span>;
                <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="var">$int_id</span>, <span id="var">$tag</span>, <span id="var">$val</span><span id="braces">)</span> or <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>
                    <span id="dqStr">"Error inserting tag/value pair ('$tag', '$val')"</span>
                    . <span id="dqStr">" into MATRIX_ANNOTATION"</span>
                <span id="braces">)</span>;
            <span id="braces">}</span>
        <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
            <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$val</span> <span id="braces">(</span><span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\s*\,\s*/</span>, <span id="var">$vals</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="var">$val</span> =~ <span id="regExp">s/^\s+//</span>;
                <span id="var">$val</span> =~ <span id="regExp">s/\s+$//</span>;
                <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="var">$int_id</span>, <span id="var">$tag</span>, <span id="var">$val</span><span id="braces">)</span> or <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>
                    <span id="dqStr">"Error inserting tag/value pair ('$tag', '$val')"</span>
                    . <span id="dqStr">" into MATRIX_ANNOTATION"</span>
                <span id="braces">)</span>;
            <span id="braces">}</span>
        <span id="braces">}</span>
    <span id="braces">}</span></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE17" id="CODE17"></a>_store_matrix_data</td><td >description</td><td ><a href="#CODE16">prev</a></td><td ><a href="#CODE18">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_store_matrix_data</span>
{<pre>    <span id="comment"># DONE    my ($self, $pfm, $int_id, $ACTION) = @_;</span><br />    <span id="perlKey">my</span> <span id="var">@base</span>   = <span id="perlFunc">qw</span><span id="braces">(</span>A C G T<span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$matrix</span> = <span id="var">$pfm</span>-&gt;<span id="method">matrix</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$type</span>;
    <span id="perlKey">my</span> <span id="var">$sth</span> =
        <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span><span id="perlFunc">q</span><span id="sqStr">!! INSERT INTO MATRIX_DATA VALUES(?,?,?,?) !</span><span id="braces">)</span>;

    <span id="perlKey">for</span> <span id="perlKey">my</span> <span id="var">$i</span> <span id="braces">(</span>0 .. 3<span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">for</span> <span id="perlKey">my</span> <span id="var">$j</span> <span id="braces">(</span>0 .. <span id="braces">(</span><span id="var">$pfm</span>-&gt;<span id="perlFunc">length</span> - 1<span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span>
                <span id="var">$int_id</span>,

                <span id="var">$base</span><span id="braces">[</span><span id="var">$i</span><span id="braces">]</span>,
                <span id="var">$j</span> + 1,
                <span id="var">$matrix</span>-&gt;<span id="braces">[</span><span id="var">$i</span><span id="braces">]</span><span id="braces">[</span><span id="var">$j</span><span id="braces">]</span>
            <span id="braces">)</span> or <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span><span id="dqStr">"Error executing query."</span><span id="braces">)</span>;
        <span id="braces">}</span>
    <span id="braces">}</span></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE18" id="CODE18"></a>_store_matrix_species</td><td >description</td><td ><a href="#CODE17">prev</a></td><td ><a href="#CODE19">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="privSubName">_store_matrix_species</span>
{<pre>    <span id="comment"># DONE    #these are for species IDs - can be several</span><br />    <span id="comment"># these are taken from the tag &quot;species&quot;</span><br />    <span id="comment"># if that tag is a reference to an array we walk over the array</span><br />    <span id="comment"># if it is a comma-separated string we split the string</span><br /> 
    <span id="comment">#</span><br />    <span id="comment"># Added exception handling/messages for insertion failure.</span><br />    <span id="comment"># Modified split to also handle spaces around comma.</span><br />    <span id="comment"># DJA 2015/08/26</span><br />    <span id="comment"># </span><br />
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$pfm</span>, <span id="var">$int_id</span>, <span id="var">$ACTION</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">q</span><span id="sqStr">!! INSERT INTO MATRIX_SPECIES<br />           VALUES(?,?) !</span>
    <span id="braces">)</span>;

    <span id="comment">#sanity check: are there any species? Its ok not to have it.</span><br />    <span id="perlKey">return</span> <span id="braces">(</span><span id="braces">)</span> <span id="perlKey">unless</span> <span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'species'</span><span id="braces">}</span>;
    <span id="comment">#is the species a string or an arrayref?</span><br />    <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">ref</span><span id="braces">(</span><span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'species'</span><span id="braces">}</span><span id="braces">)</span> <span id="perlKey">eq</span> <span id="sqStr">'ARRAY'</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="comment"># walkthru array</span><br />        <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$species</span> <span id="braces">(</span>@<span id="braces">{</span><span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'species'</span><span id="braces">}</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="var">$int_id</span>, <span id="var">$species</span><span id="braces">)</span> or <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>
                <span id="dqStr">"Error inserting species '$species' for matrix <span id="var">$int_id</span>)"</span>
            <span id="braces">)</span>;
        <span id="braces">}</span>
    <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
        <span id="comment"># split and walk thru</span><br />        <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$species</span> <span id="braces">(</span><span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\s*\,\s*/</span>, <span id="var">$pfm</span>-&gt;<span id="braces">{</span><span id="sqStr">'tags'</span><span id="braces">}</span><span id="braces">{</span><span id="sqStr">'species'</span><span id="braces">}</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="var">$species</span> =~ <span id="regExp">s/^\s+//</span>;
            <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="var">$int_id</span>, <span id="var">$species</span><span id="braces">)</span> or <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>
                <span id="dqStr">"Error inserting species '$species' for matrix <span id="var">$int_id</span>)"</span>
            <span id="braces">)</span>;
        <span id="braces">}</span>
    <span id="braces">}</span></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE19" id="CODE19"></a>connect</td><td ><a href="#POD1">description</a></td><td ><a href="#CODE18">prev</a></td><td ><a href="#CODE20">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">connect</span>
{<pre>    <span id="comment">#DONE                 # a more intuitive syntax for the constructor</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$caller</span>, <span id="var">@connection_args</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="var">$caller</span>-&gt;<span id="perlKey">new</span><span id="braces">(</span>-<span id="perlFunc">connect</span> =&gt;\@ connection_args<span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE20" id="CODE20"></a>create</td><td >description</td><td ><a href="#CODE19">prev</a></td><td ><a href="#CODE21">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">create</span>
{<pre>         <span id="comment">#done    my ($caller, $connectstring, $user, $password) = @_;</span><br />    <span id="perlKey">if</span> <span id="braces">(</span>    <span id="var">$connectstring</span>
        and <span id="var">$connectstring</span> =~ <span id="regExp">/dbi:mysql:(\w+)(.*)/</span><span id="braces">)</span>
    <span id="braces">{</span>
        <span id="comment"># connect to the server;</span><br />        <span id="perlKey">my</span> <span id="var">$dbh</span> = <span id="method">DBI</span><span id="method">->connect</span><span id="braces">(</span><span id="dqStr">"dbi:mysql:mysql"</span> . <span id="var">$2</span>, <span id="var">$user</span>, <span id="var">$password</span><span id="braces">)</span>
            or <span id="perlFunc">die</span><span id="braces">(</span><span id="dqStr">"Error connecting to the database"</span><span id="braces">)</span>;

        <span id="comment"># create database and open it</span><br />        <span id="var">$dbh</span>-&gt;<span id="perlKey">do</span><span id="braces">(</span><span id="dqStr">"create database <span id="var">$1</span>"</span><span id="braces">)</span>
            or <span id="perlFunc">die</span><span id="braces">(</span><span id="dqStr">"Error creating database."</span><span id="braces">)</span>;
        <span id="var">$dbh</span>-&gt;<span id="perlKey">do</span><span id="braces">(</span><span id="dqStr">"use <span id="var">$1</span>"</span><span id="braces">)</span>;

        <span id="comment"># create tables</span><br />        <span id="method">_create_tables</span><span id="braces">(</span><span id="var">$dbh</span><span id="braces">)</span>;

        <span id="var">$dbh</span>-&gt;<span id="method">disconnect</span>;

        <span id="comment"># run &quot;new&quot; with new database</span><br />
        <span id="perlKey">return</span> <span id="var">$caller</span>-&gt;<span id="perlKey">new</span><span id="braces">(</span>-<span id="perlFunc">connect</span> =&gt; <span id="braces">[</span><span id="var">$connectstring</span>, <span id="var">$user</span>, <span id="var">$password</span><span id="braces">]</span><span id="braces">)</span>;
    <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
        <span id="perlFunc">die</span><span id="braces">(</span>      <span id="dqStr">"Missing or malformed connect string for "</span>
                . <span id="dqStr">"TFBS::DB::JASPAR2 connection."</span><span id="braces">)</span>;
    <span id="braces">}</span></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE21" id="CODE21"></a>dbh</td><td ><a href="#POD2">description</a></td><td ><a href="#CODE20">prev</a></td><td ><a href="#CODE22">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">dbh</span>
{<pre>    <span id="comment">#DONE    my ($self, $dbh) = @_;</span><br />    <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'dbh'</span><span id="braces">}</span> = <span id="var">$dbh</span> <span id="perlKey">if</span> <span id="var">$dbh</span>;
    <span id="perlKey">return</span> <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'dbh'</span><span id="braces">}</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE22" id="CODE22"></a>delete_Matrix_having_ID</td><td ><a href="#POD3">description</a></td><td ><a href="#CODE21">prev</a></td><td ><a href="#CODE23">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">delete_Matrix_having_ID</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">@IDs</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="comment"># this has to be versioned IDs</span><br />    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$ID</span> <span id="braces">(</span><span id="var">@IDs</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$base_id</span>, <span id="var">$version</span><span id="braces">)</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\./</span>, <span id="var">$ID</span><span id="braces">)</span>;
        <span id="perlKey">unless</span> <span id="braces">(</span><span id="var">$version</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlFunc">warn</span>
                <span id="dqStr">"You have supplied a non-versioned matrix ID to delete. Skipping <span id="var">$ID</span> "</span>;
            <span id="perlKey">return</span> 0;
        <span id="braces">}</span>
        <span id="comment"># get relevant internal ID</span><br />        <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span> = <span id="var">$self</span>-&gt;<span id="method">_get_internal_id</span><span id="braces">(</span><span id="var">$base_id</span>, <span id="var">$version</span><span id="braces">)</span>;

        <span id="perlKey">eval</span> <span id="braces">{</span>
            <span id="perlKey">my</span> <span id="var">$q_ID</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">quote</span><span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span>;
            <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$table</span> <span id="braces">(</span>
                <span id="perlFunc">qw</span> <span id="braces">(</span>MATRIX_DATA
                    MATRIX
                    MATRIX_SPECIES
                    MATRIX_PROTEIN
                    MATRIX_ANNOTATION<span id="braces">)</span>
            <span id="braces">)</span> <span id="braces">{</span>
                <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="perlKey">do</span><span id="braces">(</span><span id="dqStr">"DELETE from <span id="var">$table</span> where ID=<span id="var">$q_ID</span>"</span><span id="braces">)</span>;
            <span id="braces">}</span>
        <span id="braces">}</span>;
    <span id="braces">}</span>

    <span id="perlKey">return</span> $@;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE23" id="CODE23"></a>get_MatrixSet</td><td ><a href="#POD4">description</a></td><td ><a href="#CODE22">prev</a></td><td ><a href="#CODE24">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">get_MatrixSet</span>
{<pre>    <span id="comment"># IC conetent and matrix stuff is not there yet, rest should work</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">%args</span><span id="braces">)</span> = <span id="var">@_</span>;

    <span id="comment">#jsp6</span><br />    <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-collection'</span><span id="braces">}</span> = <span id="sqStr">'CORE'</span> <span id="perlKey">unless</span> <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-collection'</span><span id="braces">}</span>;

    <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-all_versions'</span><span id="braces">}</span> = 0 <span id="perlKey">unless</span> <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-all_versions'</span><span id="braces">}</span>;

    <span id="perlKey">my</span> <span id="var">@IDlist</span> = @<span id="braces">{</span><span id="var">$self</span>-&gt;<span id="method">_get_IDlist_by_query</span><span id="braces">(</span><span id="var">%args</span><span id="braces">)</span><span id="braces">}</span>
        ;    <span id="comment"># the IDlist here are INTERNAL ids</span><br />
    <span id="perlKey">my</span> <span id="var">$type</span>;
    <span id="perlKey">my</span> <span id="var">$matrixset</span> = <span id="module"><a href="../MatrixSet.html">TFBS::MatrixSet</a></span>-&gt;<span id="perlKey">new</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$int_id</span> <span id="braces">(</span><span id="var">@IDlist</span><span id="braces">)</span> <span id="braces">{</span>

        <span id="perlKey">my</span> <span id="var">$matrix</span> = <span id="var">$self</span>-&gt;<span id="method">_get_Matrix_by_int_id</span><span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span>;

        <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-min_ic'</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="comment"># we assume the matrix IS a PFM, o something in normal space at</span><br />            <span id="comment"># least unless it explicitly says otherwise in tag=matrixtype</span><br />            <span id="comment"># if so warn and do not use IC content</span><br />            <span id="comment"># this is not foolproof in any way</span><br /> 
            <span id="comment">#</span><br />            <span id="comment"># Fixed up logic to actually check $matrix-&gt;isa(TFBS::Matrix::ICM)</span><br />            <span id="comment"># before checking the matrixtype tag. Also check that matrixtype</span><br />            <span id="comment"># tag is defined before comparison to prevent annoying &quot;Use of</span><br />            <span id="comment"># uninitialized value in string eq&quot; messages from perl.</span><br />            <span id="comment"># DJA 2012/05/11</span><br />            <span id="comment">#</span><br />            <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$matrix</span>-&gt;<span id="method">isa</span><span id="braces">(</span><span id="dqStr">"TFBS::Matrix::ICM"</span><span id="braces">)</span>
                || <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$matrix</span>-&gt;<span id="braces">{</span>tags<span id="braces">}</span><span id="braces">{</span>matrixtype<span id="braces">}</span>
                    &amp;&amp; <span id="var">$matrix</span>-&gt;<span id="braces">{</span>tags<span id="braces">}</span><span id="braces">{</span>matrixtype<span id="braces">}</span> <span id="perlKey">eq</span> <span id="dqStr">"ICM"</span><span id="braces">)</span>
                <span id="braces">)</span>
            <span id="braces">{</span>
                <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$matrix</span>-&gt;<span id="method">total_ic</span><span id="braces">(</span><span id="braces">)</span> &lt; <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-min_ic'</span><span id="braces">}</span><span id="braces">)</span>;
            <span id="braces">}</span> <span id="perlKey">elsif</span> <span id="braces">(</span><span id="var">$matrix</span>-&gt;<span id="method">isa</span><span id="braces">(</span><span id="dqStr">"TFBS::Matrix::PFM"</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$matrix</span>-&gt;<span id="method">to_ICM</span>-&gt;<span id="method">total_ic</span><span id="braces">(</span><span id="braces">)</span> &lt; <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-min_ic'</span><span id="braces">}</span><span id="braces">)</span>;
            <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
                <span id="perlFunc">warn</span>
                    <span id="dqStr">"Warning: you are assessing information content on matrices that are not in PFM or ICM format. Skipping this criteria"</span>;
                <span id="perlKey">next</span>;
            <span id="braces">}</span>

        <span id="braces">}</span>

        <span id="comment"># length</span><br />        <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-length'</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$matrix</span>-&gt;<span id="perlFunc">length</span><span id="braces">(</span><span id="braces">)</span> &lt; <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-length'</span><span id="braces">}</span><span id="braces">)</span>;
        <span id="braces">}</span>

<span id="comment"># number of sites within</span><br /><span id="comment"># since column sums MIGHT be slightly different we take the integer of the mean of the columns</span><br /><span id="comment"># or really int( sum of matrix/#columns)</span><br />        <span id="perlKey">if</span> <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-sites'</span><span id="braces">}</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlKey">my</span> <span id="var">$sum</span> = 0;
            <span id="perlKey">foreach</span> <span id="braces">(</span>1 .. <span id="var">$matrix</span>-&gt;<span id="perlFunc">length</span><span id="braces">)</span> <span id="braces">{</span>
                <span id="var">$sum</span> += <span id="var">$matrix</span>-&gt;<span id="method">column_sum</span><span id="braces">(</span><span id="braces">)</span>;
            <span id="braces">}</span>
            <span id="var">$sum</span> = <span id="perlFunc">int</span><span id="braces">(</span><span id="var">$sum</span> <span id="regExp">/ </span><span id="var">$matrix</span>-&gt;length);<br />            <span id="comment">#warn $matrix-&gt;ID, &quot; $sum is $sum&quot;;</span><br />            <span id="perlKey">next</span> <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$sum</span> &lt; <span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-sites'</span><span id="braces">}</span><span id="braces">)</span>;
        <span id="braces">}</span>

        <span id="comment">#ugly code: think about this a bit.</span><br />
        <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-matrixtype'</span><span id="braces">}</span> &amp;&amp; <span id="var">$matrix</span>-&gt;<span id="method">isa</span><span id="braces">(</span><span id="dqStr">"TFBS::Matrix::PFM"</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>
            <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-matrixtype'</span><span id="braces">}</span> <span id="perlKey">eq</span> <span id="braces">(</span><span id="sqStr">'PWM'</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>

                <span id="var">$matrix</span> = <span id="var">$matrix</span>-&gt;<span id="method">to_PWM</span><span id="braces">(</span><span id="braces">)</span>;
            <span id="braces">}</span>
            <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$args</span><span id="braces">{</span><span id="sqStr">'-matrixtype'</span><span id="braces">}</span> <span id="perlKey">eq</span> <span id="braces">(</span><span id="sqStr">'ICM'</span><span id="braces">)</span><span id="braces">)</span> <span id="braces">{</span>

                <span id="var">$matrix</span> = <span id="var">$matrix</span>-&gt;<span id="method">to_PWM</span><span id="braces">(</span><span id="braces">)</span>;
            <span id="braces">}</span>
        <span id="braces">}</span>

        <span id="var">$matrixset</span>-&gt;<span id="method">add_Matrix</span><span id="braces">(</span><span id="var">$matrix</span><span id="braces">)</span>;
    <span id="braces">}</span>
    <span id="perlKey">return</span> <span id="var">$matrixset</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE24" id="CODE24"></a>get_Matrix_by_ID</td><td ><a href="#POD5">description</a></td><td ><a href="#CODE23">prev</a></td><td ><a href="#CODE25">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">get_Matrix_by_ID</span>
{<pre>    <span id="comment">#DONE. MAYBE :)</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$q</span>, <span id="var">$mt</span><span id="braces">)</span> = <span id="var">@_</span>;  <span id="comment"># q is a stable ID with possible version number</span><br />
    <span id="comment"># jsp6</span><br />    <span id="var">$mt</span> = <span id="braces">(</span><span id="perlFunc">uc</span><span id="braces">(</span><span id="var">$mt</span><span id="braces">)</span> or <span id="dqStr">"PFM"</span><span id="braces">)</span>;
    <span id="perlKey">unless</span> <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$q</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span><span id="dqStr">"No ID passed to get_Matrix_by_ID"</span><span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="perlKey">my</span> <span id="var">$ucmt</span> = <span id="perlFunc">uc</span> <span id="var">$mt</span>;
    <span id="comment"># separate stable ID and version number</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$base_ID</span>, <span id="var">$version</span><span id="braces">)</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\./</span>, <span id="var">$q</span><span id="braces">)</span>;
    <span id="var">$version</span> = <span id="var">$self</span>-&gt;<span id="method">_get_latest_version</span><span id="braces">(</span><span id="var">$base_ID</span><span id="braces">)</span>
        <span id="perlKey">unless</span> <span id="var">$version</span>;       <span id="comment"># latest version per default</span><br />
    <span id="comment"># get internal ID - also a check for validity</span><br />    <span id="perlKey">my</span> <span id="var">$int_id</span> = <span id="var">$self</span>-&gt;<span id="method">_get_internal_id</span><span id="braces">(</span><span id="var">$base_ID</span>, <span id="var">$version</span><span id="braces">)</span>;

    <span id="comment"># get matrix using internal ID</span><br />
    <span id="perlKey">my</span> <span id="var">$m</span> = <span id="var">$self</span>-&gt;<span id="method">_get_Matrix_by_int_id</span><span id="braces">(</span><span id="var">$int_id</span>, <span id="var">$ucmt</span><span id="braces">)</span>;
    <span id="comment">#warn ref($m);</span><br />
    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$m</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE25" id="CODE25"></a>get_Matrix_by_name</td><td ><a href="#POD6">description</a></td><td ><a href="#CODE24">prev</a></td><td ><a href="#CODE26">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">get_Matrix_by_name</span>
{<pre>    <span id="comment">#DONE    my ($self, $name, $mt) = @_;</span><br />    <span id="perlKey">unless</span> <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$name</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span><span id="dqStr">"No name passed to get_Matrix_by_name."</span><span id="braces">)</span>;
    <span id="braces">}</span>
    <span id="comment"># sanity check: are there many different stable IDs with same name?</span><br />
    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!!SELECT distinct BASE_ID  FROM MATRIX
                    WHERE NAME=&quot;$name&quot;!</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">@stable_ids</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$L</span> = <span id="perlFunc">scalar</span> <span id="var">@stable_ids</span>;
    <span id="var">$self</span>-&gt;<span id="perlFunc">warn</span><span id="braces">(</span><span id="dqStr">"There are <span id="var">$L</span> distinct stable IDs with name '$name'"</span><span id="braces">)</span>
        <span id="perlKey">if</span> <span id="perlFunc">scalar</span> <span id="var">$L</span> &gt; 1;

    <span id="perlKey">return</span> <span id="var">$self</span>-&gt;<span id="method">get_Matrix_by_ID</span><span id="braces">(</span><span id="var">$stable_ids</span><span id="braces">[</span>0<span id="braces">]</span>, <span id="var">$mt</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE26" id="CODE26"></a>get_TFFM_by_ID</td><td ><a href="#POD7">description</a></td><td ><a href="#CODE25">prev</a></td><td ><a href="#CODE27">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">get_TFFM_by_ID</span>
{<pre>
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$id</span><span id="braces">)</span> = <span id="var">@_</span>;   <span id="comment"># id is a stable ID with possible version number</span><br />
    <span id="perlKey">unless</span> <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$id</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span><span id="dqStr">"No ID passed to get_TFFM_by_ID"</span><span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="comment"># separate stable ID and version number</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$base_ID</span>, <span id="var">$version</span><span id="braces">)</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\./</span>, <span id="var">$id</span><span id="braces">)</span>;

    <span id="comment"># latest version per default</span><br />    <span id="var">$version</span> = <span id="var">$self</span>-&gt;<span id="method">_get_TFFM_latest_version</span><span id="braces">(</span><span id="var">$base_ID</span><span id="braces">)</span> <span id="perlKey">unless</span> <span id="var">$version</span>;

    <span id="comment"># get internal ID - also a check for validity</span><br />    <span id="perlKey">my</span> <span id="var">$int_id</span> = <span id="var">$self</span>-&gt;<span id="method">_get_TFFM_internal_id</span><span id="braces">(</span><span id="var">$base_ID</span>, <span id="var">$version</span><span id="braces">)</span>;

    <span id="comment"># get TFFM using internal ID</span><br />    <span id="perlKey">my</span> <span id="var">$tffm</span> = <span id="var">$self</span>-&gt;<span id="method">_get_TFFM_by_int_id</span><span id="braces">(</span><span id="var">$int_id</span><span id="braces">)</span>;

    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$tffm</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE27" id="CODE27"></a>get_TFFM_by_matrix_ID</td><td ><a href="#POD8">description</a></td><td ><a href="#CODE26">prev</a></td><td ><a href="#CODE28">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">get_TFFM_by_matrix_ID</span>
{<pre>
    <span id="comment"># id is a fully qualified matrix stable ID including version number</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$matrix_id</span><span id="braces">)</span> = <span id="var">@_</span>;

    <span id="perlKey">unless</span> <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$matrix_id</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span><span id="dqStr">"No matrix ID passed to get_TFFM_by_matrix_ID"</span><span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="comment"># separate matrix stable ID and version number</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$matrix_base_id</span>, <span id="var">$matrix_version</span><span id="braces">)</span> = <span id="perlFunc">split</span><span id="braces">(</span><span id="regExp">/\./</span>, <span id="var">$matrix_id</span><span id="braces">)</span>;

    <span id="comment"># latest matrix version per default</span><br />    <span id="var">$matrix_version</span> = <span id="var">$self</span>-&gt;<span id="method">_get_latest_version</span><span id="braces">(</span><span id="var">$matrix_base_id</span><span id="braces">)</span>
        <span id="perlKey">unless</span> <span id="var">$matrix_version</span>;

    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!! SELECT BASE_ID, VERSION, NAME, LOG_P_1ST_ORDER, LOG_P_DETAILED,
            EXPERIMENT_NAME FROM TFFM WHERE MATRIX_BASE_ID = &quot;$matrix_base_id&quot;
            AND MATRIX_VERSION = &quot;$matrix_version&quot; !</span>
    <span id="braces">)</span>;

    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$base_id</span>, <span id="var">$version</span>, <span id="var">$name</span>, <span id="var">$log_p_1st_order</span>, <span id="var">$log_p_detailed</span>,
        <span id="var">$exp_name</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">my</span> <span id="var">$tffm</span>;
    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$base_id</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">eval</span> <span id="braces">{</span>
            <span id="var">$tffm</span> = <span id="module"><a href="../TFFM.html">TFBS::TFFM</a></span>-&gt;<span id="perlKey">new</span><span id="braces">(</span>
                -ID                 =&gt; <span id="dqStr">"<span id="var">$base_id</span>.<span id="var">$version</span>"</span>,
                -name               =&gt; <span id="var">$name</span>, 
                -log_p_1st_order    =&gt; <span id="var">$log_p_1st_order</span>,
                -log_p_detailed     =&gt; <span id="var">$log_p_detailed</span>,
                -experiment_name    =&gt; <span id="var">$exp_name</span>,

                <span id="comment">#</span><br />                <span id="comment"># OR we could retrieve the matrix and set the corresponding</span><br />                <span id="comment"># attribute</span><br />                <span id="comment">#</span><br />                -matrix_ID          =&gt; <span id="dqStr">"<span id="var">$matrix_base_id</span>.<span id="var">$matrix_version</span>"</span>
            <span id="braces">)</span>
        <span id="braces">}</span>;

        <span id="perlKey">if</span> <span id="braces">(</span>$@<span id="braces">)</span> <span id="braces">{</span>
            <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span>$@<span id="braces">)</span>;
        <span id="braces">}</span>

        <span id="comment">#</span><br />        <span id="comment"># Instead of storing the matrix ID, get the related matrix and store in</span><br />        <span id="comment"># the matrix attribute.</span><br />        <span id="comment">#</span><br />        <span id="comment"># my $matrix = $self-&gt;get_Matrix_by_ID(</span><br />        <span id="comment">#     &quot;$matrix_base_id.$matrix_version&quot;, 'PFM'</span><br />        <span id="comment"># );</span><br />        <span id="comment">#</span><br />        <span id="comment"># $tffm-&gt;matrix($matrix);</span><br />        <span id="comment">#</span><br />    <span id="braces">}</span> <span id="perlKey">else</span> <span id="braces">{</span>
        <span id="perlFunc">warn</span> <span id="dqStr">"No TFFM exists for matrix '<span id="var">$matrix_base_id</span>.$matrix_version'"</span>;
    <span id="braces">}</span>

    <span id="perlKey">return</span> <span id="var">$tffm</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE28" id="CODE28"></a>get_TFFM_by_name</td><td ><a href="#POD9">description</a></td><td ><a href="#CODE27">prev</a></td><td ><a href="#CODE29">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">get_TFFM_by_name</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$name</span><span id="braces">)</span> = <span id="var">@_</span>;

    <span id="perlKey">unless</span> <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$name</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span><span id="dqStr">"No name passed to get_TFFM_by_name."</span><span id="braces">)</span>;
    <span id="braces">}</span>

    <span id="comment"># sanity check: are there many different stable IDs with same name?</span><br />    <span id="perlKey">my</span> <span id="var">$sth</span> = <span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span>
        <span id="perlFunc">qq</span><span id="dqStr">!!SELECT distinct BASE_ID FROM TFFM WHERE NAME=&quot;$name&quot;!</span>
    <span id="braces">)</span>;
    <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;

    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">@stable_ids</span><span id="braces">)</span> = <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">my</span> <span id="var">$L</span> = <span id="perlFunc">scalar</span> <span id="var">@stable_ids</span>;

    <span id="var">$self</span>-&gt;<span id="perlFunc">warn</span><span id="braces">(</span><span id="dqStr">"There are <span id="var">$L</span> distinct stable IDs with name '$name'"</span><span id="braces">)</span>
        <span id="perlKey">if</span> <span id="perlFunc">scalar</span> <span id="var">$L</span> &gt; 1;

    <span id="perlKey">return</span> <span id="var">$self</span>-&gt;<span id="method">get_TFFM_by_ID</span><span id="braces">(</span><span id="var">$stable_ids</span><span id="braces">[</span>0<span id="braces">]</span><span id="braces">)</span>;
<span id="braces">}</span>

<span id="comment">#########################################################################</span><br /><span id="comment"># PRIVATE METHODS</span><br /><span id="comment">#########################################################################</span><br /></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE29" id="CODE29"></a>new</td><td ><a href="#POD10">description</a></td><td ><a href="#CODE28">prev</a></td><td ><a href="#CODE30">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">new</span>
{<pre>    <span id="method">_new</span><span id="braces">(</span><span id="var">@_</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE30" id="CODE30"></a>store_Matrix</td><td ><a href="#POD11">description</a></td><td ><a href="#CODE29">prev</a></td><td ><a href="#CODE31">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">store_Matrix</span>
{<pre>    <span id="comment">#PROBABLY DONE     # collection, version are taken from the corresponding tags. Warn if they are not there</span><br />    ;
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">@PFMs</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$err</span>;
    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$pfm</span> <span id="braces">(</span><span id="var">@PFMs</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="perlKey">eval</span> <span id="braces">{</span>
            <span id="perlKey">my</span> <span id="var">$int_id</span> = <span id="var">$self</span>-&gt;<span id="method">_store_matrix</span><span id="braces">(</span><span id="var">$pfm</span><span id="braces">)</span>
                ;    <span id="comment"># needs to have collection and version</span><br />            <span id="var">$self</span>-&gt;<span id="method">_store_matrix_data</span><span id="braces">(</span><span id="var">$pfm</span>, <span id="var">$int_id</span><span id="braces">)</span>;
            <span id="var">$self</span>-&gt;<span id="method">_store_matrix_annotation</span><span id="braces">(</span><span id="var">$pfm</span>, <span id="var">$int_id</span><span id="braces">)</span>;
            <span id="var">$self</span>-&gt;<span id="method">_store_matrix_species</span><span id="braces">(</span><span id="var">$pfm</span>, <span id="var">$int_id</span><span id="braces">)</span>;
            <span id="var">$self</span>-&gt;<span id="method">_store_matrix_acc</span><span id="braces">(</span><span id="var">$pfm</span>, <span id="var">$int_id</span><span id="braces">)</span>;
        <span id="braces">}</span>;
    <span id="braces">}</span>
    <span id="perlKey">return</span> $@;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE31" id="CODE31"></a>store_MatrixSet</td><td >description</td><td ><a href="#CODE30">prev</a></td><td >next</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">store_MatrixSet</span>
{<pre> <span id="comment">#DONE a wrapper around store_Matrix (which also can take an array of matrices, so utility only</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$matrixset</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$it</span> = <span id="var">$matrixset</span>-&gt;<span id="method">Iterator</span><span id="braces">(</span><span id="braces">)</span>;
    <span id="perlKey">while</span> <span id="braces">(</span><span id="perlKey">my</span> <span id="var">$matrix_object</span> = <span id="var">$it</span>-&gt;<span id="perlKey">next</span><span id="braces">)</span> <span id="braces">{</span>
        <span id="comment"># do whatever you want with individual matrix objects</span><br />        <span id="var">$self</span>-&gt;<span id="method">store_Matrix</span><span id="braces">(</span>
            <span id="var">$matrix_object</span><span id="braces">)</span>;
    <span id="braces">}</span></pre>}</td></div>
<div id="sep"></div>
<a name="General" id="General"></a>
<div id="mainTitle">General documentation</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_JASPAR6 DATA MODEL" id="_pod_JASPAR6 DATA MODEL"></a>JASPAR6 DATA MODEL</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">JASPAR6 is working name for a relational database model used<br />for storing transcriptional factor pattern matrices in a MySQL database.<br />It was initially designed (JASPAR2) to store matrices for the JASPAR database of<br />high quality eukaryotic transcription factor specificity profiles by<br />Albin Sandelin and Wyeth W. Wasserman. Besides the profile matrix itself,<br />this data model stores profile ID (unique), name, structural class,<br />basic taxonomic and bibliographic information<br />as well as some additional, and custom, tags.<br />Here goes a moore thorough description on tables and IDs<br />    <br />    <br />-----------------------  ADVANCED  ---------------------------------<br />For the developers and the curious, here is the JASPAR6 data model:<br /><pre id="podParagraph">  <br /></pre>MISSING TEXT HEER ON HOW IT WORKS<br />It is our best intention to hide the details of this data model, which we <br />are using on a daily basis in our work, from most TFBS users.<br />Most users should only know the methods to store the data and <br />which tags are supported.<br />-------------------------------------------------------------------------</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_FEEDBACK" id="_pod_FEEDBACK"></a>FEEDBACK</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">Please send bug reports and other comments to the author.</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_AUTHOR - Boris Lenhard" id="_pod_AUTHOR - Boris Lenhard"></a>AUTHOR - Boris Lenhard</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">Boris Lenhard &lt;Boris.Lenhard@cgb.ki.se&gt;</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_APPENDIX" id="_pod_APPENDIX"></a>APPENDIX</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">The rest of the documentation details each of the object<br />methods. Internal methods are preceded with an underscore.</div>
<div id="sep"></div>
</body>
</html>
