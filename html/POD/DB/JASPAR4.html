<head>
<!-- Generated by perlmod2www.pl -->
<title>
JASPAR4 documentation.
</title>
<link rel="stylesheet" type="text/css" href="../perl.css">
</head>
<body bgcolor="white">
<span id="modRootPath">TFBS::DB</span>
<span id="modName">JASPAR4</span>
<div id="sep"></div>
<a name="TOP" id="TOP"></a>
<table id="daArea" width="100%"><tr><td id="daEntry" ><a href="#SUMMARY">Summary</a></td><td id="daEntry" ><a href="#libs">Included libraries</a></td><td id="daEntry" ><a href="#vardefs">Package variables</a></td><td id="daEntry" ><a href="#SYNOPSIS">Synopsis</a></td><td id="daEntry" ><a href="#DESCRIPTION">Description</a></td><td id="daEntry" ><a href="#General">General documentation</a></td><td id="daEntry" ><a href="#Methods">Methods</a></td></tr></table>
<div id="sep"></div>
<div id="descTitle">Summary</div>
<div id="descArea"><B>TFBS::DB::JASPAR4</B> - interface to MySQL relational database of pattern matrices</div>
<div id="sep"></div>
<a name="vardefs" id="vardefs"></a><div id="descTitle">Package variables</div>
<div id="descArea"><div id="libEntry">No package variables defined.</div>
</div>
<div id="sep"></div>
<div id="descTitle">Included modules</div>
<div id="descArea"><div id="libEntry"><span id="use">Bio::Root::Root</span> </div>
<div id="libEntry"><span id="use">DBI</span></div>
<div id="libEntry"><span id="use"><a href="../Matrix/ICM.html">TFBS::Matrix::ICM</a></span> </div>
<div id="libEntry"><span id="use"><a href="../Matrix/PFM.html">TFBS::Matrix::PFM</a></span> </div>
<div id="libEntry"><span id="use"><a href="../Matrix/PWM.html">TFBS::Matrix::PWM</a></span> </div>
<div id="libEntry"><span id="use"><a href="../MatrixSet.html">TFBS::MatrixSet</a></span> </div>
</div>
<div id="sep"></div>
<a name="libs" id="libs"></a>
<div id="descTitle">Inherit</div>
<div id="descArea"><span id="isa">Bio::Root::Root</span> <span id="isa"><a href="../DB.html">TFBS::DB</a></span> </div>
<div id="sep"></div>
<a name="SYNOPSIS" id="SYNOPSIS"></a>
<div id="descTitle">Synopsis</div>
<div id="descArea"><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* creating a database object by connecting to the existing JASPAR2-type database</div>&nbsp;&nbsp;&nbsp;&nbsp;<div id="podItemEntry">    my $db = <B>TFBS::DB::JASPAR4</B>-&gt;connect(&quot;dbi:mysql:JASPAR4:myhost&quot;,<br />					&quot;myusername&quot;,<br />					&quot;mypassword&quot;);<br /></div><br /><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* retrieving a TFBS::Matrix::* object from the database</div>&nbsp;&nbsp;&nbsp;&nbsp;<div id="podItemEntry">    # retrieving a PFM by ID<br />    my $pfm = $db-&gt;get_Matrix_by_ID('M0079','PFM');<br /> <br />    #retrieving a PWM by name<br />    my $pwm = $db-&gt;get_Matrix_by_name('NF-kappaB', 'PWM');<br /></div><br /><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* retrieving a set of matrices as a TFBS::MatrixSet object according to various criteria</div><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* creating a new JASPAR4-type database named MYJASPAR4:</div><div id="podItem">&nbsp;&nbsp;&nbsp;&nbsp;* storing a matrix in the database (currently only PFMs):</div>&nbsp;&nbsp;&nbsp;&nbsp;<div id="podItemEntry">    #let $pfm is a TFBS::Matrix::PFM object<br />    $db-&gt;store_Matrix($pfm);<br /></div><br />
</div>
<div id="sep"></div>
<a name="DESCRIPTION" id="DESCRIPTION"></a>
<div id="descTitle">Description</div>
<div id="descArea"><B>TFBS::DB::JASPAR4</B> is a read/write database interface module that<br />retrieves and stores TFBS::Matrix::* and TFBS::MatrixSet<br />objects in a relational database. The interface is nearly identical<br />to the JASPAR2interface, while the underlying data model is different
</div>
<div id="sep"></div>
<a name="Methods" id="Methods"></a>
<div id="descTitle">Methods</div>
<table id="methIndArea" width="100%" cellspacing="0"><tr><td id="methIndEntry">connect</td><td id="methIndEntry"><a href="#POD1">Description</a></td><td id="methIndEntry"><a href="#CODE1">Code</a></td></tr>
<tr><td id="methIndEntry">create</td><td id="methIndEntry"><div id="error">No description</div></td><td id="methIndEntry"><a href="#CODE2">Code</a></td></tr>
<tr><td id="methIndEntry">dbh</td><td id="methIndEntry"><a href="#POD2">Description</a></td><td id="methIndEntry"><a href="#CODE3">Code</a></td></tr>
<tr><td id="methIndEntry">get_Matrix_by_ID</td><td id="methIndEntry"><a href="#POD3">Description</a></td><td id="methIndEntry"><a href="#CODE4">Code</a></td></tr>
<tr><td id="methIndEntry">new</td><td id="methIndEntry"><a href="#POD4">Description</a></td><td id="methIndEntry"><a href="#CODE5">Code</a></td></tr>
<tr><td id="methIndEntry">store_Matrix</td><td id="methIndEntry"><a href="#POD5">Description</a></td><td id="methIndEntry"><a href="#CODE6">Code</a></td></tr>
</table>
<div id="sep"></div>
<a name="MethDesc" id="MethDesc"></a>
<div id="mainTitle">Methods description</div>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_connect" id="_pod_connect"></a><a name="POD1" id="POD1"></a>connect</td><td ><a href="#CODE1">code</a></td><td >&nbsp;&nbsp;&nbsp;&nbsp;</td><td ><a href="#POD2">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : connect
 Usage   : my $db =
	    <B>TFBS::DB::JASPAR4</B>->connect("dbi:mysql:DATABASENAME:HOSTNAME",
					"USERNAME",
					"PASSWORD");
 Function: connects to the existing JASPAR4-type database and
	   returns a database object that interfaces the database
 Returns : a <B>TFBS::DB::JASPAR4</B> object
 Args    : a standard database connection triplet
	   ("dbi:mysql:DATABASENAME:HOSTNAME",  "USERNAME", "PASSWORD")
	   In place of DATABASENAME, HOSTNAME, USERNAME and PASSWORD,
	   use the actual values. PASSWORD and USERNAME might be
	   optional, depending on the user's acces permissions for
	   the database server.</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_dbh" id="_pod_dbh"></a><a name="POD2" id="POD2"></a>dbh</td><td ><a href="#CODE3">code</a></td><td ><a href="#POD1">prev</a></td><td ><a href="#POD3">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : dbh
 Usage   : my $dbh = $db->dbh();
	   $dbh->do("UPDATE matrix_data SET name='ADD1' WHERE NAME='SREBP2'");
 Function: returns the DBI database handle of the MySQL database
	   interfaced by $db; THIS IS USED FOR WRITING NEW METHODS
	   FOR DIRECT RELATIONAL DATABASE MANIPULATION - if you
	   have write access AND do not know what you are doing,
	   you can severely  corrupt the data
	   For documentation about database handle methods, see <a href="#_pod_DBI">DBI</a><br /> Returns : the database (DBI) handle of the MySQL JASPAR2-type<br />	   relational database associated with the TFBS::DB::JASPAR2<br />	   object<br /> Args    : none</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_get_Matrix_by_ID" id="_pod_get_Matrix_by_ID"></a><a name="POD3" id="POD3"></a>get_Matrix_by_ID</td><td ><a href="#CODE4">code</a></td><td ><a href="#POD2">prev</a></td><td ><a href="#POD4">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : get_Matrix_by_ID
 Usage   : my $pfm = $db->get_Matrix_by_ID('M00034', 'PFM');
 Function: fetches matrix data under the given ID from the
           database and returns a TFBS::Matrix::* object
 Returns : a TFBS::Matrix::* object; the exact type of the
	   object depending on what form the matrix is stored
	   in the database (PFM is default)
 Args    : (Matrix_ID)
	   Matrix_ID is a string;</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_new" id="_pod_new"></a><a name="POD4" id="POD4"></a>new</td><td ><a href="#CODE5">code</a></td><td ><a href="#POD3">prev</a></td><td ><a href="#POD5">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : new
 Usage   : DEPRECATED - for backward compatibility only
           Use connect() or create() instead</pre></td></tr></table>
<div id="sep"></div>
<table id="methDescTitle" width="100%"><tr><td WIDTH="200"><a name="_pod_store_Matrix" id="_pod_store_Matrix"></a><a name="POD5" id="POD5"></a>store_Matrix</td><td ><a href="#CODE6">code</a></td><td ><a href="#POD4">prev</a></td><td ><a href="#POD6">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<table id="methDescArea" width="100%"><tr><td><pre id="podParagraph"> Title   : store_Matrix
 Usage   : $db->store_Matrix($matrixobject);
 Function: Stores the contents of a TFBS::Matrix::DB object in the database
 Returns : 0 on success; $@ contents on failure
	   (this is too C-like and may change in future versions)
 Args    : (PFM_object)
	   A TFBS::Matrix::PFM, FBS::Matrix::PWM or FBS::Matrix::ICM object.
	   PFM object are recommended to use, as they are eaily converted to
	   other formats
 Comment : this is an experimental method that is not 100% bulletproof;
	   use at your own risk</pre></td></tr></table>
<div id="sep"></div>
<a name="MethCode" id="MethCode"></a>
<div id="mainTitle">Methods code</div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE1" id="CODE1"></a>connect</td><td ><a href="#POD1">description</a></td><td >prev</td><td ><a href="#CODE2">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">connect</span>
{<pre>    <span id="comment"># a more intuitive syntax for the constructor</span><br />    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$caller</span>, <span id="var">@connection_args</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="var">$caller</span>-&gt;<span id="perlKey">new</span><span id="braces">(</span>-<span id="perlFunc">connect</span> =&gt;\@ connection_args<span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE2" id="CODE2"></a>create</td><td >description</td><td ><a href="#CODE1">prev</a></td><td ><a href="#CODE3">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">create</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$caller</span>, <span id="var">$connectstring</span>, <span id="var">$user</span>, <span id="var">$password</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">if</span> <span id="braces">(</span><span id="var">$connectstring</span> 
	and <span id="var">$connectstring</span> =~ <span id="regExp">/dbi:mysql:(\w+)(.*)/</span><span id="braces">)</span>  
    <span id="braces">{</span>
	<span id="comment"># connect to the server;</span><br />	<span id="perlKey">my</span> <span id="var">$dbh</span>=<span id="method">DBI</span><span id="method">->connect</span><span id="braces">(</span><span id="dqStr">"dbi:mysql:mysql"</span>.<span id="var">$2</span>,
			     <span id="var">$user</span>,<span id="var">$password</span><span id="braces">)</span>
	    or <span id="perlFunc">die</span><span id="braces">(</span><span id="dqStr">"Error connecting to the database"</span><span id="braces">)</span>; 

	<span id="comment"># create database and open it</span><br />	<span id="var">$dbh</span>-&gt;<span id="perlKey">do</span><span id="braces">(</span><span id="dqStr">"create database <span id="var">$1</span>"</span><span id="braces">)</span> 
	    or <span id="perlFunc">die</span><span id="braces">(</span><span id="dqStr">"Error creating database."</span><span id="braces">)</span>;
	<span id="var">$dbh</span>-&gt;<span id="perlKey">do</span><span id="braces">(</span><span id="dqStr">"use <span id="var">$1</span>"</span><span id="braces">)</span>; 
	
	<span id="comment"># create tables</span><br />	<span id="method">_create_tables</span><span id="braces">(</span><span id="var">$dbh</span><span id="braces">)</span>;

	<span id="var">$dbh</span>-&gt;<span id="method">disconnect</span>;

	<span id="comment"># run &quot;new&quot; with new database</span><br />
	<span id="perlKey">return</span> <span id="var">$caller</span>-&gt;<span id="perlKey">new</span><span id="braces">(</span>-<span id="perlFunc">connect</span>=&gt;<span id="braces">[</span><span id="var">$connectstring</span>, <span id="var">$user</span>, <span id="var">$password</span><span id="braces">]</span><span id="braces">)</span>;
    <span id="braces">}</span>
    <span id="perlKey">else</span>  <span id="braces">{</span>
	<span id="perlFunc">die</span><span id="braces">(</span><span id="dqStr">"Missing or malformed connect string for "</span>.
		     <span id="dqStr">"TFBS::DB::JASPAR2 connection."</span><span id="braces">)</span>; 
    <span id="braces">}</span></pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE3" id="CODE3"></a>dbh</td><td ><a href="#POD2">description</a></td><td ><a href="#CODE2">prev</a></td><td ><a href="#CODE4">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">dbh</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$dbh</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'dbh'</span><span id="braces">}</span> = <span id="var">$dbh</span> <span id="perlKey">if</span> <span id="var">$dbh</span>;
    <span id="perlKey">return</span> <span id="var">$self</span>-&gt;<span id="braces">{</span><span id="sqStr">'dbh'</span><span id="braces">}</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE4" id="CODE4"></a>get_Matrix_by_ID</td><td ><a href="#POD3">description</a></td><td ><a href="#CODE3">prev</a></td><td ><a href="#CODE5">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">get_Matrix_by_ID</span>
{<pre>
    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">$ID</span>, <span id="var">$mt</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="var">$mt</span> = <span id="braces">(</span><span id="perlFunc">uc</span><span id="braces">(</span><span id="var">$mt</span><span id="braces">)</span> or <span id="dqStr">"PWM"</span><span id="braces">)</span>;

    <span id="perlKey">unless</span> <span id="braces">(</span><span id="perlFunc">defined</span> <span id="var">$ID</span><span id="braces">)</span> <span id="braces">{</span>
	<span id="var">$self</span>-&gt;<span id="method">throw</span><span id="braces">(</span><span id="dqStr">"No ID passed to get_Matrix_by_ID"</span><span id="braces">)</span>;
    <span id="braces">}</span>
    <span id="perlKey">my</span> <span id="var">$matrixobj</span>;
    <span id="braces">{</span>
	<span id="perlFunc">no</span> strict <span id="sqStr">'refs'</span>;
	<span id="perlKey">my</span> <span id="var">$ucmt</span> = <span id="perlFunc">uc</span> <span id="var">$mt</span>;
	<span id="perlKey">my</span> <span id="var">$matrixstring</span> = <span id="var">$self</span>-&gt;<span id="method">_get_matrixstring</span><span id="braces">(</span><span id="var">$ID</span><span id="braces">)</span> || <span id="perlKey">return</span> <span id="perlFunc">undef</span>;
        <span id="comment"># get type of matrix</span><br />        <span id="perlKey">my</span> <span id="var">$sth</span>=<span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span><span id="perlFunc">qq</span><span id="dqStr">{SELECT type FROM MATRIX_INFO WHERE ID = '$ID'}</span><span id="braces">)</span>;
        <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;
        <span id="perlKey">my</span> <span id="var">$type</span>=<span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span>; 
	
	
	<span id="comment"># get reast of annotation as tags</span><br />        <span id="var">$sth</span>=<span id="var">$self</span>-&gt;<span id="method">dbh</span>-&gt;<span id="method">prepare</span><span id="braces">(</span><span id="perlFunc">qq</span><span id="dqStr">{SELECT tag, val FROM MATRIX_ANNOTATION WHERE ID = '$ID' }</span><span id="braces">)</span>;
        <span id="var">$sth</span>-&gt;<span id="method">execute</span><span id="braces">(</span><span id="braces">)</span>;
        <span id="perlKey">my</span> <span id="var">%tags</span>;
        <span id="perlKey">while</span> <span id="braces">(</span> <span id="perlKey">my</span><span id="braces">(</span><span id="var">$tag</span>, <span id="var">$val</span><span id="braces">)</span>= <span id="var">$sth</span>-&gt;<span id="method">fetchrow_array</span><span id="braces">(</span><span id="braces">)</span><span id="braces">)</span><span id="braces">{</span>
            <span id="var">$tags</span><span id="braces">{</span><span id="var">$tag</span><span id="braces">}</span>=<span id="var">$val</span>;
        <span id="braces">}</span>
	<span id="perlKey">my</span> <span id="var">$name</span>= <span id="var">$tags</span><span id="braces">{</span><span id="sqStr">'name'</span><span id="braces">}</span>;
        <span id="perlKey">my</span> <span id="var">$class</span>= <span id="var">$tags</span><span id="braces">{</span><span id="sqStr">'class'</span><span id="braces">}</span>;                    
	<span id="perlFunc">delete</span>   <span id="braces">(</span><span id="var">$tags</span><span id="braces">{</span><span id="sqStr">'name'</span><span id="braces">}</span><span id="braces">)</span>;
	<span id="perlFunc">delete</span> <span id="braces">(</span><span id="var">$tags</span><span id="braces">{</span><span id="sqStr">'class'</span><span id="braces">}</span><span id="braces">)</span>;
	
    	<span id="perlKey">eval</span> <span id="braces">(</span><span id="dqStr">"\<span id="var">$matrixobj</span>= TFBS::Matrix::<span id="var">$type</span>-&gt;new"</span>.<span id="sqStr">' <br />	    ( -ID    =&gt; $ID.&quot;&quot;,<br />            -name =&gt;$name, <br />	    -class =&gt; $class,<br />              -tags  =&gt;\% tags,<br />	     -matrixstring=&gt; $matrixstring   # FIXME - temporary<br />            );'</span><span id="braces">)</span>;
	<span id="comment">#if ($@) {$self-&gt;throw($@); }</span><br />	
    
    <span id="comment">#print &quot;ref:&quot;,ref ($matrixobj);</span><br />


    <span id="braces">}</span>

   <span id="comment"># print $matrixobj-&gt;ID();</span><br />  <span id="comment">#  print &quot;here\n&quot;;print $matrixobj-&gt;prettyprint();</span><br />    <span id="perlKey">return</span> <span id="braces">(</span><span id="var">$matrixobj</span><span id="braces">)</span>;
<span id="braces">}</span>


=head2 get_Matrix_by_name

 Title   : get_Matrix_by_name
 Usage   : <span id="perlKey">my</span> <span id="var">$pfm</span> = <span id="var">$db</span>-&gt;<span id="method">get_Matrix_by_name</span><span id="braces">(</span><span id="sqStr">'HNF-1'</span><span id="braces">)</span>;
 Function: fetches matrix data under the given name from the
	   database and returns a <span id="module"><a href="../Matrix.html">TFBS::Matrix::</a></span>* object
 Returns : a <span id="module"><a href="../Matrix.html">TFBS::Matrix::</a></span>* object; the exact type of the object
	   depending on what form the matrix object was stored in
	   the database <span id="braces">(</span>default PFM<span id="braces">)</span><span id="braces">)</span>
 Args    : <span id="braces">(</span>Matrix_name<span id="braces">)</span>
	   
 Warning : According to the current JASPAR4 data model, name is
	   <span id="perlKey">not</span> necessarily a unique identifier. In the case where
	   there are several matrices with the same name in the
	   database, the function fetches the first one and prints
	   a warning on STDERR. You<span id="sqStr">'ve been warned.<br /><br />=cut<br /><br /><br /><br />sub get_Matrix_by_name {<br />    my ($self, $name, $mt) = @_;<br />    unless(defined $name) { <br />	$self-&gt;throw(&quot;No name passed to get_Matrix_by_name.&quot;); }<br /><br />    my @IDlist = $self-&gt;_get_IDlist_by_query(-name=&gt;[$name]);<br />    my $ID= ($IDlist[0] <br />	    or $self-&gt;warn(&quot;No matrix with name $name found.&quot;));<br />    if ((my $L= scalar @IDlist) &gt; 1)  {<br />	$self-&gt;warn(&quot;There are $L matrices with name '</span><span id="var">$name</span><span id="sqStr">'&quot;);<br />    }<br />    return $self-&gt;get_Matrix_by_ID($ID);<br />}<br /><br /><br />=head2 get_MatrixSet<br /><br /> Title   : get_MatrixSet<br /> Usage   : my $matrixset = $db-&gt;get_MatrixSet(%args);<br /> Function: fetches matrix data under for all matrices in the database<br />	   matching criteria defined by the named arguments<br />	   and returns a TFBS::MatrixSet object<br /> Returns : a TFBS::MatrixSet object<br /> Args    : This method accepts named arguments, corresponding to arbitrary tags.<br />           Note that this is different from JASPAR2. As any tag is supported for<br />           database storage, any tag can be used for information retrieval.<br />           Additionally, arguments as '</span>name<span id="sqStr">' and '</span>class<span id="sqStr">' can be used (even though<br />           they are not tags.<br />           As with get_Matrix methods, it is important to realize taht any matrix<br />           format can be stored in the database: the TFBS::MatrixSet might therefore<br />           consist of PFMs, ICMs and PWMS, depending on how matrices are stored,<br />           <br />           Examples include<br />	   -ID        # a reference to an array of IDs (strings)<br />	   -name      # a reference to an array of<br />		       #  transcription factor names (string)<br />	   -class    # a reference to an array of<br />		       #  structural class names (strings)<br />	   -species    # a reference to an array of<br />		       #   Latin species names (strings)<br />	   -sysgroup  # a reference to an array of<br />		       #  higher taxonomic categories (strings)<br /><br />	  <br />	   -min_ic     # float, minimum total information content<br />		       #   of the matrix. IMPORTANT:if retrieved matrices are in PWM<br />		       format there is no way to measureinformation content.<br />	-matrixtype    #string describing type of matrix to retrieve. If left out, the format<br />                        will revert to the database format. Note that this option only works<br />                      if the database format is pfm<br /><br />The arguments that expect list references are used in database<br />query formulation: elements within lists are combined with '</span>OR<span id="sqStr">'<br />operators, and the lists of different types with '</span>AND<span id="sqStr">'. For example,<br /><br />    my $matrixset = $db-&gt;(-class =&gt; ['</span>TRP_CLUSTER<span id="sqStr">', '</span>FORKHEAD<span id="sqStr">'],<br />			  -species =&gt; ['</span>Homo sapiens<span id="sqStr">', '</span>Mus musculus<span id="sqStr">'],<br />			  );<br /><br />gives a set of TFBS::Matrix::PFM objects (given that the matrix models are stored as such)<br /> whose (structural clas is '</span>TRP_CLUSTER<span id="sqStr">' OR'</span>FORKHEAD<span id="sqStr">') AND (the species they are derived<br /> from is '</span>Homo sapiens<span id="sqStr">'OR '</span>Mus musculus<span id="sqStr">').<br /><br />The -min_ic filter is applied after the query in the sense that the<br />matrices profiles with total infromation content less than specified<br />are not included in the set.<br /><br />=cut<br /><br /><br />sub get_MatrixSet  {<br />    my ($self, %args) = @_;<br />    <br />    <br />    <br />    my @IDlist = $self-&gt;_get_IDlist_by_query(%args);<br />    my $type;<br />    my $matrixset = TFBS::MatrixSet-&gt;new();<br />    <br />    foreach (@IDlist)  {<br />       # print &quot;$_\n&quot;;<br />    }<br />    <br />    foreach (@IDlist)  {<br />	#next if (defined $args{'</span>-min_ic<span id="sqStr">'} <br />	#	 and $_-&gt;_get_total_ic($_) &lt; $args{'</span>-min_ic<span id="sqStr">'});<br />            #evaluate total information content: ivolves actually retrieving matrix<br />            # is actually a problem if matrix is stored PWM: thro an error if so<br />	<br />	my $matrix=$self-&gt;get_Matrix_by_ID($_);<br />	#evaluate<br />	#ugly code:<br />	if (defined $args{'</span>-min_ic<span id="sqStr">'} ){<br />            if ($matrix-&gt;isa(&quot;TFBS::Matrix::PFM&quot;)){<br />                next if ( $matrix-&gt;to_ICM-&gt;total_ic() &lt; $args{'</span>-min_ic<span id="sqStr">'});     <br />            }<br />            if ($matrix-&gt;isa(&quot;TFBS::Matrix::ICM&quot;)){<br />                next if ($matrix-&gt;total_ic() &lt; $args{'</span>-min_ic<span id="sqStr">'});     <br />            }<br />            if ($matrix-&gt;isa(&quot;TFBS::Matrix::PWM&quot;)){<br />                $self-&gt;throw(&quot;Cannot evaluate information constent from PWM matrices&quot;);<br />            }<br />	<br />	<br />        <br />        <br />	}<br />	#ugly code:<br /><br />        if ($args{'</span>-matrixtype<span id="sqStr">'} &amp;&amp; $matrix-&gt;isa(&quot;TFBS::Matrix::PFM&quot;)){<br />            if (      $args{'</span>-matrixtype<span id="sqStr">'} eq ('</span>PWM<span id="sqStr">')) {<br />               # warn &quot;change&quot;;<br />                $matrix= $matrix-&gt;to_PWM();<br />        }<br />	if (      $args{'</span>-matrixtype<span id="sqStr">'} eq ('</span>ICM<span id="sqStr">')) {<br />                #warn &quot;change&quot;;<br />                $matrix= $matrix-&gt;to_PWM();<br />        }<br />    }<br />	<br />	<br />        $matrixset-&gt;add_Matrix($matrix);<br />    }<br />    return $matrixset;<br />}<br /><br /><br /><br />sub store_MatrixSet {<br />    $_[0]-&gt;throw (&quot;Method store_MtrixSet not yet implemented.&quot;);<br />}<br /><br />=head2 delete_Matrix_having_ID<br /><br /> Title   : delete_Matrix_having_ID<br /> Usage   : $db-&gt;delete_Matrix_with_ID('</span>M00045<span id="sqStr">');<br /> Function: Deletes the matrix having the given ID from the database<br /> Returns : 0 on success; $@ contents on failure<br />	   (this is too C-like and may change in future versions)<br /> Args    : (ID)<br />	   A string<br /> Comment : Yeah, yeah, '</span>delete_Matrix_having_ID<span id="sqStr">' is a stupid name<br />	   for a method, but at least it should be obviuos what it does.<br /><br />=cut<br /><br /><br />sub delete_Matrix_having_ID  {<br />    my ($self, @IDs) = @_;<br />    eval  {<br />	foreach my $ID (@IDs) {<br />	    my $q_ID = $self-&gt;dbh-&gt;quote($ID);<br />	    foreach my $table (qw  (MATRIX_DATA<br />				    MATRIX_INFO<br />				    MATRIX_ANNOTATION<br />				    )<br />				)<br />	    {<br />		$self-&gt;dbh-&gt;do(&quot;DELETE from $table where ID=$q_ID&quot;);<br />	    }<br />	}<br />    };<br />    return $@;<br />    <br />}<br /><br /><br /><br />#########################################################################<br /># PRIVATE METHODS<br />#########################################################################<br /><br /><br />sub _new  {<br />    my ($caller, %args)  = @_;<br />    my $class = ref $caller || $caller;<br />    my $self = bless {}, $class;<br /><br />    my ($connectstring, $user, $password);<br /> <br />    if ($args{'</span>-<span id="perlFunc">connect</span><span id="sqStr">'} and (ref($args{'</span>-<span id="perlFunc">connect</span><span id="sqStr">'}) eq &quot;ARRAY&quot;))  {<br />	($connectstring, $user, $password) = @{$args{'</span>-<span id="perlFunc">connect</span><span id="sqStr">'}};<br />    }<br />    elsif ($args{'</span>-create<span id="sqStr">'} and (ref($args{'</span>-create<span id="sqStr">'}) eq &quot;ARRAY&quot;))  {<br />	return $caller-&gt;create(@{-args{'</span>create<span id="sqStr">'}});<br />    }<br />    else  {<br />	($connectstring, $user, $password) = <br />	    (DEFAULT_CONNECTSTRING, DEFAULT_USER, DEFAULT_PASSWORD);<br />    }<br /><br />    $self-&gt;dbh( DBI-&gt;connect($connectstring, $user, $password) );<br />    <br />    return $self;<br />}<br /><br /><br />sub _store_matrix_data  {<br />    my ($self, $pfm, $ACTION) = @_;<br />    my @base = qw(A C G T);<br />    my $matrix = $pfm-&gt;matrix();<br />    my $type;<br />    my $sth = $self-&gt;dbh-&gt;prepare <br />	(q! INSERT INTO MATRIX_DATA VALUES(?,?,?,?) !);<br />				 <br />    for my $i (0..3)  {<br />	for my $j (0..($pfm-&gt;length-1)) {<br />	    $sth-&gt;execute( $pfm-&gt;ID,<br />			   <br />			   $base[$i],<br />			   $j+1,<br />			   $matrix-&gt;[$i][$j]<br />	    )<br />	   or $self-&gt;throw(&quot;Error executing query.&quot;);<br />	}<br />    }<br />    <br />}<br /><br /><br />sub _store_matrix_info  {<br /><br />    my ($self, $pfm, $ACTION) = @_;<br /><br />    my $type;<br />    $type= '</span>PFM<span id="sqStr">' if $pfm-&gt;isa(&quot;TFBS::Matrix::PFM&quot;);<br />    $type= '</span>PWM<span id="sqStr">' if $pfm-&gt;isa(&quot;TFBS::Matrix::PWM&quot;);<br />    $type= '</span>ICM<span id="sqStr">' if $pfm-&gt;isa(&quot;TFBS::Matrix::ICM&quot;);<br /><br /><br />    my $sth = $self-&gt;dbh-&gt;prepare <br />	(q! INSERT INTO MATRIX_INFO<br />	    (ID, type) <br />	    VALUES(?,?) !);<br />    $sth-&gt;execute($pfm-&gt;ID,<br />		  $type, <br />		  )<br />	or $self-&gt;throw(&quot;Error executing query&quot;);<br />}<br /><br /><br /><br /><br /><br /><br />sub _store_matrix_annotation  {<br />    my ($self, $pfm, $ACTION) = @_;<br />    my $sth = $self-&gt;dbh-&gt;prepare <br />	(q! INSERT INTO MATRIX_ANNOTATION<br />	    (ID, tag, val) <br />	    VALUES(?,?,?) !);<br />    <br />    $sth-&gt;execute($pfm-&gt;ID,<br />                    '</span>name<span id="sqStr">',<br />                    ($pfm-&gt;name() or &quot;&quot;),<br />    );<br />    $sth-&gt;execute($pfm-&gt;ID,<br />                    '</span>class<span id="sqStr">',<br />                    ($pfm-&gt;class() or &quot;&quot;),<br />    );<br />    <br />    # get all tags	<br />	<br />    my %tags= $pfm-&gt;all_tags();<br />    foreach my $tag( keys %tags){<br />    $sth-&gt;execute($pfm-&gt;ID,<br />                    $tag, <br />                   ($tags{$tag} or &quot;&quot;),<br />                 )<br />    <br />	or $self-&gt;throw(&quot;Error executing query&quot;);<br />    }	<br />}<br /><br /><br /><br /><br /><br /><br /><br />#when creating: try to support arbitrary tags<br /><br />sub _create_tables {<br />    # utility function<br /><br />    # If you want to change the databse schema,<br />    # this is the right place to do it<br /><br />    my $dbh = shift;<br /><br />    my @queries = <br />	(<br />       q!<br />        CREATE TABLE MATRIX_DATA(<br />	ID VARCHAR (16) DEFAULT '</span><span id="sqStr">' NOT NULL,<br />	row VARCHAR(1) NOT NULL, <br />	col TINYINT(3) UNSIGNED NOT NULL, <br />	val FLOAT, <br />	PRIMARY KEY (ID, row, col)<br />	)<br />       !,<br />       q!<br />       CREATE TABLE MATRIX_INFO( <br />	ID VARCHAR (16) DEFAULT '</span><span id="sqStr">' NOT NULL PRIMARY KEY , <br /> 	type ENUM ('</span>PFM<span id="sqStr">', '</span>ICM<span id="sqStr">','</span>PWM<span id="sqStr">') DEFAULT '</span>PFM<span id="sqStr">' NOT NULL <br />	)<br />       !,<br />       <br />       q!<br />        CREATE TABLE MATRIX_ANNOTATION(<br />        ID VARCHAR (16) DEFAULT '</span><span id="sqStr">' NOT NULL,<br />	tag VARCHAR(255) DEFAULT '</span><span id="sqStr">' NOT NULL,<br />	val TEXT,<br />	PRIMARY KEY (ID, tag)<br />	)<br />        !,<br />        <br />    );<br />    foreach my $query (@queries)  {<br />	$dbh-&gt;do($query) <br />	    or die(&quot;Error executing the query: $query\n&quot;);<br />    }<br />}<br /><br /><br /><br />sub _get_matrixstring  {<br />    my ($self, $ID) = @_;<br />    #my %dbname = (PWM =&gt; '</span>pwm<span id="sqStr">', PFM =&gt; '</span>raw<span id="sqStr">', ICM =&gt; '</span>info<span id="sqStr">');<br />    #unless (defined $dbname{$mt})  {<br />	#$self-&gt;throw(&quot;Unsupported matrix type: &quot;.$mt);<br />    #}<br />    my $sth;<br />    my $qID = $self-&gt;dbh-&gt;quote($ID);<br />    my $matrixstring = &quot;&quot;;<br />    foreach my $base (qw(A C G T)) {<br />	$sth=$self-&gt;dbh-&gt;prepare<br />	    (&quot;SELECT val FROM MATRIX_DATA <br />              WHERE ID=$qID AND row='</span><span id="var">$base</span><span id="sqStr">' ORDER BY col&quot;);<br />	$sth-&gt;execute;<br />	$matrixstring .=<br />	    join (&quot; &quot;, (map {$_-&gt;[0]} @{$sth-&gt;fetchall_arrayref()})).&quot;\n&quot;;<br />    }<br />    $sth-&gt;finish;<br />    return undef if $matrixstring eq &quot;\n&quot;x4;<br /><br />    return $matrixstring;<br />}<br /><br /><br /><br /><br /><br />sub _get_IDlist_by_query  {<br /><br />    # called by get_MatrixSet<br />    # should be able to search for arbitrary tags...hmmm<br />    my ($self, %args) = @_;<br />    my ($TABLES, %arrayref);<br />    my (%intersected_set);<br />    <br /><br />    foreach my $key(keys %args){<br />       <br />        unless ( $key eq &quot;-min_ic&quot; or $key eq  &quot;-matrixtype&quot;){<br />                my $oldkey=$key;<br />                $key=~s/-//;<br />                $arrayref{$key}= $args{$oldkey};<br />        }<br />    }<br />    my @andconditions;<br />    <br />      <br />    $TABLES = '</span>MATRIX_ANNOTATION <span id="sqStr">';<br />    <br />    #special case: get all matrices<br />    unless (keys %arrayref){<br />       <br />            <br />        <br />     my $query = &quot;SELECT DISTINCT ID FROM $TABLES &quot;;<br />        <br />     my $sth = $self-&gt;dbh-&gt;prepare($query);<br />     $sth-&gt;execute() or $self-&gt;throw(&quot;Query failed:\n$query\n&quot;);<br />     my @ary;<br />     <br />     while (my ($id) = $sth-&gt;fetchrow_array())  {<br />           push (@ary, $id);<br />            <br />        }   <br />    <br />        return(@ary);<br />    <br />    }<br />    <br />    <br />    <br />    <br />    <br />    foreach my $key (keys %arrayref)  {<br />        #print &quot;key: $key\n&quot;;<br />        if ($key eq '</span>ID<span id="sqStr">'){<br />         push @andconditions,<br />	&quot;(&quot;.<br />	join(&quot; OR &quot;,<br />	     (map {&quot;MATRIX_ANNOTATION.ID=&quot;.<br />		       $self-&gt;dbh-&gt;quote($_)<br />		  } <br />	      @{$arrayref{$key}}<br />	     )).<br />	&quot;)&quot;;   <br />            <br />            <br />            <br />        }<br />        else{<br />        push @andconditions,<br />	&quot;(&quot;.<br />	join(&quot; OR &quot;,<br />	     (map {&quot;MATRIX_ANNOTATION.tag=&quot;. $self-&gt;dbh-&gt;quote($key).&quot; AND val=&quot;.<br />		       $self-&gt;dbh-&gt;quote($_)<br />		  } <br />	      @{$arrayref{$key}}<br />	     )).<br />	&quot;)&quot;;<br />        }<br />        push (@andconditions, 1) unless(@andconditions);<br />        my $WHERE = ((scalar @andconditions) == 0) ? &quot;&quot; : &quot; WHERE &quot;;<br /><br />     <br />      <br />    my $query = <br />	    &quot;SELECT DISTINCT ID FROM $TABLES $WHERE&quot;.<br />	    join(&quot; AND &quot;, @andconditions);<br />   <br />       # warn  $query; <br />        undef @andconditions;<br />        my $sth = $self-&gt;dbh-&gt;prepare($query);<br />        $sth-&gt;execute() or $self-&gt;throw(&quot;Query failed:\n$query\n&quot;);<br />    <br />        # collect IDs and return<br /><br />        my %current_query;<br />        while (my ($id) = $sth-&gt;fetchrow_array())  {<br />           $current_query{$id}=1;<br />            <br />        }<br />        unless (%intersected_set){<br />            %intersected_set= %current_query;<br />            next;<br />        }<br />        # do intersect<br />        foreach my $key (keys %intersected_set){<br />              delete $intersected_set{ $key}  unless $current_query{$key};<br />            <br />        }<br />    } <br />    <br />    my @ary;<br />    foreach my $key (keys %intersected_set){<br />        push (@ary, $key);<br />       # warn &quot;$key\n&quot;;<br />    }<br />    return (@ary);<br />    <br />    <br />}<br /><br />sub DESTROY  {<br />    $_[0]-&gt;dbh-&gt;disconnect() if $_[0]-&gt;dbh;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE5" id="CODE5"></a>new</td><td ><a href="#POD4">description</a></td><td ><a href="#CODE4">prev</a></td><td ><a href="#CODE6">next</a></td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">new</span>
{<pre>  _new <span id="braces">(</span><span id="var">@_</span><span id="braces">)</span>;</pre>}</td></div>
<div id="sep"></div>
<table id="methCodeTitle" width="100%"><tr><td width="200"><a name="CODE6" id="CODE6"></a>store_Matrix</td><td ><a href="#POD5">description</a></td><td ><a href="#CODE5">prev</a></td><td >next</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="methCodeArea"><td ><span id="sub">sub</span> <span id="subName">store_Matrix</span>
{<pre>    <span id="perlKey">my</span> <span id="braces">(</span><span id="var">$self</span>, <span id="var">@PFMs</span><span id="braces">)</span> = <span id="var">@_</span>;
    <span id="perlKey">my</span> <span id="var">$err</span>;
    <span id="perlKey">foreach</span> <span id="perlKey">my</span> <span id="var">$pfm</span> <span id="braces">(</span><span id="var">@PFMs</span><span id="braces">)</span>  <span id="braces">{</span>
	<span id="perlKey">eval</span> <span id="braces">{</span>
	    <span id="var">$self</span>-&gt;<span id="method">_store_matrix_data</span><span id="braces">(</span><span id="var">$pfm</span><span id="braces">)</span>;
	    <span id="var">$self</span>-&gt;<span id="method">_store_matrix_info</span><span id="braces">(</span><span id="var">$pfm</span><span id="braces">)</span>;
	    <span id="var">$self</span>-&gt;<span id="method">_store_matrix_annotation</span><span id="braces">(</span><span id="var">$pfm</span><span id="braces">)</span>;
	    <span id="comment">#$self-&gt;_store_matrix_species($pfm);</span><br />	<span id="braces">}</span>;
    <span id="braces">}</span>
    <span id="perlKey">return</span> $@;</pre>}</td></div>
<div id="sep"></div>
<a name="General" id="General"></a>
<div id="mainTitle">General documentation</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_JASPAR2 DATA MODEL" id="_pod_JASPAR2 DATA MODEL"></a>JASPAR2 DATA MODEL</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">JASPAR4 is working name for a relational database model used<br />for storing transcriptional factor pattern matrices in a MySQL database.<br />It was initially designed (JASPAR2) to store matrices for the JASPAR database of<br />high quality eukaryotic transcription factor specificity profiles by<br />Albin Sandelin and Wyeth W. Wasserman. Besides the profile matrix itself,<br />this data model stores profile ID (unique), name, structural class,<br />basic taxonomic and bibliographic information<br />as well as some additional opseqdbtional tags.<br />Tags that are commonly used in the actual JASPAR database include<br />    'medline'  # PubMed ID<br />    'species'  # Species name<br />    'superclass' #Species supergroup, eg 'vertebrate', 'plant' etc<br />    'total_ic' # total information content - redundant, present <br />               # for historical<br />    'type'    #experimental nethod<br />    'acc'    #accession number for TF protein sequence<br />    'seqdb'    #corresponding database name<br />    <br />but any tag is storable and searchable.<br />    <br />    <br />-----------------------  ADVANCED  ---------------------------------<br />For the developers and the curious, here is the JASPAR4 data model:<br /><pre id="podParagraph">  
</pre>It is our best intention to hide the details of this data model, which we <br />are using on a daily basis in our work, from most TFBS users.<br />Most users should only know the methods to store the data and <br />which tags are supported.<br />-------------------------------------------------------------------------</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_FEEDBACK" id="_pod_FEEDBACK"></a>FEEDBACK</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">Please send bug reports and other comments to the author.</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_AUTHOR - Boris Lenhard" id="_pod_AUTHOR - Boris Lenhard"></a>AUTHOR - Boris Lenhard</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">Boris Lenhard &lt;Boris.Lenhard@cgb.ki.se&gt;</div>
<div id="sep"></div>
<table id="genInfoTitle" width="100%"><tr><td><a name="_pod_APPENDIX" id="_pod_APPENDIX"></a>APPENDIX</td><td align="right"><a href="#TOP">Top</a></td></tr></table>
<div id="genInfoArea">The rest of the documentation details each of the object<br />methods. Internal methods are preceded with an underscore.</div>
<div id="sep"></div>
</body>
</html>
