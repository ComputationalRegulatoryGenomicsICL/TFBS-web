<head>
<!-- Generated by perlmod2www.pl -->
<title>
JASPAR4 documentation.
</title>
</head>
<body bgcolor="white">
<HR><H4>TFBS::DB</H4>
<H3>JASPAR4</H3>
<A NAME="TOP"></A>
<TABLE BORDER="1" WIDTH="100%"><TR>
<TD><A HREF="#SUMMARY">Summary</A></TD>
<TD><A HREF="#libs">Included libraries</A></TD>
<TD><A HREF="#vardefs">Package variables</A></TD>
<TD><A HREF="#SYNOPSIS">Synopsis</A></TD>
<TD><A HREF="#DESCRIPTION">Description</A></TD>
<TD><A HREF="#General">General documentation</A></TD>
<TD><A HREF="#Methods">Methods</A></TD>
</TR></TABLE><HR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR><TD BGCOLOR="#ffae84"><B>Summary</B></TD></TR>
</TABLE>
<TABLE BORDER="0" WIDTH="100%"><TR><TD><pre><B>TFBS::DB::JASPAR4</B> - interface to MySQL relational database of pattern matrices<BR></pre></TD></TR>
</TABLE>
<A NAME="vardefs"></A>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Package variables</B></TD>
<TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0" WIDTH="100%"><TR BGCOLOR="#ffd39b"><TD COLSPAN="2"><B>Globals (from <FONT COLOR="BLUE">use vars</FONT> definitions)</B></TD></TR>
<TR><TD COLSPAN="2"><font color="#1f32ff">$AUTOLOAD</font></TD></TR>
</TABLE>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD WIDTH="150"><B>Included modules</B></TD><TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0"><TR><TD COLSPAN="2"><b><font color="#0000ff">Bio::Root::Root</font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">DBI</font></b></TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff"><a href="../Matrix/ICM.html">TFBS::Matrix::ICM</a></font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff"><a href="../Matrix/PFM.html">TFBS::Matrix::PFM</a></font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff"><a href="../Matrix/PWM.html">TFBS::Matrix::PWM</a></font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff"><a href="../MatrixSet.html">TFBS::MatrixSet</a></font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">constant(1)</font></b> DEFAULT_CONNECTSTRING =&gt; &quot; dbi:mysql:JASPAR_DEMO &quot; </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">constant(2)</font></b> DEFAULT_USER =&gt; &quot; &quot; </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">constant(3)</font></b> DEFAULT_PASSWORD =&gt; &quot; &quot; </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">strict</font></b></TD></TR>
</TABLE>
<A NAME="libs"></A><TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Inherit</B></TD>
<TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0"><TR><TD><b><font color="#0000ff">Bio::Root::Root</font></b> <b><font color="#0000ff"><a href="../DB.html">TFBS::DB</a></font></b> </TD></TR>
</TABLE>
<A NAME="SYNOPSIS"></A>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Synopsis</B></TD><TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0"><TR><TD COLSPAN="2"><pre><BR><A NAME="_pod_* creating a database object by connecting to the existing JASPAR2-type database">    * creating a database object by connecting to the existing JASPAR2-type database</A><BR>        my $db = <B>TFBS::DB::JASPAR4</B>-&gt;connect(&quot;dbi:mysql:JASPAR4:myhost&quot;,<BR>					&quot;myusername&quot;,<BR>					&quot;mypassword&quot;);<BR><BR><A NAME="_pod_* retrieving a TFBS::Matrix::* object from the database">    * retrieving a TFBS::Matrix::* object from the database</A><BR>        # retrieving a PFM by ID<BR>    my $pfm = $db-&gt;get_Matrix_by_ID('M0079','PFM');<BR> <BR>    #retrieving a PWM by name<BR>    my $pwm = $db-&gt;get_Matrix_by_name('NF-kappaB', 'PWM');<BR><BR><A NAME="_pod_">    </A><BR><A NAME="_pod_">    </A><BR><A NAME="_pod_* storing a matrix in the database (currently only PFMs):">    * storing a matrix in the database (currently only PFMs):</A><BR>        #let $pfm is a TFBS::Matrix::PFM object<BR>    $db-&gt;store_Matrix($pfm);<BR><BR><BR></pre>
</TD></TR></TABLE>
<A NAME="DESCRIPTION"></A>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Description</B></TD><TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0"><TR><TD COLSPAN="2"><pre><B>TFBS::DB::JASPAR4</B> is a read/write database interface module that<BR>retrieves and stores TFBS::Matrix::* and TFBS::MatrixSet<BR>objects in a relational database. The interface is nearly identical<BR>to the JASPAR2interface, while the underlying data model is different<BR></pre>
</TD></TR></TABLE>
<A NAME="Methods"></A>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Methods</B></TD><TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE>
<TABLE BORDER="1" CELLSPACING="5"><TR><TD><B>DESTROY</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE1">Code</A></TD></TR>
<TR><TD><B>_create_tables</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE2">Code</A></TD></TR>
<TR><TD><B>_get_IDlist_by_query</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE3">Code</A></TD></TR>
<TR><TD><B>_get_matrixstring</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE4">Code</A></TD></TR>
<TR><TD><B>_new</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE5">Code</A></TD></TR>
<TR><TD><B>_store_matrix_annotation</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE6">Code</A></TD></TR>
<TR><TD><B>_store_matrix_data</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE7">Code</A></TD></TR>
<TR><TD><B>_store_matrix_info</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE8">Code</A></TD></TR>
<TR><TD><B>connect</B></TD><TD><A HREF="#POD1">Description</A></TD><TD><A HREF="#CODE9">Code</A></TD></TR>
<TR><TD><B>create</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE10">Code</A></TD></TR>
<TR><TD><B>dbh</B></TD><TD><A HREF="#POD2">Description</A></TD><TD><A HREF="#CODE11">Code</A></TD></TR>
<TR><TD><B>delete_Matrix_having_ID</B></TD><TD><A HREF="#POD3">Description</A></TD><TD><A HREF="#CODE12">Code</A></TD></TR>
<TR><TD><B>get_MatrixSet</B></TD><TD><A HREF="#POD4">Description</A></TD><TD><A HREF="#CODE13">Code</A></TD></TR>
<TR><TD><B>get_Matrix_by_ID</B></TD><TD><A HREF="#POD5">Description</A></TD><TD><A HREF="#CODE14">Code</A></TD></TR>
<TR><TD><B>get_Matrix_by_name</B></TD><TD><A HREF="#POD6">Description</A></TD><TD><A HREF="#CODE15">Code</A></TD></TR>
<TR><TD><B>new</B></TD><TD><A HREF="#POD7">Description</A></TD><TD><A HREF="#CODE16">Code</A></TD></TR>
<TR><TD><B>store_Matrix</B></TD><TD><A HREF="#POD8">Description</A></TD><TD><A HREF="#CODE17">Code</A></TD></TR>
<TR><TD><B>store_MatrixSet</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE18">Code</A></TD></TR>
</TABLE>
<A NAME="MethDesc"></A>
<HR><H2>Methods description</H2>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_connect"></A><A NAME="POD1"></A><B>connect</B></TD><TD><A HREF="#CODE9">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD>prev</TD><TD><A HREF="#POD2">next</A></TD></TR></TABLE>
<pre> Title   : connect<BR> Usage   : my $db =<BR>	    <B>TFBS::DB::JASPAR4</B>-&gt;connect(&quot;dbi:mysql:DATABASENAME:HOSTNAME&quot;,<BR>					&quot;USERNAME&quot;,<BR>					&quot;PASSWORD&quot;);<BR> Function: connects to the existing JASPAR4-type database and<BR>	   returns a database object that interfaces the database<BR> Returns : a <B>TFBS::DB::JASPAR4</B> object<BR> Args    : a standard database connection triplet<BR>	   (&quot;dbi:mysql:DATABASENAME:HOSTNAME&quot;,  &quot;USERNAME&quot;, &quot;PASSWORD&quot;)<BR>	   In place of DATABASENAME, HOSTNAME, USERNAME and PASSWORD,<BR>	   use the actual values. PASSWORD and USERNAME might be<BR>	   optional, depending on the user's acces permissions for<BR>	   the database server.<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_dbh"></A><A NAME="POD2"></A><B>dbh</B></TD><TD><A HREF="#CODE11">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD1">prev</A></TD><TD><A HREF="#POD3">next</A></TD></TR></TABLE>
<pre> Title   : dbh<BR> Usage   : my $dbh = $db-&gt;dbh();<BR>	   $dbh-&gt;do(&quot;UPDATE matrix_data SET name='ADD1' WHERE NAME='SREBP2'&quot;);<BR> Function: returns the DBI database handle of the MySQL database<BR>	   interfaced by $db; THIS IS USED FOR WRITING NEW METHODS<BR>	   FOR DIRECT RELATIONAL DATABASE MANIPULATION - if you<BR>	   have write access AND do not know what you are doing,<BR>	   you can severely  corrupt the data<BR>	   For documentation about database handle methods, see <a href="#_pod_DBI">DBI</a><BR> Returns : the database (DBI) handle of the MySQL JASPAR2-type<BR>	   relational database associated with the TFBS::DB::JASPAR2<BR>	   object<BR> Args    : none<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_delete_Matrix_having_ID"></A><A NAME="POD3"></A><B>delete_Matrix_having_ID</B></TD><TD><A HREF="#CODE12">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD2">prev</A></TD><TD><A HREF="#POD4">next</A></TD></TR></TABLE>
<pre> Title   : delete_Matrix_having_ID<BR> Usage   : $db-&gt;delete_Matrix_with_ID('M00045');<BR> Function: Deletes the matrix having the given ID from the database<BR> Returns : 0 on success; $@ contents on failure<BR>	   (this is too C-like and may change in future versions)<BR> Args    : (ID)<BR>	   A string<BR> Comment : Yeah, yeah, 'delete_Matrix_having_ID' is a stupid name<BR>	   for a method, but at least it should be obviuos what it does.<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_get_MatrixSet"></A><A NAME="POD4"></A><B>get_MatrixSet</B></TD><TD><A HREF="#CODE13">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD3">prev</A></TD><TD><A HREF="#POD5">next</A></TD></TR></TABLE>
<pre> Title   : get_MatrixSet<BR> Usage   : my $matrixset = $db-&gt;get_MatrixSet(%args);<BR> Function: fetches matrix data under for all matrices in the database<BR>	   matching criteria defined by the named arguments<BR>	   and returns a TFBS::MatrixSet object<BR> Returns : a TFBS::MatrixSet object<BR> Args    : This method accepts named arguments, corresponding to arbitrary tags.<BR>           Note that this is different from JASPAR2. As any tag is supported for<BR>           database storage, any tag can be used for information retrieval.<BR>           Additionally, arguments as 'name' and 'class' can be used (even though<BR>           they are not tags.<BR>           As with get_Matrix methods, it is important to realize taht any matrix<BR>           format can be stored in the database: the TFBS::MatrixSet might therefore<BR>           consist of PFMs, ICMs and PWMS, depending on how matrices are stored,<BR>           <BR>           Examples include<BR>	   -ID        # a reference to an array of IDs (strings)<BR>	   -name      # a reference to an array of<BR>		       #  transcription factor names (string)<BR>	   -class    # a reference to an array of<BR>		       #  structural class names (strings)<BR>	   -species    # a reference to an array of<BR>		       #   Latin species names (strings)<BR>	   -sysgroup  # a reference to an array of<BR>		       #  higher taxonomic categories (strings)<BR><BR>	  <BR>	   -min_ic     # float, minimum total information content<BR>		       #   of the matrix. IMPORTANT:if retrieved matrices are in PWM<BR>		       format there is no way to measureinformation content.<BR>	-matrixtype    #string describing type of matrix to retrieve. If left out, the format<BR>                        will revert to the database format. Note that this option only works<BR>                      if the database format is pfm<BR><BR>The arguments that expect list references are used in database<BR>query formulation: elements within lists are combined with 'OR'<BR>operators, and the lists of different types with 'AND'. For example,<BR><BR>    my $matrixset = $db-&gt;(-class =&gt; ['TRP_CLUSTER', 'FORKHEAD'],<BR>			  -species =&gt; ['Homo sapiens', 'Mus musculus'],<BR>			  );<BR><BR>gives a set of TFBS::Matrix::PFM objects (given that the matrix models are stored as such)<BR> whose (structural clas is 'TRP_CLUSTER' OR'FORKHEAD') AND (the species they are derived<BR> from is 'Homo sapiens'OR 'Mus musculus').<BR><BR>The -min_ic filter is applied after the query in the sense that the<BR>matrices profiles with total infromation content less than specified<BR>are not included in the set.<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_get_Matrix_by_ID"></A><A NAME="POD5"></A><B>get_Matrix_by_ID</B></TD><TD><A HREF="#CODE14">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD4">prev</A></TD><TD><A HREF="#POD6">next</A></TD></TR></TABLE>
<pre> Title   : get_Matrix_by_ID<BR> Usage   : my $pfm = $db-&gt;get_Matrix_by_ID('M00034', 'PFM');<BR> Function: fetches matrix data under the given ID from the<BR>           database and returns a TFBS::Matrix::* object<BR> Returns : a TFBS::Matrix::* object; the exact type of the<BR>	   object depending on what form the matrix is stored<BR>	   in the database (PFM is default)<BR> Args    : (Matrix_ID)<BR>	   Matrix_ID is a string;<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_get_Matrix_by_name"></A><A NAME="POD6"></A><B>get_Matrix_by_name</B></TD><TD><A HREF="#CODE15">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD5">prev</A></TD><TD><A HREF="#POD7">next</A></TD></TR></TABLE>
<pre> Title   : get_Matrix_by_name<BR> Usage   : my $pfm = $db-&gt;get_Matrix_by_name('HNF-1');<BR> Function: fetches matrix data under the given name from the<BR>	   database and returns a TFBS::Matrix::* object<BR> Returns : a TFBS::Matrix::* object; the exact type of the object<BR>	   depending on what form the matrix object was stored in<BR>	   the database (default PFM))<BR> Args    : (Matrix_name)<BR>	   <BR> Warning : According to the current JASPAR4 data model, name is<BR>	   not necessarily a unique identifier. In the case where<BR>	   there are several matrices with the same name in the<BR>	   database, the function fetches the first one and prints<BR>	   a warning on STDERR. You've been warned.<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_new"></A><A NAME="POD7"></A><B>new</B></TD><TD><A HREF="#CODE16">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD6">prev</A></TD><TD><A HREF="#POD8">next</A></TD></TR></TABLE>
<pre> Title   : new<BR> Usage   : DEPRECATED - for backward compatibility only<BR>           Use connect() or create() instead<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_store_Matrix"></A><A NAME="POD8"></A><B>store_Matrix</B></TD><TD><A HREF="#CODE17">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD7">prev</A></TD><TD><A HREF="#POD9">next</A></TD></TR></TABLE>
<pre> Title   : store_Matrix<BR> Usage   : $db-&gt;store_Matrix($matrixobject);<BR> Function: Stores the contents of a TFBS::Matrix::DB object in the database<BR> Returns : 0 on success; $@ contents on failure<BR>	   (this is too C-like and may change in future versions)<BR> Args    : (PFM_object)<BR>	   A TFBS::Matrix::PFM, FBS::Matrix::PWM or FBS::Matrix::ICM object.<BR>	   PFM object are recommended to use, as they are eaily converted to<BR>	   other formats<BR> Comment : this is an experimental method that is not 100% bulletproof;<BR>	   use at your own risk<BR></pre>
<A NAME="MethCode"></A>
<HR><H2>Methods code</H2>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE1"></A><B>DESTROY</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30">prev</TD><TD WIDTH="30"><A HREF="#CODE2">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>DESTROY</b></font>
 {<pre>    <font color="#1f32ff">$_</font><font color="#0000ff"><b>[</b></font>0<font color="#0000ff"><b>]</b></font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>if</b></font> <font color="#1f32ff">$_</font><font color="#0000ff"><b>[</b></font>0<font color="#0000ff"><b>]</b></font>-&gt;dbh;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE2"></A><B>_create_tables</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE1">prev</A></TD><TD WIDTH="30"><A HREF="#CODE3">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff00ff"><b>_create_tables</b></font>
 {<pre>    <font color="#ff0000">## utility function</font><BR>
    <font color="#ff0000">## If you want to change the databse schema,</font><BR>    <font color="#ff0000">## this is the right place to do it</font><BR>
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$dbh</font> = <font color="#4169e1"><b>shift</b></font>;

    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@queries</font> = 
	<font color="#0000ff"><b>(</b></font>
       <font color="#4169e1"><b>q</b></font><font color="#007400">!!<BR>        CREATE TABLE MATRIX_DATA(<BR>	ID VARCHAR (16) DEFAULT '' NOT NULL,<BR>	row VARCHAR(1) NOT NULL, <BR>	col TINYINT(3) UNSIGNED NOT NULL, <BR>	val float(7,4), <BR>	PRIMARY KEY (ID, row, col)<BR>	)<BR>       !</font>,
       <font color="#4169e1"><b>q</b></font><font color="#007400">!!<BR>       CREATE TABLE MATRIX_INFO( <BR>	ID VARCHAR (16) DEFAULT '' NOT NULL PRIMARY KEY , <BR> 	type ENUM ('PFM', 'ICM','PWM') DEFAULT 'PFM' NOT NULL <BR>	)<BR>       !</font>,
       
       <font color="#4169e1"><b>q</b></font><font color="#007400">!!<BR>        CREATE TABLE MATRIX_ANNOTATION(<BR>        ID VARCHAR (16) DEFAULT '' NOT NULL,<BR>	tag VARCHAR(255)DEFAULT '' NOT NULL,<BR>	val varchar(255) DEFAULT '',<BR>	PRIMARY KEY (ID, tag)<BR>	)<BR>        !</font>,
        
    <font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$query</font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@queries</font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#1f32ff">$dbh</font>-&gt;<font color="#0000ff"><b>do</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$query</font><font color="#0000ff"><b>)</b></font> 
	    or <font color="#4169e1"><b>die</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"Error executing the query: $query\n"</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font></pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE3"></A><B>_get_IDlist_by_query</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE2">prev</A></TD><TD WIDTH="30"><A HREF="#CODE4">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff00ff"><b>_get_IDlist_by_query</b></font>
 {<pre>
    <font color="#ff0000">## called by get_MatrixSet</font><BR>    <font color="#ff0000">## should be able to search for arbitrary tags...hmmm</font><BR>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$TABLES</font>, <font color="#1f32ff">%arrayref</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">%intersected_set</font><font color="#0000ff"><b>)</b></font>;
    

    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$key</font><font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>keys</b></font> <font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
       
        <font color="#0000ff"><b>unless</b></font> <font color="#0000ff"><b>(</b></font> <font color="#1f32ff">$key</font> <font color="#0000ff"><b>eq</b></font> <font color="#007400">"-min_ic"</font> or <font color="#1f32ff">$key</font> <font color="#0000ff"><b>eq</b></font>  <font color="#007400">"-matrixtype"</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
                <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$oldkey</font>=<font color="#1f32ff">$key</font>;
                <font color="#1f32ff">$key</font>=~s<font color="#006400"><b>/-/</b></font>/;<BR>                <font color="#1f32ff">$arrayref</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$key</font><font color="#0000ff"><b>}</b></font>= <font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$oldkey</font><font color="#0000ff"><b>}</b></font>;
        <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@andconditions</font>;
    
      
    <font color="#1f32ff">$TABLES</font> = <font color="#007400">'MATRIX_ANNOTATION '</font>;
    
    <font color="#ff0000">##special case: get all matrices</font><BR>    <font color="#0000ff"><b>unless</b></font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>keys</b></font> <font color="#1f32ff">%arrayref</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
       
            
        
     <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$query</font> = <font color="#007400">"SELECT DISTINCT ID FROM <font color="#1f32ff">$TABLES</font> "</font>;
        
     <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$sth</font> = <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$query</font><font color="#0000ff"><b>)</b></font>;
     <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">execute</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font> or <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">throw</font><font color="#0000ff"><b>(</b></font><font color="#007400">"Query failed:\n$query\n"</font><font color="#0000ff"><b>)</b></font>;
     <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@ary</font>;
     
     <font color="#0000ff"><b>while</b></font> <font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$id</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">fetchrow_array</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
           <font color="#4169e1"><b>push</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@ary</font>, <font color="#1f32ff">$id</font><font color="#0000ff"><b>)</b></font>;
            
        <font color="#0000ff"><b>}</b></font>   
    
        <font color="#0000ff"><b>return</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">@ary</font><font color="#0000ff"><b>)</b></font>;
    
    <font color="#0000ff"><b>}</b></font>
    
    
    
    
    
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$key</font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>keys</b></font> <font color="#1f32ff">%arrayref</font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
        <font color="#ff0000">##print &quot;key: $key\n&quot;;</font><BR>        <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$key</font> <font color="#0000ff"><b>eq</b></font> <font color="#007400">'ID'</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
         <font color="#4169e1"><b>push</b></font> <font color="#1f32ff">@andconditions</font>,
	<font color="#007400">"("</font>.
	<font color="#4169e1"><b>join</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">" OR "</font>,
	     <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>map</b></font> <font color="#0000ff"><b>{</b></font><font color="#007400">"MATRIX_ANNOTATION.ID="</font>.
		       <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$_</font><font color="#0000ff"><b>)</b></font>
		  <font color="#0000ff"><b>}</b></font> 
	      @<font color="#0000ff"><b>{</b></font><font color="#1f32ff">$arrayref</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$key</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>}</b></font>
	     <font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>.
	<font color="#007400">")"</font>;   
            
            
            
        <font color="#0000ff"><b>}</b></font>
        <font color="#0000ff"><b>else</b></font><font color="#0000ff"><b>{</b></font>
        <font color="#4169e1"><b>push</b></font> <font color="#1f32ff">@andconditions</font>,
	<font color="#007400">"("</font>.
	<font color="#4169e1"><b>join</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">" OR "</font>,
	     <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>map</b></font> <font color="#0000ff"><b>{</b></font><font color="#007400">"MATRIX_ANNOTATION.tag="</font>. <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$key</font><font color="#0000ff"><b>)</b></font>.<font color="#007400">" AND val="</font>.
		       <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$_</font><font color="#0000ff"><b>)</b></font>
		  <font color="#0000ff"><b>}</b></font> 
	      @<font color="#0000ff"><b>{</b></font><font color="#1f32ff">$arrayref</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$key</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>}</b></font>
	     <font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>.
	<font color="#007400">")"</font>;
        <font color="#0000ff"><b>}</b></font>
        <font color="#4169e1"><b>push</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@andconditions</font>, 1<font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>unless</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">@andconditions</font><font color="#0000ff"><b>)</b></font>;
        <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$WHERE</font> = <font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>scalar</b></font> <font color="#1f32ff">@andconditions</font><font color="#0000ff"><b>)</b></font> == 0<font color="#0000ff"><b>)</b></font> ? <font color="#007400">""</font> : <font color="#007400">" WHERE "</font>;

     
      
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$query</font> = 
	    <font color="#007400">"SELECT DISTINCT ID FROM <font color="#1f32ff">$TABLES</font> <font color="#1f32ff">$WHERE</font>"</font>.
	    <font color="#4169e1"><b>join</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">" AND "</font>, <font color="#1f32ff">@andconditions</font><font color="#0000ff"><b>)</b></font>;
   
       <font color="#ff0000">## warn  $query; </font><BR>        <font color="#4169e1"><b>undef</b></font> <font color="#1f32ff">@andconditions</font>;
        <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$sth</font> = <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$query</font><font color="#0000ff"><b>)</b></font>;
        <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">execute</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font> or <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">throw</font><font color="#0000ff"><b>(</b></font><font color="#007400">"Query failed:\n$query\n"</font><font color="#0000ff"><b>)</b></font>;
    
        <font color="#ff0000">## collect IDs and return</font><BR>
        <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">%current_query</font>;
        <font color="#0000ff"><b>while</b></font> <font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$id</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">fetchrow_array</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
           <font color="#1f32ff">$current_query</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$id</font><font color="#0000ff"><b>}</b></font>=1;
            
        <font color="#0000ff"><b>}</b></font>
        <font color="#0000ff"><b>unless</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">%intersected_set</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
            <font color="#1f32ff">%intersected_set</font>= <font color="#1f32ff">%current_query</font>;
            <font color="#0000ff"><b>next</b></font>;
        <font color="#0000ff"><b>}</b></font>
        <font color="#ff0000">## do intersect</font><BR>        <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$key</font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>keys</b></font> <font color="#1f32ff">%intersected_set</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
              <font color="#4169e1"><b>delete</b></font> <font color="#1f32ff">$intersected_set</font><font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$key</font><font color="#0000ff"><b>}</b></font>  <font color="#0000ff"><b>unless</b></font> <font color="#1f32ff">$current_query</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$key</font><font color="#0000ff"><b>}</b></font>;
            
        <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>}</b></font> 
    
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@ary</font>;
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$key</font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>keys</b></font> <font color="#1f32ff">%intersected_set</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
        <font color="#4169e1"><b>push</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@ary</font>, <font color="#1f32ff">$key</font><font color="#0000ff"><b>)</b></font>;
       <font color="#ff0000">## warn &quot;$key\n&quot;;</font><BR>    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>return</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@ary</font><font color="#0000ff"><b>)</b></font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE4"></A><B>_get_matrixstring</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE3">prev</A></TD><TD WIDTH="30"><A HREF="#CODE5">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff00ff"><b>_get_matrixstring</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">$ID</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#ff0000">##my %dbname = (PWM =&gt; 'pwm', PFM =&gt; 'raw', ICM =&gt; 'info');</font><BR>    <font color="#ff0000">##unless (defined $dbname{$mt})  {</font><BR>	<font color="#ff0000">##$self-&gt;throw(&quot;Unsupported matrix type: &quot;.$mt);</font><BR>    <font color="#ff0000">##}</font><BR>    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$sth</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$qID</font> = <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$ID</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$matrixstring</font> = <font color="#007400">""</font>;
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$base</font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>qw</b></font><font color="#0000ff"><b>(</b></font>A C G T<font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	<font color="#1f32ff">$sth</font>=<font color="#1f32ff">$self</font>-&gt;dbh-&gt;prepare
	    <font color="#0000ff"><b>(</b></font><font color="#007400">"SELECT val FROM MATRIX_DATA 
              WHERE ID=<font color="#1f32ff">$qID</font> AND row='$base' ORDER BY col"</font><font color="#0000ff"><b>)</b></font>;
	<font color="#1f32ff">$sth</font>-&gt;execute;
	<font color="#1f32ff">$matrixstring</font> .=
	    <font color="#4169e1"><b>join</b></font> <font color="#0000ff"><b>(</b></font><font color="#007400">" "</font>, <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>map</b></font> <font color="#0000ff"><b>{</b></font><font color="#1f32ff">$_</font>-&gt;<font color="#0000ff"><b>[</b></font>0<font color="#0000ff"><b>]</b></font><font color="#0000ff"><b>}</b></font> @<font color="#0000ff"><b>{</b></font><font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">fetchall_arrayref</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>.<font color="#007400">"\n"</font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#1f32ff">$sth</font>-&gt;finish;
    <font color="#0000ff"><b>return</b></font> <font color="#4169e1"><b>undef</b></font> <font color="#0000ff"><b>if</b></font> <font color="#1f32ff">$matrixstring</font> <font color="#0000ff"><b>eq</b></font> <font color="#007400">"\n"</font>x4;

    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$matrixstring</font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE5"></A><B>_new</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE4">prev</A></TD><TD WIDTH="30"><A HREF="#CODE6">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff00ff"><b>_new</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$caller</font>, <font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font>  = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$class</font> = <font color="#4169e1"><b>ref</b></font> <font color="#1f32ff">$caller</font> || <font color="#1f32ff">$caller</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$self</font> = <font color="#4169e1"><b>bless</b></font> <font color="#0000ff"><b>{</b></font><font color="#0000ff"><b>}</b></font>, <font color="#1f32ff">$class</font>;

    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$connectstring</font>, <font color="#1f32ff">$user</font>, <font color="#1f32ff">$password</font><font color="#0000ff"><b>)</b></font>;
 
    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-connect'</font><font color="#0000ff"><b>}</b></font> and <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>ref</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-connect'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>eq</b></font> <font color="#007400">"ARRAY"</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>(</b></font><font color="#1f32ff">$connectstring</font>, <font color="#1f32ff">$user</font>, <font color="#1f32ff">$password</font><font color="#0000ff"><b>)</b></font> = @<font color="#0000ff"><b>{</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-connect'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>}</b></font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>elsif</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-create'</font><font color="#0000ff"><b>}</b></font> and <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>ref</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-create'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>eq</b></font> <font color="#007400">"ARRAY"</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$caller</font>-&gt;<font color="#ff8204">create</font><font color="#0000ff"><b>(</b></font>@<font color="#0000ff"><b>{</b></font>-args<font color="#0000ff"><b>{</b></font><font color="#007400">'create'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>else</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>(</b></font><font color="#1f32ff">$connectstring</font>, <font color="#1f32ff">$user</font>, <font color="#1f32ff">$password</font><font color="#0000ff"><b>)</b></font> = 
	    <font color="#0000ff"><b>(</b></font>DEFAULT_CONNECTSTRING, DEFAULT_USER, DEFAULT_PASSWORD<font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font>

    <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font> <font color="#ff8204">DBI->connect</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$connectstring</font>, <font color="#1f32ff">$user</font>, <font color="#1f32ff">$password</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>)</b></font>;
    
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$self</font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE6"></A><B>_store_matrix_annotation</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE5">prev</A></TD><TD WIDTH="30"><A HREF="#CODE7">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff00ff"><b>_store_matrix_annotation</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">$pfm</font>, <font color="#1f32ff">$ACTION</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$sth</font> = <font color="#1f32ff">$self</font>-&gt;dbh-&gt;prepare 
	<font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>q</b></font><font color="#007400">!! INSERT INTO MATRIX_ANNOTATION<BR>	    (ID, tag, val) <BR>	    VALUES(?,?,?) !</font><font color="#0000ff"><b>)</b></font>;
    
    <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">execute</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font>-&gt;ID,
                    <font color="#007400">'name'</font>,
                    <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font>-&gt;<font color="#ff8204">name</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font> or <font color="#007400">""</font><font color="#0000ff"><b>)</b></font>,
    <font color="#0000ff"><b>)</b></font>;
    <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">execute</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font>-&gt;ID,
                    <font color="#007400">'class'</font>,
                    <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font>-&gt;<font color="#ff8204">class</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font> or <font color="#007400">""</font><font color="#0000ff"><b>)</b></font>,
    <font color="#0000ff"><b>)</b></font>;
    
    <font color="#ff0000">## get all tags	</font><BR>	
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">%tags</font>= <font color="#1f32ff">$pfm</font>-&gt;<font color="#ff8204">all_tags</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$tag</font><font color="#0000ff"><b>(</b></font> <font color="#4169e1"><b>keys</b></font> <font color="#1f32ff">%tags</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
    <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">execute</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font>-&gt;ID,
                    <font color="#1f32ff">$tag</font>, 
                   <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$tags</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$tag</font><font color="#0000ff"><b>}</b></font> or <font color="#007400">""</font><font color="#0000ff"><b>)</b></font>,
                 <font color="#0000ff"><b>)</b></font>
    
	or <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">throw</font><font color="#0000ff"><b>(</b></font><font color="#007400">"Error executing query"</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font></pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE7"></A><B>_store_matrix_data</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE6">prev</A></TD><TD WIDTH="30"><A HREF="#CODE8">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff00ff"><b>_store_matrix_data</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">$pfm</font>, <font color="#1f32ff">$ACTION</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@base</font> = <font color="#4169e1"><b>qw</b></font><font color="#0000ff"><b>(</b></font>A C G T<font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$matrix</font> = <font color="#1f32ff">$pfm</font>-&gt;<font color="#ff8204">matrix</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$type</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$sth</font> = <font color="#1f32ff">$self</font>-&gt;dbh-&gt;prepare 
	<font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>q</b></font><font color="#007400">!! INSERT INTO MATRIX_DATA VALUES(?,?,?,?) !</font><font color="#0000ff"><b>)</b></font>;
				 
    <font color="#0000ff"><b>for</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$i</font> <font color="#0000ff"><b>(</b></font>0..3<font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>for</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$j</font> <font color="#0000ff"><b>(</b></font>0..<font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font>-&gt;<font color="#4169e1"><b>length</b></font>-1<font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	    <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">execute</font><font color="#0000ff"><b>(</b></font> <font color="#1f32ff">$pfm</font>-&gt;ID,
			   
			   <font color="#1f32ff">$base</font><font color="#0000ff"><b>[</b></font><font color="#1f32ff">$i</font><font color="#0000ff"><b>]</b></font>,
			   <font color="#1f32ff">$j</font>+1,
			   <font color="#1f32ff">$matrix</font>-&gt;<font color="#0000ff"><b>[</b></font><font color="#1f32ff">$i</font><font color="#0000ff"><b>]</b></font><font color="#0000ff"><b>[</b></font><font color="#1f32ff">$j</font><font color="#0000ff"><b>]</b></font>
	    <font color="#0000ff"><b>)</b></font>
	   or <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">throw</font><font color="#0000ff"><b>(</b></font><font color="#007400">"Error executing query."</font><font color="#0000ff"><b>)</b></font>;
	<font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>}</b></font></pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE8"></A><B>_store_matrix_info</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE7">prev</A></TD><TD WIDTH="30"><A HREF="#CODE9">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff00ff"><b>_store_matrix_info</b></font>
 {<pre>
    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">$pfm</font>, <font color="#1f32ff">$ACTION</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;

    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$type</font>;
    <font color="#1f32ff">$type</font>= <font color="#007400">'PFM'</font> <font color="#0000ff"><b>if</b></font> <font color="#1f32ff">$pfm</font>-&gt;<font color="#ff8204">isa</font><font color="#0000ff"><b>(</b></font><font color="#007400">"TFBS::Matrix::PFM"</font><font color="#0000ff"><b>)</b></font>;
    <font color="#1f32ff">$type</font>= <font color="#007400">'PWM'</font> <font color="#0000ff"><b>if</b></font> <font color="#1f32ff">$pfm</font>-&gt;<font color="#ff8204">isa</font><font color="#0000ff"><b>(</b></font><font color="#007400">"TFBS::Matrix::PWM"</font><font color="#0000ff"><b>)</b></font>;
    <font color="#1f32ff">$type</font>= <font color="#007400">'ICM'</font> <font color="#0000ff"><b>if</b></font> <font color="#1f32ff">$pfm</font>-&gt;<font color="#ff8204">isa</font><font color="#0000ff"><b>(</b></font><font color="#007400">"TFBS::Matrix::ICM"</font><font color="#0000ff"><b>)</b></font>;


    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$sth</font> = <font color="#1f32ff">$self</font>-&gt;dbh-&gt;prepare 
	<font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>q</b></font><font color="#007400">!! INSERT INTO MATRIX_INFO<BR>	    (ID, type) <BR>	    VALUES(?,?) !</font><font color="#0000ff"><b>)</b></font>;
    <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">execute</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font>-&gt;ID,
		  <font color="#1f32ff">$type</font>, 
		  <font color="#0000ff"><b>)</b></font>
	or <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">throw</font><font color="#0000ff"><b>(</b></font><font color="#007400">"Error executing query"</font><font color="#0000ff"><b>)</b></font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE9"></A><B>connect</B></TD><TD><A HREF="#POD1">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE8">prev</A></TD><TD WIDTH="30"><A HREF="#CODE10">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>connect</b></font>
 {<pre>    <font color="#ff0000">## a more intuitive syntax for the constructor</font><BR>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$caller</font>, <font color="#1f32ff">@connection_args</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#1f32ff">$caller</font>-&gt;<font color="#0000ff"><b>new</b></font><font color="#0000ff"><b>(</b></font>-<font color="#4169e1"><b>connect</b></font> =&gt;\@ connection_args<font color="#0000ff"><b>)</b></font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE10"></A><B>create</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE9">prev</A></TD><TD WIDTH="30"><A HREF="#CODE11">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>create</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$caller</font>, <font color="#1f32ff">$connectstring</font>, <font color="#1f32ff">$user</font>, <font color="#1f32ff">$password</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$connectstring</font> 
	and <font color="#1f32ff">$connectstring</font> =~ <font color="#006400"><b>/dbi:mysql:(\w+)(.*)/</b></font><font color="#0000ff"><b>)</b></font>  
    <font color="#0000ff"><b>{</b></font>
	<font color="#ff0000">## connect to the server;</font><BR>	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$dbh</font>=<font color="#ff8204">DBI</font><font color="#0000ff"><b>(</b></font><font color="#007400">"dbi:mysql:mysql"</font>.<font color="#1f32ff">$2</font>,
			     <font color="#1f32ff">$user</font>,<font color="#1f32ff">$password</font><font color="#0000ff"><b>)</b></font>
	    or <font color="#4169e1"><b>die</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"Error connecting to the database"</font><font color="#0000ff"><b>)</b></font>; 

	<font color="#ff0000">## create database and open it</font><BR>	<font color="#1f32ff">$dbh</font>-&gt;<font color="#0000ff"><b>do</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"create database <font color="#1f32ff">$1</font>"</font><font color="#0000ff"><b>)</b></font> 
	    or <font color="#4169e1"><b>die</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"Error creating database."</font><font color="#0000ff"><b>)</b></font>;
	<font color="#1f32ff">$dbh</font>-&gt;<font color="#0000ff"><b>do</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"use <font color="#1f32ff">$1</font>"</font><font color="#0000ff"><b>)</b></font>; 
	
	<font color="#ff0000">## create tables</font><BR>	<font color="#ff8204">_create_tables</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$dbh</font><font color="#0000ff"><b>)</b></font>;

	<font color="#1f32ff">$dbh</font>-&gt;disconnect;

	<font color="#ff0000">## run &quot;new&quot; with new database</font><BR>
	<font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$caller</font>-&gt;<font color="#0000ff"><b>new</b></font><font color="#0000ff"><b>(</b></font>-<font color="#4169e1"><b>connect</b></font>=&gt;<font color="#0000ff"><b>[</b></font><font color="#1f32ff">$connectstring</font>, <font color="#1f32ff">$user</font>, <font color="#1f32ff">$password</font><font color="#0000ff"><b>]</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>else</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#4169e1"><b>die</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"Missing or malformed connect string for "</font>.
		     <font color="#007400">"TFBS::DB::JASPAR2 connection."</font><font color="#0000ff"><b>)</b></font>; 
    <font color="#0000ff"><b>}</b></font></pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE11"></A><B>dbh</B></TD><TD><A HREF="#POD2">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE10">prev</A></TD><TD WIDTH="30"><A HREF="#CODE12">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>dbh</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">$dbh</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'dbh'</font><font color="#0000ff"><b>}</b></font> = <font color="#1f32ff">$dbh</font> <font color="#0000ff"><b>if</b></font> <font color="#1f32ff">$dbh</font>;
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'dbh'</font><font color="#0000ff"><b>}</b></font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE12"></A><B>delete_Matrix_having_ID</B></TD><TD><A HREF="#POD3">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE11">prev</A></TD><TD WIDTH="30"><A HREF="#CODE13">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>delete_Matrix_having_ID</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">@IDs</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>eval</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$ID</font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@IDs</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$q_ID</font> = <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$ID</font><font color="#0000ff"><b>)</b></font>;
	    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$table</font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>qw</b></font>  <font color="#0000ff"><b>(</b></font>MATRIX_DATA
				    MATRIX_INFO
				    MATRIX_ANNOTATION
				    <font color="#0000ff"><b>)</b></font>
				<font color="#0000ff"><b>)</b></font>
	    <font color="#0000ff"><b>{</b></font>
		<font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#007400">"DELETE from <font color="#1f32ff">$table</font> where ID=<font color="#1f32ff">$q_ID</font>"</font><font color="#0000ff"><b>)</b></font>;
	    <font color="#0000ff"><b>}</b></font>
	<font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>}</b></font>;
    <font color="#0000ff"><b>return</b></font> $@;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE13"></A><B>get_MatrixSet</B></TD><TD><A HREF="#POD4">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE12">prev</A></TD><TD WIDTH="30"><A HREF="#CODE14">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>get_MatrixSet</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    
    
    
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@IDlist</font> = <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">_get_IDlist_by_query</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$type</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$matrixset</font> = <A HREF="../MatrixSet.html"><font color="#8000ff"><b>TFBS::MatrixSet</b></font></A>-&gt;<font color="#0000ff"><b>new</b></font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
    
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@IDlist</font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
       <font color="#ff0000">## print &quot;$_\n&quot;;</font><BR>    <font color="#0000ff"><b>}</b></font>
    
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@IDlist</font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#ff0000">##next if (defined $args{'-min_ic'} </font><BR>	<font color="#ff0000">##	 and $_-&gt;_get_total_ic($_) &lt; $args{'-min_ic'});</font><BR>            <font color="#ff0000">##evaluate total information content: ivolves actually retrieving matrix</font><BR>            <font color="#ff0000">## is actually a problem if matrix is stored PWM: thro an error if so</font><BR>	
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$matrix</font>=<font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">get_Matrix_by_ID</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$_</font><font color="#0000ff"><b>)</b></font>;
	<font color="#ff0000">##evaluate</font><BR>	<font color="#ff0000">##ugly code:</font><BR>	<font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>defined</b></font> <font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-min_ic'</font><font color="#0000ff"><b>}</b></font> <font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
            <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$matrix</font>-&gt;<font color="#ff8204">isa</font><font color="#0000ff"><b>(</b></font><font color="#007400">"TFBS::Matrix::PFM"</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
                <font color="#0000ff"><b>next</b></font> <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font> <font color="#1f32ff">$matrix</font>-&gt;<font color="#ff8204">to_ICM</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font> &lt; <font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-min_ic'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>;     
            <font color="#0000ff"><b>}</b></font>
            <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$matrix</font>-&gt;<font color="#ff8204">isa</font><font color="#0000ff"><b>(</b></font><font color="#007400">"TFBS::Matrix::ICM"</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
                <font color="#0000ff"><b>next</b></font> <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$matrix</font>-&gt;<font color="#ff8204">total_ic</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font> &lt; <font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-min_ic'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>;     
            <font color="#0000ff"><b>}</b></font>
            <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$matrix</font>-&gt;<font color="#ff8204">isa</font><font color="#0000ff"><b>(</b></font><font color="#007400">"TFBS::Matrix::PWM"</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
                <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">throw</font><font color="#0000ff"><b>(</b></font><font color="#007400">"Cannot evaluate information constent from PWM matrices"</font><font color="#0000ff"><b>)</b></font>;
            <font color="#0000ff"><b>}</b></font>
	
	
        
        
	<font color="#0000ff"><b>}</b></font>
	<font color="#ff0000">##ugly code:</font><BR>
        <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-matrixtype'</font><font color="#0000ff"><b>}</b></font> &amp;&amp; <font color="#1f32ff">$matrix</font>-&gt;<font color="#ff8204">isa</font><font color="#0000ff"><b>(</b></font><font color="#007400">"TFBS::Matrix::PFM"</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
            <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font>      <font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-matrixtype'</font><font color="#0000ff"><b>}</b></font> <font color="#0000ff"><b>eq</b></font> <font color="#0000ff"><b>(</b></font><font color="#007400">'PWM'</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
               <font color="#ff0000">## warn &quot;change&quot;;</font><BR>                <font color="#1f32ff">$matrix</font>= <font color="#1f32ff">$matrix</font>-&gt;<font color="#ff8204">to_PWM</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
        <font color="#0000ff"><b>}</b></font>
	<font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font>      <font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-matrixtype'</font><font color="#0000ff"><b>}</b></font> <font color="#0000ff"><b>eq</b></font> <font color="#0000ff"><b>(</b></font><font color="#007400">'ICM'</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
                <font color="#ff0000">##warn &quot;change&quot;;</font><BR>                <font color="#1f32ff">$matrix</font>= <font color="#1f32ff">$matrix</font>-&gt;<font color="#ff8204">to_PWM</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
        <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>}</b></font>
	
	
        <font color="#1f32ff">$matrixset</font>-&gt;<font color="#ff8204">add_Matrix</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$matrix</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$matrixset</font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE14"></A><B>get_Matrix_by_ID</B></TD><TD><A HREF="#POD5">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE13">prev</A></TD><TD WIDTH="30"><A HREF="#CODE15">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>get_Matrix_by_ID</b></font>
 {<pre>
    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">$ID</font>, <font color="#1f32ff">$mt</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#1f32ff">$mt</font> = <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>uc</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$mt</font><font color="#0000ff"><b>)</b></font> or <font color="#007400">"PWM"</font><font color="#0000ff"><b>)</b></font>;

    <font color="#0000ff"><b>unless</b></font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>defined</b></font> <font color="#1f32ff">$ID</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	<font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">throw</font><font color="#0000ff"><b>(</b></font><font color="#007400">"No ID passed to get_Matrix_by_ID"</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$matrixobj</font>;
    <font color="#0000ff"><b>{</b></font>
	<font color="#4169e1"><b>no</b></font> strict <font color="#007400">'refs'</font>;
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$ucmt</font> = <font color="#4169e1"><b>uc</b></font> <font color="#1f32ff">$mt</font>;
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$matrixstring</font> = <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">_get_matrixstring</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$ID</font><font color="#0000ff"><b>)</b></font> || <font color="#0000ff"><b>return</b></font> <font color="#4169e1"><b>undef</b></font>;
        <font color="#ff0000">## get type of matrix</font><BR>        <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$sth</font>=<font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>qq</b></font><font color="#007400">{SELECT type FROM MATRIX_INFO WHERE ID = '$ID'}</font><font color="#0000ff"><b>)</b></font>;
        <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">execute</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
        <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$type</font>=<font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">fetchrow_array</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>; 
	
	
	<font color="#ff0000">## get reast of annotation as tags</font><BR>        <font color="#1f32ff">$sth</font>=<font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">dbh</font><font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>qq</b></font><font color="#007400">{SELECT tag, val FROM MATRIX_ANNOTATION WHERE ID = '$ID' }</font><font color="#0000ff"><b>)</b></font>;
        <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">execute</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
        <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">%tags</font>;
        <font color="#0000ff"><b>while</b></font> <font color="#0000ff"><b>(</b></font> <font color="#0000ff"><b>my</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$tag</font>, <font color="#1f32ff">$val</font><font color="#0000ff"><b>)</b></font>= <font color="#1f32ff">$sth</font>-&gt;<font color="#ff8204">fetchrow_array</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>{</b></font>
            <font color="#1f32ff">$tags</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$tag</font><font color="#0000ff"><b>}</b></font>=<font color="#1f32ff">$val</font>;
        <font color="#0000ff"><b>}</b></font>
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$name</font>= <font color="#1f32ff">$tags</font><font color="#0000ff"><b>{</b></font><font color="#007400">'name'</font><font color="#0000ff"><b>}</b></font>;
        <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$class</font>= <font color="#1f32ff">$tags</font><font color="#0000ff"><b>{</b></font><font color="#007400">'class'</font><font color="#0000ff"><b>}</b></font>;                    
	<font color="#4169e1"><b>delete</b></font>   <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$tags</font><font color="#0000ff"><b>{</b></font><font color="#007400">'name'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>;
	<font color="#4169e1"><b>delete</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$tags</font><font color="#0000ff"><b>{</b></font><font color="#007400">'class'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>;
	
    	<font color="#0000ff"><b>eval</b></font> <font color="#0000ff"><b>(</b></font><font color="#007400">"\<font color="#1f32ff">$matrixobj</font>= TFBS::Matrix::<font color="#1f32ff">$type</font>-&gt;new"</font>.<font color="#007400">' <BR>	    ( -ID    =&gt; $ID.&quot;&quot;,<BR>            -name =&gt;$name, <BR>	    -class =&gt; $class,<BR>              -tags  =&gt;\% tags,<BR>	     -matrixstring=&gt; $matrixstring   # FIXME - temporary<BR>            );'</font><font color="#0000ff"><b>)</b></font>;
	<font color="#ff0000">##if ($@) {$self-&gt;throw($@); }</font><BR>	
    
    <font color="#ff0000">##print &quot;ref:&quot;,ref ($matrixobj);</font><BR>


    <font color="#0000ff"><b>}</b></font>

   <font color="#ff0000">## print $matrixobj-&gt;ID();</font><BR>  <font color="#ff0000">##  print &quot;here\n&quot;;print $matrixobj-&gt;prettyprint();</font><BR>    <font color="#0000ff"><b>return</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$matrixobj</font><font color="#0000ff"><b>)</b></font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE15"></A><B>get_Matrix_by_name</B></TD><TD><A HREF="#POD6">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE14">prev</A></TD><TD WIDTH="30"><A HREF="#CODE16">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>get_Matrix_by_name</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">$name</font>, <font color="#1f32ff">$mt</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>unless</b></font><font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>defined</b></font> <font color="#1f32ff">$name</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font> 
	<font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">throw</font><font color="#0000ff"><b>(</b></font><font color="#007400">"No name passed to get_Matrix_by_name."</font><font color="#0000ff"><b>)</b></font>; <font color="#0000ff"><b>}</b></font>

    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@IDlist</font> = <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">_get_IDlist_by_query</font><font color="#0000ff"><b>(</b></font>-name=&gt;<font color="#0000ff"><b>[</b></font><font color="#1f32ff">$name</font><font color="#0000ff"><b>]</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$ID</font>= <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$IDlist</font><font color="#0000ff"><b>[</b></font>0<font color="#0000ff"><b>]</b></font> 
	    or <font color="#1f32ff">$self</font>-&gt;<font color="#4169e1"><b>warn</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"No matrix with name <font color="#1f32ff">$name</font> found."</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$L</font>= <font color="#4169e1"><b>scalar</b></font> <font color="#1f32ff">@IDlist</font><font color="#0000ff"><b>)</b></font> &gt; 1<font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#1f32ff">$self</font>-&gt;<font color="#4169e1"><b>warn</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"There are <font color="#1f32ff">$L</font> matrices with name '$name'"</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">get_Matrix_by_ID</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$ID</font><font color="#0000ff"><b>)</b></font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE16"></A><B>new</B></TD><TD><A HREF="#POD7">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE15">prev</A></TD><TD WIDTH="30"><A HREF="#CODE17">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>new</b></font>
 {<pre>  _new <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@_</font><font color="#0000ff"><b>)</b></font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE17"></A><B>store_Matrix</B></TD><TD><A HREF="#POD8">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE16">prev</A></TD><TD WIDTH="30"><A HREF="#CODE18">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>store_Matrix</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">@PFMs</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$err</font>;
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$pfm</font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@PFMs</font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>eval</b></font> <font color="#0000ff"><b>{</b></font>
	    <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">_store_matrix_data</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font><font color="#0000ff"><b>)</b></font>;
	    <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">_store_matrix_info</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font><font color="#0000ff"><b>)</b></font>;
	    <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">_store_matrix_annotation</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pfm</font><font color="#0000ff"><b>)</b></font>;
	    <font color="#ff0000">##$self-&gt;_store_matrix_species($pfm);</font><BR>	<font color="#0000ff"><b>}</b></font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>return</b></font> $@;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE18"></A><B>store_MatrixSet</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE17">prev</A></TD><TD WIDTH="30">next</TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>store_MatrixSet</b></font>
 {<pre>    <font color="#1f32ff">$_</font><font color="#0000ff"><b>[</b></font>0<font color="#0000ff"><b>]</b></font>-&gt;throw <font color="#0000ff"><b>(</b></font><font color="#007400">"Method store_MtrixSet not yet implemented."</font><font color="#0000ff"><b>)</b></font>;</pre>}<BR>
<A NAME="General"></A>
<HR><H2>General documentation</H2>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_JASPAR2 DATA MODEL"><B>JASPAR2 DATA MODEL</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre>JASPAR4 is working name for a relational database model used<BR>for storing transcriptional factor pattern matrices in a MySQL database.<BR>It was initially designed (JASPAR2) to store matrices for the JASPAR database of<BR>high quality eukaryotic transcription factor specificity profiles by<BR>Albin Sandelin and Wyeth W. Wasserman. Besides the profile matrix itself,<BR>this data model stores profile ID (unique), name, structural class,<BR>basic taxonomic and bibliographic information<BR>as well as some additional opseqdbtional tags.<BR><BR>Tags that are commonly used in the actual JASPAR database include<BR>    'medline'  # PubMed ID<BR>    'species'  # Species name<BR>    'superclass' #Species supergroup, eg 'vertebrate', 'plant' etc<BR>    'total_ic' # total information content - redundant, present <BR>               # for historical<BR>    'type'    #experimental nethod<BR>    'acc'    #accession number for TF protein sequence<BR>    'seqdb'    #corresponding database name<BR>    <BR>but any tag is storable and searchable.<BR>    <BR>    <BR><BR>-----------------------  ADVANCED  ---------------------------------<BR><BR>For the developers and the curious, here is the JASPAR4 data model:<BR><BR>  <BR><BR>It is our best intention to hide the details of this data model, which we <BR>are using on a daily basis in our work, from most TFBS users.<BR>Most users should only know the methods to store the data and <BR>which tags are supported.<BR><BR>-------------------------------------------------------------------------<BR></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_FEEDBACK"><B>FEEDBACK</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre>Please send bug reports and other comments to the author.<BR></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_AUTHOR - Boris Lenhard"><B>AUTHOR - Boris Lenhard</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre>Boris Lenhard <a href="mailto:Boris.Lenhard@cgb.ki.seE">Boris.Lenhard@cgb.ki.seE</a>i.se&gt;<BR></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_APPENDIX"><B>APPENDIX</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre>The rest of the documentation details each of the object<BR>methods. Internal methods are preceded with an underscore.<BR></pre>
</TD></TR>
</TABLE>
</body>
</html>
