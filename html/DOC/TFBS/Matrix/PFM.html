<head>
<!-- Generated by perlmod2www.pl -->
<title>
PFM documentation.
</title>
</head>
<body bgcolor="white">
<HR><H4>TFBS::Matrix</H4>
<H3>PFM</H3>
<A NAME="TOP"></A>
<TABLE BORDER="1" WIDTH="100%"><TR>
<TD><A HREF="#SUMMARY">Summary</A></TD>
<TD><A HREF="#libs">Included libraries</A></TD>
<TD><A HREF="#vardefs">Package variables</A></TD>
<TD><A HREF="#SYNOPSIS">Synopsis</A></TD>
<TD><A HREF="#DESCRIPTION">Description</A></TD>
<TD><A HREF="#General">General documentation</A></TD>
<TD><A HREF="#Methods">Methods</A></TD>
</TR></TABLE><HR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR><TD BGCOLOR="#ffae84"><B>Summary</B></TD></TR>
</TABLE>
<TABLE BORDER="0" WIDTH="100%"><TR><TD><pre><B>TFBS::Matrix::PFM</B> - class for raw position frequency matrix patterns<BR></pre></TD></TR>
</TABLE>
<A NAME="vardefs"></A>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Package variables</B></TD>
<TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0" WIDTH="100%"><TR><TD COLSPAN="2">No package variables defined.</TD></TR>
</TABLE>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD WIDTH="150"><B>Included modules</B></TD><TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0"><TR><TD COLSPAN="2"><b><font color="#0000ff">Bio::Root::Root</font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">Bio::SeqIO</font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">File::Temp</font></b> qw /:POSIX/ </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">PDL</font></b></TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff"><a href="../Matrix.html">TFBS::Matrix</a></font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff"><a href="ICM.html">TFBS::Matrix::ICM</a></font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff"><a href="PWM.html">TFBS::Matrix::PWM</a></font></b> </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">constant</font></b> EXACT_SCHNEIDER_MAX =&gt; 30 </TD></TR>
<TR><TD COLSPAN="2"><b><font color="#0000ff">strict</font></b></TD></TR>
</TABLE>
<A NAME="libs"></A><TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Inherit</B></TD>
<TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0"><TR><TD><b><font color="#0000ff">Bio::Root::Root</font></b> <b><font color="#0000ff"><a href="../Matrix.html">TFBS::Matrix</a></font></b> </TD></TR>
</TABLE>
<A NAME="SYNOPSIS"></A>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Synopsis</B></TD><TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0"><TR><TD COLSPAN="2"><pre><BR><A NAME="_pod_* creating a <B>TFBS::Matrix::PFM</B> object manually:">    * creating a <B>TFBS::Matrix::PFM</B> object manually:</A><BR>        my $matrixref = [ [ 12,  3,  0,  0,  4,  0 ],<BR>		      [  0,  0,  0, 11,  7,  0 ],<BR>		      [  0,  9, 12,  0,  0,  0 ],<BR>		      [  0,  0,  0,  1,  1, 12 ]<BR>		    ];	<BR>    my $pfm = <B>TFBS::Matrix::PFM</B>-&gt;new(-matrix =&gt; $matrixref,<BR>				     -name   =&gt; &quot;MyProfile&quot;,<BR>				     -ID     =&gt; &quot;M0001&quot;<BR>				    );<BR>    # or<BR> <BR>    my $matrixstring =<BR>        &quot;12 3 0 0 4 0\n0 0 0 11 7 0\n0 9 12 0 0 0\n0 0 0 1 1 12&quot;;<BR> <BR>    my $pfm = <B>TFBS::Matrix::PFM</B>-&gt;new(-matrixstring =&gt; $matrixstring,<BR>				     -name   	   =&gt; &quot;MyProfile&quot;,<BR>				     -ID           =&gt; &quot;M0001&quot;<BR>				    );<BR> <BR> <BR>=item * retrieving a TFBS::Matix::PFM object from a database:<BR><BR>    (See documentation of individual TFBS::DB::* modules to learn<BR>how to connect to different types of pattern databases and <BR>retrieve TFBS::Matrix::* objects from them.)<BR>    <BR>    my $db_obj = TFBS::DB::JASPAR2-&gt;new<BR>		    (-connect =&gt; [&quot;dbi:mysql:JASPAR2:myhost&quot;,<BR>				  &quot;myusername&quot;, &quot;mypassword&quot;]);<BR>    my $pfm = $db_obj-&gt;get_Matrix_by_ID(&quot;M0001&quot;, &quot;PFM&quot;);<BR>    # or<BR>    my $pfm = $db_obj-&gt;get_Matrix_by_name(&quot;MyProfile&quot;, &quot;PFM&quot;);<BR><BR><A NAME="_pod_">    </A><BR>    (See the <a href="../MatrixSet.html" target="urlWin"><b>TFBS::MatrixSet</b></a>     to learn how to create <BR>objects for storage and manipulation of multiple matrices.)<BR><BR>        my @pfm_list = $matrixset-&gt;all_patterns(-sort_by=&gt;&quot;name&quot;);<BR><BR><A NAME="_pod_* convert a raw frequency matrix to other matrix types:">    * convert a raw frequency matrix to other matrix types:</A><BR>        my $pwm = $pfm-&gt;to_PWM(); # convert to position weight matrix<BR>    my $icm = $icm-&gt;to_ICM(); # convert to information con<BR><BR><BR></pre>
</TD></TR></TABLE>
<A NAME="DESCRIPTION"></A>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Description</B></TD><TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE><TABLE BORDER="0"><TR><TD COLSPAN="2"><pre><B>TFBS::Matrix::PFM</B> is a class whose instances are objects representing<BR>raw position frequency matrices (PFMs). A PFM is derived from N<BR>nucleotide patterns of fixed size, e.g. the set of sequences<BR><BR>    AGGCCT<BR>    AAGCCT<BR>    AGGCAT<BR>    AAGCCT<BR>    AAGCCT<BR>    AGGCAT<BR>    AGGCCT<BR>    AGGCAT<BR>    AGGTTT<BR>    AGGCAT<BR>    AGGCCT<BR>    AGGCCT<BR><BR>will give the matrix:<BR><BR>    A:[ 12  3  0  0  4  0 ]<BR>    C:[  0  0  0 11  7  0 ]<BR>    G:[  0  9 12  0  0  0 ]<BR>    T:[  0  0  0  1  1 12 ]<BR><BR>which contains the count of each nucleotide at each position in the<BR>sequence. (If you have a set of sequences as above and want to<BR>create a <B>TFBS::Matrix::PFM</B> object out of them, have a look at<BR>TFBS::PatternGen::SimplePFM module.)<BR><BR>PFMs are easily converted to other types of matrices, namely<BR>information content matrices and position weight matrices. A<BR><B>TFBS::Matrix::PFM</B> object has the methods to_ICM and to_PWM which<BR>do just that, returning a TFBS::Matrix::ICM and TFBS::Matrix::PWM<BR>objects, respectively.<BR></pre>
</TD></TR></TABLE>
<A NAME="Methods"></A>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0"><TR BGCOLOR="#ffae84"><TD><B>Methods</B></TD><TD ALIGN="RIGHT"><A HREF="#TOP">top</A></TD></TR></TABLE>
<TABLE BORDER="1" CELLSPACING="5"><TR><TD><B>DESTROY</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE1">Code</A></TD></TR>
<TR><TD><B>_check_column_sums</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE2">Code</A></TD></TR>
<TR><TD><B>add_PFM</B></TD><TD><A HREF="#POD1">Description</A></TD><TD><A HREF="#CODE3">Code</A></TD></TR>
<TR><TD><B>column_sum</B></TD><TD><A HREF="#POD2">Description</A></TD><TD><A HREF="#CODE4">Code</A></TD></TR>
<TR><TD><B>draw_logo</B></TD><TD><A HREF="#POD3">Description</A></TD><TD><A HREF="#CODE5">Code</A></TD></TR>
<TR><TD><B>log2</B></TD><TD><FONT COLOR="RED"><B>No description</B></FONT></TD><TD><A HREF="#CODE6">Code</A></TD></TR>
<TR><TD><B>new</B></TD><TD><A HREF="#POD4">Description</A></TD><TD><A HREF="#CODE7">Code</A></TD></TR>
<TR><TD><B>to_ICM</B></TD><TD><A HREF="#POD5">Description</A></TD><TD><A HREF="#CODE8">Code</A></TD></TR>
<TR><TD><B>to_PWM</B></TD><TD><A HREF="#POD6">Description</A></TD><TD><A HREF="#CODE9">Code</A></TD></TR>
</TABLE>
<A NAME="MethDesc"></A>
<HR><H2>Methods description</H2>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_add_PFM"></A><A NAME="POD1"></A><B>add_PFM</B></TD><TD><A HREF="#CODE3">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD>prev</TD><TD><A HREF="#POD2">next</A></TD></TR></TABLE>
<pre> Title   : add_PFM<BR> Usage   : $pfm-&gt;add_PFM($another_pfm)<BR> Function: adds the values of $pnother_pfm matrix to $pfm<BR> Returns : reference to the updated $pfm object<BR> Args    : a <B>TFBS::Matrix::PFM</B> object<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_column_sum"></A><A NAME="POD2"></A><B>column_sum</B></TD><TD><A HREF="#CODE4">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD1">prev</A></TD><TD><A HREF="#POD3">next</A></TD></TR></TABLE>
<pre> Title   : column_sum<BR> Usage   : my $nr_sequences = $pfm-&gt;column_sum()<BR> Function: calculates the sum of elements of one column<BR>	   (the first one by default) which normally equals the<BR>           number of sequences used to derive the PFM. <BR> Returns : the sum of elements of one column (an integer)<BR> Args    : columnn number (starting from 1), OPTIONAL - you DO NOT<BR>           need to specify it unless you are dealing with a matrix<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_draw_logo"></A><A NAME="POD3"></A><B>draw_logo</B></TD><TD><A HREF="#CODE5">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD2">prev</A></TD><TD><A HREF="#POD4">next</A></TD></TR></TABLE>
<pre> Title   : draw_logo<BR> Usage   : my $gd_image = $pfm-&gt;draw_logo()<BR> Function: draws a sequence logo; similar to the <BR>           method in TFBS::Matrix::ICM, but can automatically calculate<BR>           error bars for drawing<BR> Returns : a GD image object (see documentation of GD module)<BR> Args    : many; PFM-specific options are:<BR>           -small_sample_correction # One of <BR>                                    # &quot;Schneider&quot; (uses correction <BR>                                    #   described by Schneider et al.<BR>                                    #   (Schneider t et al. (1986) J.Biol.Chem.<BR>                                    # &quot;pseudocounts&quot; - standard pseudocount <BR>                                    #   correction,  more suitable for <BR>                                    #   PFMs with large r column sums<BR>                                    # If the parameter is ommited, small<BR>                                    # sample correction is not applied<BR><BR>           -draw_error_bars         # if true, adds error bars to each position<BR>                                    # in the logo. To calculate the error bars,<BR>                                    # it uses the -small_sample_connection<BR>                                    # argument if explicitly set,  <BR>                                    # or &quot;Schneider&quot; by default<BR>For other args, see draw_logo entry in TFBS::Matrix::ICM documentation<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_new"></A><A NAME="POD4"></A><B>new</B></TD><TD><A HREF="#CODE7">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD3">prev</A></TD><TD><A HREF="#POD5">next</A></TD></TR></TABLE>
<pre> Title   : new<BR> Usage   : my $pfm = <B>TFBS::Matrix::PFM</B>-&gt;new(%args)<BR> Function: constructor for the <B>TFBS::Matrix::PFM</B> object<BR> Returns : a new <B>TFBS::Matrix::PFM</B> object<BR> Args    : # you must specify either one of the following three:<BR> <BR>	   -matrix,      # reference to an array of arrays of integers<BR>	      #or<BR>	   -matrixstring,# a string containing four lines<BR>	                 # of tab- or space-delimited integers<BR>	      #or<BR>	   -matrixfile,  # the name of a file containing four lines<BR>	                 # of tab- or space-delimited integers<BR>	   #######<BR> <BR>           -name,        # string, OPTIONAL<BR>           -ID,          # string, OPTIONAL<BR>           -class,       # string, OPTIONAL<BR>           -tags         # an array reference, OPTIONAL<BR>Warnings  : Warns if the matrix provided has columns with different<BR>            sums. Columns with different sums contradict the usual<BR>	    origin of matrix data and, unless you are absolutely sure<BR>	    that column sums _should_ be different, it would be wise to<BR>	    check your matrices.<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_to_ICM"></A><A NAME="POD5"></A><B>to_ICM</B></TD><TD><A HREF="#CODE8">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD4">prev</A></TD><TD><A HREF="#POD6">next</A></TD></TR></TABLE>
<pre> Title   : to_ICM<BR> Usage   : my $icm = $pfm-&gt;to_ICM()<BR> Function: converts a raw frequency matrix (a <B>TFBS::Matrix::PFM</B> object)<BR>	   to information content matrix. At present it assumes uniform<BR>	   background distribution of nucleotide frequencies.<BR> Returns : a new TFBS::Matrix::ICM object<BR> Args    : -small_sample_correction # undef (default), 'schneider' or 'pseudocounts'<BR><BR>How a PFM is converted to ICM:<BR> <BR>For a PFM element PFM[i,k], the probability without<BR>pseudocounts is estimated to be simply<BR><BR>  p[i,k] = PFM[i,k] / Z<BR><BR>where <BR>- Z equals the column sum of the matrix i.e. the number of motifs used<BR>to construct the PFM. <BR>- i is the column index (position in the motif)<BR>- k is the row index (a letter in the alphacer, here k is one of<BR>(A,C,G,T)<BR><BR>Here is how one normally calculates the pseudocount-corrected positional<BR>probability p'[i,j]:<BR><BR>  p'[i,k] = (PFM[i,k] + 0.25*sqrt(Z)) / (Z + sqrt(Z))<BR><BR>0.25 is for the flat distribution of nucleotides, and sqrt(Z) is the<BR>recommended pseudocount weight. In the general case,<BR><BR>  p'[i,k] = (PFM[i,k] + q[k]*B) / (Z + B)<BR><BR>where q[k] is the background distribution of the letter (nucleotide) k,<BR>and B an arbitrary pseudocount value or expression (for no pseudocounts<BR>B=0).<BR><BR>For a given position i, the deviation from random distribution in bits<BR>is calculated as (Baldi and Brunak eq. 1.9 (2ed) or 1.8 (1ed)):<BR><BR>- for an arbitrary alphabet of A letters:<BR><BR>  D[i] = log2(A) + sum_for_all_k(p[i,k]*log2(p[i,k])) <BR><BR>- special case for nucleotides (A=4)<BR><BR>  D[i] = 2 + sum_for_all_k(p[i,k]*log2(p[i,k]))  <BR><BR>D[i] equals the information content of the position i in the motif. To<BR>calculate the entire ICM, you have to calculate the contrubution of each<BR>nucleotide at a position i to D[i], i.e.<BR><BR>ICM[i,k] = p'[i,k] * D[i]<BR></pre>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD WIDTH="200"><A NAME="_pod_to_PWM"></A><A NAME="POD6"></A><B>to_PWM</B></TD><TD><A HREF="#CODE9">code</A></TD><TD><A HREF="#TOP">top</A></TD><TD><A HREF="#POD5">prev</A></TD><TD><A HREF="#POD7">next</A></TD></TR></TABLE>
<pre> Title   : to_PWM<BR> Usage   : my $pwm = $pfm-&gt;to_PWM()<BR> Function: converts a raw frequency matrix (a <B>TFBS::Matrix::PFM</B> object)<BR>	   to position weight matrix. At present it assumes uniform<BR>	   background distribution of nucleotide frequencies.<BR> Returns : a new TFBS::Matrix::PWM object<BR> Args    : none; in the future releases, it should be able to accept<BR>	   a user defined background probability of the four<BR>	   nucleotides<BR></pre>
<A NAME="MethCode"></A>
<HR><H2>Methods code</H2>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE1"></A><B>DESTROY</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30">prev</TD><TD WIDTH="30"><A HREF="#CODE2">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>DESTROY</b></font>
 {<pre>    <font color="#ff0000">## does nothing</font><BR></pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE2"></A><B>_check_column_sums</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE1">prev</A></TD><TD WIDTH="30"><A HREF="#CODE3">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff00ff"><b>_check_column_sums</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$pdl</font> = <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">pdl_matrix</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$rowsums</font> = <font color="#1f32ff">$pdl</font>-&gt;<font color="#ff8204">xchg</font><font color="#0000ff"><b>(</b></font>0,1<font color="#0000ff"><b>)</b></font>-&gt;<font color="#ff8204">sumover</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$rowsums</font>-&gt;<font color="#ff8204">where</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$rowsums</font> != <font color="#1f32ff">$rowsums</font>-&gt;<font color="#ff8204">slice</font><font color="#0000ff"><b>(</b></font>0<font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>-&gt;<font color="#ff8204">getdim</font><font color="#0000ff"><b>(</b></font>0<font color="#0000ff"><b>)</b></font> &gt; 0<font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#1f32ff">$self</font>-&gt;<font color="#4169e1"><b>warn</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"PFM for "</font>.<font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font>ID<font color="#0000ff"><b>}</b></font>.<font color="#007400">" has unequal column sums"</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font></pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE3"></A><B>add_PFM</B></TD><TD><A HREF="#POD1">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE2">prev</A></TD><TD WIDTH="30"><A HREF="#CODE4">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>add_PFM</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">$pfm</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#1f32ff">$pfm</font>-&gt;<font color="#ff8204">isa</font><font color="#0000ff"><b>(</b></font><font color="#007400">"TFBS::Matrix::PFM"</font><font color="#0000ff"><b>)</b></font> 
	or <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">throw</font><font color="#0000ff"><b>(</b></font><font color="#007400">"Wrong or no argument passed to add_PFM"</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$sum</font> = <font color="#1f32ff">$self</font>-&gt;pdl_matrix + <font color="#1f32ff">$pfm</font>-&gt;pdl_matrix;
    <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">set_matrix</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$sum</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$self</font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE4"></A><B>column_sum</B></TD><TD><A HREF="#POD2">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE3">prev</A></TD><TD WIDTH="30"><A HREF="#CODE5">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>column_sum</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">$column</font><font color="#0000ff"><b>)</b></font> = <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@_</font>,1<font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">pdl_matrix</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$column</font>-1<font color="#0000ff"><b>)</b></font>-&gt;sum;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE5"></A><B>draw_logo</B></TD><TD><A HREF="#POD3">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE4">prev</A></TD><TD WIDTH="30"><A HREF="#CODE6">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>draw_logo</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-draw_error_bars'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-small_sample_correction'</font><font color="#0000ff"><b>}</b></font> ||= <font color="#007400">"Schneider"</font>; <font color="#ff0000">## default Schneider</font><BR>
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$pdl_no_correction</font> = 
	    <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">to_ICM</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>
	    -&gt;pdl_matrix-&gt;transpose-&gt;sumover;
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$pdl_with_correction</font> = 
	    <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">to_ICM</font><font color="#0000ff"><b>(</b></font>-small_sample_correction 
			  =&gt; <font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-small_sample_correction'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>
	    -&gt;pdl_matrix-&gt;transpose-&gt;sumover;

	<font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-error_bars'</font><font color="#0000ff"><b>}</b></font> = 
	    <font color="#0000ff"><b>[</b></font>list <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pdl_no_correction</font> - <font color="#1f32ff">$pdl_with_correction</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>]</b></font>;
	    
    <font color="#0000ff"><b>}</b></font>
    <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">to_ICM</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font>-&gt;<font color="#ff8204">draw_logo</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE6"></A><B>log2</B></TD><TD>description</TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE5">prev</A></TD><TD WIDTH="30"><A HREF="#CODE7">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>log2</b></font>
 {<pre> <font color="#4169e1"><b>log</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$_</font><font color="#0000ff"><b>[</b></font>0<font color="#0000ff"><b>]</b></font><font color="#0000ff"><b>)</b></font> <font color="#006400"><b>/ log(2); }<BR><BR>sub _schneider_correction {<BR>    my (</b></font><font color="#1f32ff">$pdl</font><font color="#006400"><b>, </b></font><font color="#1f32ff">$bg_pdl</font><font color="#006400"><b>) = </b></font><font color="#1f32ff">@_</font>;<BR>    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$Hg</font> = -sum <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$bg_pdl</font>*<font color="#ff8204">log2</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$bg_pdl</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@Hnbs</font>, <font color="#1f32ff">%saved_Hnb</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$is_flat</font> = <font color="#ff8204">_is_bg_flat</font><font color="#0000ff"><b>(</b></font>list <font color="#1f32ff">$bg_pdl</font><font color="#0000ff"><b>)</b></font>;
    
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@factorials</font> = <font color="#0000ff"><b>(</b></font>1<font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#ff8204">min</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pdl</font>-&gt;transpose-&gt;sumover<font color="#0000ff"><b>)</b></font> &lt;= EXACT_SCHNEIDER_MAX<font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$i</font> <font color="#0000ff"><b>(</b></font>1..<font color="#ff8204">max</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$pdl</font>-&gt;transpose-&gt;sumover<font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	    <font color="#1f32ff">$factorials</font><font color="#0000ff"><b>[</b></font><font color="#1f32ff">$i</font><font color="#0000ff"><b>]</b></font> =<font color="#1f32ff">$factorials</font><font color="#0000ff"><b>[</b></font><font color="#1f32ff">$i</font>-1<font color="#0000ff"><b>]</b></font> * <font color="#1f32ff">$i</font>;
	<font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@column_sums</font> = list <font color="#1f32ff">$pdl</font>-&gt;transpose-&gt;sumover;
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$colsum</font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@column_sums</font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>defined</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$saved_Hnb</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$colsum</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	    <font color="#4169e1"><b>push</b></font> <font color="#1f32ff">@Hnbs</font>, <font color="#1f32ff">$saved_Hnb</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$colsum</font><font color="#0000ff"><b>}</b></font>;
	<font color="#0000ff"><b>}</b></font>
	<font color="#0000ff"><b>else</b></font>  <font color="#0000ff"><b>{</b></font>
	    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$Hnb</font>;
	    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$colsum</font> &lt;= EXACT_SCHNEIDER_MAX<font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
		<font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$is_flat</font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
		    <font color="#1f32ff">$Hnb</font> = <font color="#ff8204">_schneider_Hnb_precomputed</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$colsum</font><font color="#0000ff"><b>)</b></font>;
		<font color="#0000ff"><b>}</b></font>
		<font color="#0000ff"><b>else</b></font> <font color="#0000ff"><b>{</b></font>
		    <font color="#1f32ff">$Hnb</font> = <font color="#ff8204">_schneider_Hnb_exact</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$colsum</font>, <font color="#1f32ff">$bg_pdl</font>,\@ 
						factorials<font color="#0000ff"><b>)</b></font>;
		<font color="#0000ff"><b>}</b></font>
	    <font color="#0000ff"><b>}</b></font>
	    <font color="#0000ff"><b>else</b></font> <font color="#0000ff"><b>{</b></font>
		<font color="#1f32ff">$Hnb</font> = <font color="#ff8204">_schneider_Hnb_approx</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$colsum</font>, <font color="#1f32ff">$Hg</font><font color="#0000ff"><b>)</b></font>;

	    <font color="#0000ff"><b>}</b></font>
	    <font color="#1f32ff">$saved_Hnb</font><font color="#0000ff"><b>{</b></font><font color="#1f32ff">$colsum</font><font color="#0000ff"><b>}</b></font> = <font color="#1f32ff">$Hnb</font>;
	    <font color="#4169e1"><b>push</b></font> <font color="#1f32ff">@Hnbs</font>, <font color="#1f32ff">$Hnb</font>;
	<font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>return</b></font> -<font color="#1f32ff">$Hg</font> + <font color="#ff8204">pdl</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">@Hnbs</font><font color="#0000ff"><b>)</b></font>;
    
<font color="#0000ff"><b>}</b></font>


<font color="#0000ff"><b>sub</b></font> _schneider_Hnb_exact <font color="#0000ff"><b>{</b></font>
    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$n</font>, <font color="#1f32ff">$bg_pdl</font>, <font color="#1f32ff">$rFactorial</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$is_flat</font> = <font color="#ff8204">_is_bg_flat</font><font color="#0000ff"><b>(</b></font>list <font color="#1f32ff">$bg_pdl</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>return</b></font> 0 <font color="#0000ff"><b>if</b></font> <font color="#1f32ff">$n</font>==1;
<font color="#ff0000">##    my @fctrl = (1);</font><BR><font color="#ff0000">##    foreach my $i (1..max($pdl-&gt;transpose-&gt;sumover)) {</font><BR><font color="#ff0000">##	$rFactorial-&gt;[$i] =$rFactorial-&gt;[$i-1] * $i;</font><BR><font color="#ff0000">##    }</font><BR><font color="#ff0000">##    my @colsum = list $pdl-&gt;transpose-&gt;sumover;</font><BR>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$na</font>, <font color="#1f32ff">$nc</font>, <font color="#1f32ff">$ng</font>, <font color="#1f32ff">$nt</font><font color="#0000ff"><b>)</b></font> = <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$n</font>, 0,0,0<font color="#0000ff"><b>)</b></font>;
<font color="#ff0000">##    my $n = $colsum[0];</font><BR>    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$E_Hnb</font>=0;
    <font color="#0000ff"><b>while</b></font> <font color="#0000ff"><b>(</b></font>1<font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$ns_pdl</font> = pdl <font color="#0000ff"><b>[</b></font><font color="#1f32ff">$na</font>, <font color="#1f32ff">$nc</font>, <font color="#1f32ff">$ng</font>, <font color="#1f32ff">$nt</font><font color="#0000ff"><b>]</b></font>;
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$Pnb</font> = <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$rFactorial</font>-&gt;<font color="#0000ff"><b>[</b></font><font color="#1f32ff">$n</font><font color="#0000ff"><b>]</b></font>
		   <font color="#006400"><b>/<BR>		   (</b></font><font color="#1f32ff">$rFactorial</font><font color="#006400"><b>-&gt;[</b></font><font color="#1f32ff">$na</font><font color="#006400"><b>]<BR>		    *</b></font><font color="#1f32ff">$rFactorial</font><font color="#006400"><b>-&gt;[</b></font><font color="#1f32ff">$nc</font><font color="#006400"><b>]<BR>		    *</b></font><font color="#1f32ff">$rFactorial</font><font color="#006400"><b>-&gt;[</b></font><font color="#1f32ff">$ng</font><font color="#006400"><b>]<BR>		    *</b></font><font color="#1f32ff">$rFactorial</font><font color="#006400"><b>-&gt;[</b></font><font color="#1f32ff">$nt</font><font color="#006400"><b>])<BR>		   )*prod(</b></font><font color="#1f32ff">$bg_pdl</font><font color="#006400"><b>-&gt;transpose**pdl(</b></font><font color="#1f32ff">$na</font><font color="#006400"><b>, </b></font><font color="#1f32ff">$nc</font><font color="#006400"><b>, </b></font><font color="#1f32ff">$ng</font><font color="#006400"><b>, </b></font><font color="#1f32ff">$nt</font>));<BR>	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$Hnb</font> = -1 * <font color="#ff8204">sum</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$ns_pdl</font><font color="#006400"><b>/</b></font><font color="#1f32ff">$n</font><font color="#006400"><b>)*log2(</b></font><font color="#1f32ff">$ns_pdl</font><font color="#006400"><b>/</b></font><font color="#1f32ff">$n</font><font color="#0000ff"><b>)</b></font>-&gt;<font color="#ff8204">badmask</font><font color="#0000ff"><b>(</b></font>0<font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>;
	<font color="#1f32ff">$E_Hnb</font> += <font color="#1f32ff">$Pnb</font>*<font color="#1f32ff">$Hnb</font>;
	

	<font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$nt</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	    <font color="#0000ff"><b>if</b></font>    <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$ng</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$ng</font>--; <font color="#1f32ff">$nt</font>++, <font color="#0000ff"><b>}</b></font>
	    <font color="#0000ff"><b>elsif</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$nc</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$nc</font>--; <font color="#1f32ff">$ng</font> = <font color="#1f32ff">$nt</font>+1; <font color="#1f32ff">$nt</font> = 0; <font color="#0000ff"><b>}</b></font>
	    <font color="#0000ff"><b>elsif</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$na</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$na</font>--; <font color="#1f32ff">$nc</font> = <font color="#1f32ff">$nt</font>+1; <font color="#1f32ff">$nt</font> = 0; <font color="#0000ff"><b>}</b></font>
	    <font color="#0000ff"><b>else</b></font>        <font color="#0000ff"><b>{</b></font> <font color="#0000ff"><b>last</b></font>; <font color="#0000ff"><b>}</b></font>
	<font color="#0000ff"><b>}</b></font>
	<font color="#0000ff"><b>else</b></font> <font color="#0000ff"><b>{</b></font>
	    <font color="#0000ff"><b>if</b></font>    <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$ng</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$ng</font>--; <font color="#1f32ff">$nt</font>++, <font color="#0000ff"><b>}</b></font>
	    <font color="#0000ff"><b>elsif</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$nc</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$nc</font>--; <font color="#1f32ff">$ng</font>++; <font color="#0000ff"><b>}</b></font>
	    <font color="#0000ff"><b>else</b></font>        <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$na</font>--; <font color="#1f32ff">$nc</font>++; <font color="#1f32ff">$nt</font> = 0; <font color="#0000ff"><b>}</b></font>
	<font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$E_Hnb</font>;
<font color="#0000ff"><b>}</b></font>



<font color="#0000ff"><b>sub</b></font> _schneider_Hnb_approx  <font color="#0000ff"><b>{</b></font>
    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$colsum</font>,  <font color="#1f32ff">$Hg</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$Hg</font> -3<font color="#006400"><b>/(2*log(2)*</b></font><font color="#1f32ff">$colsum</font>);<BR>    
<font color="#0000ff"><b>}</b></font>



<font color="#0000ff"><b>sub</b></font> _schneider_Hnb_precomputed <font color="#0000ff"><b>{</b></font>
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$i</font> = <font color="#4169e1"><b>shift</b></font>;
    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$i</font>&lt;1 or <font color="#1f32ff">$i</font>&gt;30<font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font> 
	<font color="#4169e1"><b>die</b></font> <font color="#007400">"Precomputed params only available for colsums 1 to 30)"</font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@precomputed</font> = 
	<font color="#0000ff"><b>(</b></font>
	 0, <font color="#ff0000">## 1</font><BR>	 0.75, <font color="#ff0000">## 2</font><BR>	 1.11090234442608, <font color="#ff0000">## 3</font><BR>	 1.32398964833609, <font color="#ff0000">## 4</font><BR>	 1.46290503577084, <font color="#ff0000">## 5</font><BR>	 1.55922640783176, <font color="#ff0000">## 6</font><BR>	 1.62900374746751, <font color="#ff0000">## 7</font><BR>	 1.68128673969433, <font color="#ff0000">## 8</font><BR>	 1.7215504663901, <font color="#ff0000">## 9</font><BR>	 1.75328193031842, <font color="#ff0000">## 10</font><BR>	 1.77879136615189, <font color="#ff0000">## 11</font><BR>	 1.79965855531179, <font color="#ff0000">## 12</font><BR>	 1.81699248819687, <font color="#ff0000">## 13</font><BR>	 1.8315892710679, <font color="#ff0000">## 14</font><BR>	 1.84403166371213, <font color="#ff0000">## 15</font><BR>	 1.85475371994775, <font color="#ff0000">## 16</font><BR>	 1.86408383599326, <font color="#ff0000">## 17</font><BR>	 1.87227404728809, <font color="#ff0000">## 18</font><BR>	 1.87952034817826, <font color="#ff0000">## 19</font><BR>	 1.88597702438913, <font color="#ff0000">## 20</font><BR>	 1.89176691659196, <font color="#ff0000">## 21</font><BR>	 1.89698887214968, <font color="#ff0000">## 22</font><BR>	 1.90172322434865, <font color="#ff0000">## 23</font><BR>	 1.90603586889234, <font color="#ff0000">## 24</font><BR>	 1.90998133028897, <font color="#ff0000">## 25</font><BR>	 1.91360509239859, <font color="#ff0000">## 26</font><BR>	 1.91694538711761, <font color="#ff0000">## 27</font><BR>	 1.92003457997914, <font color="#ff0000">## 28</font><BR>	 1.92290025302018, <font color="#ff0000">## 29</font><BR>	 1.92556605820924, <font color="#ff0000">## 30</font><BR>	 <font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$precomputed</font><font color="#0000ff"><b>[</b></font><font color="#1f32ff">$i</font>-1<font color="#0000ff"><b>]</b></font>;
<font color="#0000ff"><b>}</b></font>


<font color="#0000ff"><b>sub</b></font> _is_bg_flat <font color="#0000ff"><b>{</b></font>
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">@bg</font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$ref</font> = <font color="#4169e1"><b>shift</b></font>;
    <font color="#0000ff"><b>foreach</b></font> <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$other</font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">@bg</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>return</b></font> 0 <font color="#0000ff"><b>unless</b></font> <font color="#1f32ff">$ref</font>==<font color="#1f32ff">$other</font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>return</b></font> 1;
<font color="#0000ff"><b>}</b></font>


1;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE7"></A><B>new</B></TD><TD><A HREF="#POD4">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE6">prev</A></TD><TD WIDTH="30"><A HREF="#CODE8">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>new</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$class</font>, <font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$matrix</font> = <A HREF="../Matrix.html"><font color="#8000ff"><b>TFBS::Matrix</b></font></A>-&gt;<font color="#0000ff"><b>new</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">%args</font>, -matrixtype=&gt;<font color="#007400">"PFM"</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$self</font> = <font color="#4169e1"><b>bless</b></font> <font color="#1f32ff">$matrix</font>, <font color="#4169e1"><b>ref</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$class</font><font color="#0000ff"><b>)</b></font> || <font color="#1f32ff">$class</font>;
    <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">_check_column_sums</font><font color="#0000ff"><b>(</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$self</font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE8"></A><B>to_ICM</B></TD><TD><A HREF="#POD5">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE7">prev</A></TD><TD WIDTH="30"><A HREF="#CODE9">next</A></TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>to_ICM</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$bg</font> = <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-bg_probabilities'</font> <font color="#0000ff"><b>}</b></font> || <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'bg_probabilities'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>;



    <font color="#ff0000">## compute ICM</font><BR>    
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$bg_pdl</font> = 
	transpose pdl <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$bg</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'A'</font><font color="#0000ff"><b>}</b></font>, <font color="#1f32ff">$bg</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'C'</font><font color="#0000ff"><b>}</b></font>, <font color="#1f32ff">$bg</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'G'</font><font color="#0000ff"><b>}</b></font>, <font color="#1f32ff">$bg</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'T'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$Z_pdl</font> = <font color="#1f32ff">$self</font>-&gt;<font color="#ff8204">pdl_matrix</font><font color="#0000ff"><b>(</b></font>0,1<font color="#0000ff"><b>)</b></font>-&gt;sumover;

    <font color="#ff0000">## pseudocount calculation </font><BR>
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$B</font> = 0; 
    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>lc</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-small_sample_correction'</font><font color="#0000ff"><b>}</b></font> or <font color="#007400">""</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>eq</b></font> <font color="#007400">"pseudocounts"</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>{</b></font>

	<font color="#1f32ff">$B</font> = <font color="#4169e1"><b>sqrt</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$Z_pdl</font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>}</b></font>
    <font color="#0000ff"><b>else</b></font> <font color="#0000ff"><b>{</b></font>
	<font color="#1f32ff">$B</font> = 0;   	<font color="#ff0000">## do not add pseudocounts</font><BR>    <font color="#0000ff"><b>}</b></font>

    
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$p_pdl</font> = <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>-&gt;pdl_matrix +<font color="#1f32ff">$bg_pdl</font>*<font color="#1f32ff">$B</font><font color="#0000ff"><b>)</b></font><font color="#006400"><b>/ (</b></font><font color="#1f32ff">$Z_pdl</font><font color="#006400"><b> + </b></font><font color="#1f32ff">$B</font>);<BR>    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$plog_pdl</font> = <font color="#1f32ff">$p_pdl</font>*<font color="#ff8204">log2</font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$p_pdl</font><font color="#0000ff"><b>)</b></font>;
    <font color="#1f32ff">$plog_pdl</font> = <font color="#1f32ff">$plog_pdl</font>-&gt;<font color="#ff8204">badmask</font><font color="#0000ff"><b>(</b></font>0<font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$D_pdl</font> = 2 + <font color="#1f32ff">$plog_pdl</font>-&gt;<font color="#ff8204">xchg</font><font color="#0000ff"><b>(</b></font>0,1<font color="#0000ff"><b>)</b></font>-&gt;sumover;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$ic_pdl</font> = <font color="#1f32ff">$p_pdl</font> * <font color="#1f32ff">$D_pdl</font>;


    <font color="#ff0000">## apply Schneider correction if requested</font><BR>
    <font color="#0000ff"><b>if</b></font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>lc</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-small_sample_correction'</font><font color="#0000ff"><b>}</b></font> or <font color="#007400">""</font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>eq</b></font> <font color="#007400">"schneider"</font><font color="#0000ff"><b>)</b></font>  <font color="#0000ff"><b>{</b></font>
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$columnsum_pdl</font> = <font color="#1f32ff">$ic_pdl</font>-&gt;transpose-&gt;sumover;
	<font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$corrected_columnsum_pdl</font> = 
	    <font color="#1f32ff">$columnsum_pdl</font> 
	    + _schneider_correction <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>-&gt;pdl_matrix, <font color="#1f32ff">$bg_pdl</font><font color="#0000ff"><b>)</b></font>;
	<font color="#1f32ff">$ic_pdl</font> *= <font color="#1f32ff">$corrected_columnsum_pdl</font><font color="#006400"><b>/</b></font><font color="#1f32ff">$columnsum_pdl</font>;<BR>    <font color="#0000ff"><b>}</b></font>
 
    <font color="#ff0000">## construct and return an ICM object</font><BR>
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$ICM</font> = <A HREF="ICM.html"><font color="#8000ff"><b>TFBS::Matrix::ICM</b></font></A>-&gt;<font color="#0000ff"><b>new</b></font>
	<font color="#0000ff"><b>(</b></font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>map</b></font> <font color="#0000ff"><b>{</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"-<font color="#1f32ff">$_</font>"</font> =&gt; <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#1f32ff">$_</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>}</b></font> <font color="#4169e1"><b>keys</b></font> %$self<font color="#0000ff"><b>)</b></font>,
	  -tags =&gt;\% <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'tags'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>}</b></font>, 
	  -bg_probabilities =&gt;\% <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'bg_probabilities'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>}</b></font>, 
	  -matrix    =&gt; <font color="#1f32ff">$ic_pdl</font>
	<font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$ICM</font>;</pre>}<BR>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#dcab68"><TD WIDTH="200"><A NAME="CODE9"></A><B>to_PWM</B></TD><TD><A HREF="#POD6">description</A></TD><TD WIDTH="30"><A HREF="#TOP">top</A></TD><TD WIDTH="30"><A HREF="#CODE8">prev</A></TD><TD WIDTH="30">next</TD></TR></TABLE>
<font color="#0000ff"><b>sub</b></font> <font color="#ff0000"><b>to_PWM</b></font>
 {<pre>    <font color="#0000ff"><b>my</b></font> <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>, <font color="#1f32ff">%args</font><font color="#0000ff"><b>)</b></font> = <font color="#1f32ff">@_</font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$bg</font> = <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$args</font><font color="#0000ff"><b>{</b></font><font color="#007400">'-bg_probabilities'</font> <font color="#0000ff"><b>}</b></font> || <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'bg_probabilities'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$bg_pdl</font> = 
	transpose pdl <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$bg</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'A'</font><font color="#0000ff"><b>}</b></font>, <font color="#1f32ff">$bg</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'C'</font><font color="#0000ff"><b>}</b></font>, <font color="#1f32ff">$bg</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'G'</font><font color="#0000ff"><b>}</b></font>, <font color="#1f32ff">$bg</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'T'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$nseqs</font> = <font color="#1f32ff">$self</font>-&gt;pdl_matrix-&gt;sum <font color="#006400"><b>/ </b></font><font color="#1f32ff">$self</font>-&gt;length;<BR>    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$q_pdl</font> = <font color="#0000ff"><b>(</b></font><font color="#1f32ff">$self</font>-&gt;pdl_matrix +<font color="#1f32ff">$bg_pdl</font>*<font color="#4169e1"><b>sqrt</b></font><font color="#0000ff"><b>(</b></font><font color="#1f32ff">$nseqs</font><font color="#0000ff"><b>)</b></font><font color="#0000ff"><b>)</b></font>
		 <font color="#006400"><b>/ <BR>		(</b></font><font color="#1f32ff">$nseqs</font><font color="#006400"><b> + sqrt(</b></font><font color="#1f32ff">$nseqs</font>));<BR>    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$pwm_pdl</font> = <font color="#ff8204">log2</font><font color="#0000ff"><b>(</b></font>4*<font color="#1f32ff">$q_pdl</font><font color="#0000ff"><b>)</b></font>;

    <font color="#0000ff"><b>my</b></font> <font color="#1f32ff">$PWM</font> = <A HREF="PWM.html"><font color="#8000ff"><b>TFBS::Matrix::PWM</b></font></A>-&gt;<font color="#0000ff"><b>new</b></font>
	<font color="#0000ff"><b>(</b></font> <font color="#0000ff"><b>(</b></font><font color="#4169e1"><b>map</b></font> <font color="#0000ff"><b>{</b></font><font color="#0000ff"><b>(</b></font><font color="#007400">"-<font color="#1f32ff">$_</font>"</font>, <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#1f32ff">$_</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>)</b></font> <font color="#0000ff"><b>}</b></font> <font color="#4169e1"><b>keys</b></font> %$self<font color="#0000ff"><b>)</b></font>,
          <font color="#ff0000">## do not want tags to point to the same arrayref as in $self:</font><BR>	  -tags =&gt;\% <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'tags'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>}</b></font>, 
	  -bg_probabilities =&gt;\% <font color="#0000ff"><b>{</b></font> <font color="#1f32ff">$self</font>-&gt;<font color="#0000ff"><b>{</b></font><font color="#007400">'bg_probabilities'</font><font color="#0000ff"><b>}</b></font><font color="#0000ff"><b>}</b></font>, 
	  -matrix    =&gt; <font color="#1f32ff">$pwm_pdl</font>
	<font color="#0000ff"><b>)</b></font>;
    <font color="#0000ff"><b>return</b></font> <font color="#1f32ff">$PWM</font>;</pre>}<BR>
<A NAME="General"></A>
<HR><H2>General documentation</H2>
<TABLE BORDER="0" WIDTH="100%" CELLSPACING="0">
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_FEEDBACK"><B>FEEDBACK</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre>Please send bug reports and other comments to the author.<BR></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_AUTHOR - Boris Lenhard"><B>AUTHOR - Boris Lenhard</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre>Boris Lenhard <a href="mailto:Boris.Lenhard@cgb.ki.seE">Boris.Lenhard@cgb.ki.seE</a>i.se&gt;<BR></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_APPENDIX"><B>APPENDIX</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre>The rest of the documentation details each of the object<BR>methods. Internal methods are preceded with an underscore.<BR></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_name"><B>name</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_ID"><B>ID</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_class"><B>class</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_matrix"><B>matrix</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_length"><B>length</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_revcom"><B>revcom</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_rawprint"><B>rawprint</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre></pre>
</TD></TR>
<TR BGCOLOR="#4492df"><TD><A NAME="_pod_prettyprint"><B>prettyprint</A></B></TD>
<TD><A HREF="#TOP">top</A></TD></TR><TR><TD COLSPAN="2"><pre>The above methods are common to all matrix objects. Please consult<BR><a href="../Matrix.html" target="urlWin"><b>TFBS::Matrix</b></a> to find out how to use them.<BR></pre>
</TD></TR>
</TABLE>
</body>
</html>
